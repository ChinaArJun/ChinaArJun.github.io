(window.webpackJsonp=window.webpackJsonp||[]).push([[332],{910:function(t,a,e){"use strict";e.r(a);var l=e(44),s=Object(l.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"_7-2-go-slice-æœ€å¤§å®¹é‡å¤§å°æ˜¯æ€ä¹ˆæ¥çš„"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-go-slice-æœ€å¤§å®¹é‡å¤§å°æ˜¯æ€ä¹ˆæ¥çš„"}},[t._v("#")]),t._v(" 7.2 Go Slice æœ€å¤§å®¹é‡å¤§å°æ˜¯æ€ä¹ˆæ¥çš„")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://i.imgur.com/bQQRTTY.png",alt:"image"}})]),t._v(" "),e("h2",{attrs:{id:"å‰è¨€"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[t._v("#")]),t._v(" å‰è¨€")]),t._v(" "),e("p",[t._v("åœ¨ã€Šæ·±å…¥ç†è§£ Go Sliceã€‹ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº† â€œæ ¹æ®å…¶ç±»å‹å¤§å°å»è·å–èƒ½å¤Ÿç”³è¯·çš„æœ€å¤§å®¹é‡å¤§å°â€ çš„å¤„ç†é€»è¾‘ã€‚ä»Šå¤©æˆ‘ä»¬å°†æ›´æ·±å…¥åœ°å»æ¢ç©¶ä¸€ä¸‹ï¼Œåº•å±‚åˆ°åº•åšäº†ä»€ä¹ˆä¸œè¥¿ï¼Œæ¶‰åŠä»€ä¹ˆçŸ¥è¯†ç‚¹ï¼Ÿ")]),t._v(" "),e("p",[t._v("Go Slice å¯¹åº”ä»£ç å¦‚ä¸‹ï¼š")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("func makeslice(et *_type, len, cap int) slice {\n\tmaxElements := maxSliceCap(et.size)\n\tif len < 0 || uintptr(len) > maxElements {\n\t\t...\n\t}\n\n\tif cap < len || uintptr(cap) > maxElements {\n\t\t...\n\t}\n\n\tp := mallocgc(et.size*uintptr(cap), et, true)\n\treturn slice{p, len, cap}\n}\n")])])]),e("p",[t._v("æ ¹æ®æƒ³è¦è¿½å¯»çš„é€»è¾‘ï¼Œå®šä½åˆ°äº† "),e("code",[t._v("maxSliceCap")]),t._v(" æ–¹æ³•ï¼Œå®ƒä¼šæ ¹æ®"),e("strong",[t._v("å½“å‰ç±»å‹çš„å¤§å°è·å–åˆ°äº†æ‰€å…è®¸çš„æœ€å¤§å®¹é‡å¤§å°")]),t._v("æ¥è¿›è¡Œé˜ˆå€¼åˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯å®‰å…¨æ£€æŸ¥ã€‚è¿™æ˜¯æµ…å±‚çš„äº†è§£ï¼Œæˆ‘ä»¬ç»§ç»­è¿½ä¸‹å»çœ‹çœ‹è¿˜åšäº†äº›ä»€ä¹ˆï¼Ÿ")]),t._v(" "),e("h2",{attrs:{id:"maxslicecap"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#maxslicecap"}},[t._v("#")]),t._v(" maxSliceCap")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("func maxSliceCap(elemsize uintptr) uintptr {\n\tif elemsize < uintptr(len(maxElems)) {\n\t\treturn maxElems[elemsize]\n\t}\n\treturn maxAlloc / elemsize\n}\n")])])]),e("h2",{attrs:{id:"maxelems"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#maxelems"}},[t._v("#")]),t._v(" maxElems")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("var maxElems = [...]uintptr{\n\t^uintptr(0),\n\tmaxAlloc / 1, maxAlloc / 2, maxAlloc / 3, maxAlloc / 4,\n\tmaxAlloc / 5, maxAlloc / 6, maxAlloc / 7, maxAlloc / 8,\n\tmaxAlloc / 9, maxAlloc / 10, maxAlloc / 11, maxAlloc / 12,\n\tmaxAlloc / 13, maxAlloc / 14, maxAlloc / 15, maxAlloc / 16,\n\tmaxAlloc / 17, maxAlloc / 18, maxAlloc / 19, maxAlloc / 20,\n\tmaxAlloc / 21, maxAlloc / 22, maxAlloc / 23, maxAlloc / 24,\n\tmaxAlloc / 25, maxAlloc / 26, maxAlloc / 27, maxAlloc / 28,\n\tmaxAlloc / 29, maxAlloc / 30, maxAlloc / 31, maxAlloc / 32,\n}\n")])])]),e("p",[e("code",[t._v("maxElems")]),t._v(" æ˜¯åŒ…å«ä¸€äº›é¢„å®šä¹‰çš„åˆ‡ç‰‡æœ€å¤§å®¹é‡å€¼çš„æŸ¥æ‰¾è¡¨ï¼Œç´¢å¼•æ˜¯åˆ‡ç‰‡å…ƒç´ çš„ç±»å‹å¤§å°ã€‚è€Œå€¼çœ‹èµ·æ¥ â€œå¥‡å¥‡æ€ªæ€ªâ€ ä¸å¤§çœ¼ç†Ÿï¼Œéƒ½æ˜¯äº›ä»€ä¹ˆå‘¢ã€‚ä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒç‚¹ï¼š")]),t._v(" "),e("ul",[e("li",[t._v("^uintptr(0)")]),t._v(" "),e("li",[t._v("maxAlloc")]),t._v(" "),e("li",[t._v("maxAlloc / typeSize")])]),t._v(" "),e("h3",{attrs:{id:"uintptr-0"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#uintptr-0"}},[t._v("#")]),t._v(" ^uintptr(0)")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('func main() {\n\tlog.Printf("uintptr: %v\\n", uintptr(0))\n\tlog.Printf("^uintptr: %v\\n", ^uintptr(0))\n}\n')])])]),e("p",[t._v("è¾“å‡ºç»“æœï¼š")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("2019/01/05 17:51:52 uintptr: 0\n2019/01/05 17:51:52 ^uintptr: 18446744073709551615\n")])])]),e("p",[t._v("æˆ‘ä»¬ç•™æ„ä¸€ä¸‹è¾“å‡ºç»“æœï¼Œæ¯”è¾ƒç¥å¥‡ã€‚å–åä¹‹åä¸ºä»€ä¹ˆæ˜¯ 18446744073709551615 å‘¢ï¼Ÿ")]),t._v(" "),e("h3",{attrs:{id:"uintptr-æ˜¯ä»€ä¹ˆ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#uintptr-æ˜¯ä»€ä¹ˆ"}},[t._v("#")]),t._v(" uintptr æ˜¯ä»€ä¹ˆ")]),t._v(" "),e("p",[t._v("åœ¨åˆ†æä¹‹å‰ï¼Œæˆ‘ä»¬è¦çŸ¥é“ uintptr çš„æœ¬è´¨ï¼ˆçœŸé¢ç›®ï¼‰ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œå¦‚ä¸‹ï¼š")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("type uintptr uintptr\n")])])]),e("p",[t._v("uintptr çš„ç±»å‹æ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œæ¥ç€æ‰¾å®ƒçš„çœŸé¢ç›®ï¼Œå¦‚ä¸‹ï¼š")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#ifdef _64BIT\ntypedef\tuint64\t\tuintptr;\n#else\ntypedef\tuint32\t\tuintptr;\n#endif\n")])])]),e("p",[t._v("é€šè¿‡å¯¹ä»¥ä¸Šä»£ç çš„åˆ†æï¼Œå¯å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š")]),t._v(" "),e("ul",[e("li",[t._v("åœ¨ 32 ä½ç³»ç»Ÿä¸‹ï¼Œuintptr ä¸º uint32 ç±»å‹ï¼Œå ç”¨å¤§å°ä¸º 4 ä¸ªå­—èŠ‚")]),t._v(" "),e("li",[t._v("åœ¨ 64 ä½ç³»ç»Ÿä¸‹ï¼Œuintptr ä¸º uint64 ç±»å‹ï¼Œå ç”¨å¤§å°ä¸º 8 ä¸ªå­—èŠ‚")])]),t._v(" "),e("h3",{attrs:{id:"uintptr-åšäº†ä»€ä¹ˆäº‹"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#uintptr-åšäº†ä»€ä¹ˆäº‹"}},[t._v("#")]),t._v(" ^uintptr åšäº†ä»€ä¹ˆäº‹")]),t._v(" "),e("p",[t._v("^ ä½è¿ç®—ç¬¦çš„ä½œç”¨æ˜¯"),e("strong",[t._v("æŒ‰ä½å¼‚æˆ–")]),t._v("ï¼Œå¦‚ä¸‹ï¼š")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("func main() {\n\tlog.Println(^1)\n\tlog.Println(^uint64(0))\n}\n")])])]),e("p",[t._v("è¾“å‡ºç»“æœï¼š")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("2019/01/05 20:44:49 -2\n2019/01/05 20:44:49 18446744073709551615\n")])])]),e("p",[t._v("æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æä¸€ä¸‹ï¼Œè¿™ä¸¤æ®µä»£ç éƒ½åšäº†ä»€ä¹ˆäº‹æƒ…å‘¢")]),t._v(" "),e("h4",{attrs:{id:"_1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1"}},[t._v("#")]),t._v(" ^1")]),t._v(" "),e("p",[t._v("äºŒè¿›åˆ¶ï¼š0001")]),t._v(" "),e("p",[t._v("æŒ‰ä½å–åï¼š1110")]),t._v(" "),e("p",[t._v("è¯¥æ•°ä¸ºæœ‰ç¬¦å·æ•´æ•°ï¼Œæœ€é«˜ä½ä¸ºç¬¦å·ä½ã€‚ä½ä¸‰ä½ä¸ºè¡¨ç¤ºæ•°å€¼ã€‚æŒ‰ä½å–ååä¸º 1110ï¼Œæ ¹æ®å…ˆå‰çš„è¯´æ˜ï¼Œæœ€é«˜ä½ä¸º 1ï¼Œå› æ­¤è¡¨ç¤ºä¸º -ã€‚å–åå 110 å¯¹åº”åè¿›åˆ¶ -2")]),t._v(" "),e("h4",{attrs:{id:"uint64-0"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#uint64-0"}},[t._v("#")]),t._v(" ^uint64(0)")]),t._v(" "),e("p",[t._v("äºŒè¿›åˆ¶ï¼š0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000")]),t._v(" "),e("p",[t._v("æŒ‰ä½å–åï¼š1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111")]),t._v(" "),e("p",[t._v("è¯¥æ•°ä¸ºæ— ç¬¦å·æ•´æ•°ï¼Œè¯¥ä½å–ååå¾—åˆ°åè¿›åˆ¶å€¼ä¸ºï¼š18446744073709551615")]),t._v(" "),e("p",[t._v("è¿™ä¸ªå€¼æ˜¯ä¸æ˜¯çœ‹èµ·æ¥å¾ˆçœ¼ç†Ÿå‘¢ï¼Ÿæ²¡é”™ï¼Œå°±æ˜¯ "),e("code",[t._v("^uintptr(0)")]),t._v(" çš„å€¼ã€‚ä¹Ÿå°è¯äº†å…¶åº•å±‚æ•°æ®ç±»å‹ä¸º uint64 çš„äº‹å® ï¼ˆæœ¬æœºä¸º 64 ä½ï¼‰ã€‚åŒæ—¶å®ƒåˆä»£è¡¨å¦‚ä¸‹ï¼š")]),t._v(" "),e("ul",[e("li",[t._v("math.MaxUint64")]),t._v(" "),e("li",[t._v("2 çš„ 64 æ¬¡æ–¹å‡ 1")])]),t._v(" "),e("h3",{attrs:{id:"maxalloc"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#maxalloc"}},[t._v("#")]),t._v(" maxAlloc")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("const GoarchMips = 0\nconst GoarchMipsle = 0\nconst GoarchWasm = 0\n\n...\n\n_64bit = 1 << (^uintptr(0) >> 63) / 2\n\nheapAddrBits = (_64bit*(1-sys.GoarchWasm))*48 + (1-_64bit+sys.GoarchWasm)*(32-(sys.GoarchMips+sys.GoarchMipsle))\n\nmaxAlloc = (1 << heapAddrBits) - (1-_64bit)*1\n")])])]),e("p",[e("code",[t._v("maxAlloc")]),t._v(" æ˜¯"),e("strong",[t._v("å…è®¸ç”¨æˆ·åˆ†é…çš„æœ€å¤§è™šæ‹Ÿå†…å­˜ç©ºé—´")]),t._v("ã€‚åœ¨ 64 ä½ï¼Œç†è®ºä¸Šå¯åˆ†é…æœ€å¤§ "),e("code",[t._v("1 << heapAddrBits")]),t._v(" å­—èŠ‚ã€‚åœ¨ 32 ä½ï¼Œæœ€å¤§å¯åˆ†é…å°äº "),e("code",[t._v("1 << 32")]),t._v(" å­—èŠ‚")]),t._v(" "),e("p",[t._v("åœ¨æœ¬æ–‡ï¼Œä»…éœ€äº†è§£å®ƒæ‰¿è½½çš„æ˜¯ä»€ä¹ˆå°±å¥½äº†ã€‚å…·ä½“çš„åœ¨ä»¥åå†…å­˜ç®¡ç†çš„æ–‡ç« å†è®²è¿°")]),t._v(" "),e("p",[t._v("æ³¨ï¼šè¯¥å˜é‡åœ¨ go 10.1 ä¸º "),e("code",[t._v("_MaxMem")]),t._v("ï¼Œgo 11.4 å·²æ”¹ä¸º "),e("code",[t._v("maxAlloc")]),t._v("ã€‚ç›¸å…³çš„ "),e("code",[t._v("heapAddrBits")]),t._v(" è®¡ç®—æ–¹å¼ä¹Ÿæœ‰æ‰€æ”¹å˜")]),t._v(" "),e("h3",{attrs:{id:"maxalloc-typesize"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#maxalloc-typesize"}},[t._v("#")]),t._v(" maxAlloc / typeSize")]),t._v(" "),e("p",[t._v("æˆ‘ä»¬å†æ¬¡å›é¡¾ "),e("code",[t._v("maxSliceCap")]),t._v(" çš„é€»è¾‘ä»£ç ï¼Œè¿™æ¬¡é‡ç‚¹æ”¾åœ¨æ§åˆ¶é€»è¾‘ï¼Œå¦‚ä¸‹ï¼š")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// func makeslice\nmaxElements := maxSliceCap(et.size)\n\n...\n\n// func maxSliceCap\nif elemsize < uintptr(len(maxElems)) {\n\treturn maxElems[elemsize]\n}\nreturn maxAlloc / elemsize\n")])])]),e("p",[t._v("é€šè¿‡è¿™æ®µä»£ç å’Œ Slice ä¸Šä¸‹æ–‡é€»è¾‘ï¼Œå¯å¾—çŸ¥åœ¨æƒ³å¾—åˆ°è¯¥ç±»å‹çš„æœ€å¤§å®¹é‡å¤§å°æ—¶ã€‚ä¼šæ ¹æ®å¯¹åº”çš„ç±»å‹å¤§å°å»æŸ¥æ‰¾è¡¨æŸ¥æ‰¾ç´¢å¼•ï¼ˆç´¢å¼•ä¸ºç±»å‹å¤§å°ï¼Œæ‘†æ”¾é¡ºåºæ˜¯æœ‰è€ƒè™‘åŸå› çš„ï¼‰ã€‚â€œè¿«ä¸å¾—å·²çš„æƒ…å†µä¸‹â€ æ‰ä¼šæ‰‹åŠ¨çš„è®¡ç®—å®ƒçš„å€¼ï¼Œæœ€ç»ˆè®¡ç®—å¾—åˆ°çš„å†…å­˜å­—èŠ‚å¤§å°éƒ½ä¸ºè¯¥ç±»å‹å¤§å°çš„æ•´æ•°å€")]),t._v(" "),e("p",[t._v("æŸ¥æ‰¾è¡¨çš„è®¾ç½®ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªä¼˜åŒ–é€»è¾‘ã€‚å‡å°‘å¸¸ç”¨çš„è®¡ç®—å¼€é”€ ğŸ˜ƒ")]),t._v(" "),e("h2",{attrs:{id:"æ€»ç»“"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[t._v("#")]),t._v(" æ€»ç»“")]),t._v(" "),e("p",[t._v("é€šè¿‡æœ¬æ–‡çš„åˆ†æï¼Œå¯å¾—å‡º Slice æ‰€å…è®¸ç”³è¯·çš„æœ€å¤§å®¹é‡å¤§å°ï¼Œä¸å½“å‰"),e("strong",[t._v("å€¼ç±»å‹")]),t._v("å’Œå½“å‰"),e("strong",[t._v("å¹³å°ä½æ•°")]),t._v("æœ‰ç›´æ¥å…³ç³»")]),t._v(" "),e("h2",{attrs:{id:"æœ€å"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#æœ€å"}},[t._v("#")]),t._v(" æœ€å")]),t._v(" "),e("p",[t._v("æœ¬æ–‡ä¸"),e("a",{attrs:{href:"https://github.com/EDDYCJY/blog/blob/master/golang/pkg/2018-12-15-%E6%9C%89%E7%82%B9%E4%B8%8D%E5%AE%89%E5%85%A8%E5%8D%B4%E5%8F%88%E4%B8%80%E4%BA%AE%E7%9A%84Go-unsafe-Pointer.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("ã€Šæœ‰ç‚¹ä¸å®‰å…¨å´åˆä¸€äº®çš„ Go unsafe.Pointerã€‹"),e("OutboundLink")],1),t._v("ä¸€åŒå±äº"),e("a",{attrs:{href:"https://github.com/EDDYCJY/blog/blob/master/golang/pkg/2018-12-11-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Go-Slice.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("ã€Šæ·±å…¥ç†è§£ Go Sliceã€‹"),e("OutboundLink")],1),t._v("çš„å…³è”ç« èŠ‚ã€‚å¦‚æœä½ åœ¨é˜…è¯»æºç æ—¶ï¼Œå¯¹è¿™äº›ç‰‡æ®µæœ‰ç–‘æƒ‘ã€‚è®°å¾—æƒ³å°½åŠæ³•æ·±ç©¶ä¸‹å»ï¼Œææ‡‚å®ƒ")]),t._v(" "),e("p",[t._v("çŸ­çŸ­çš„ä¸€å¥è¯å…¶å®è•´å«ç€ä¸å°‘çŸ¥è¯†ç‚¹ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« æ°æ°å¥½å¯ä»¥å¸®ä½ è§£æƒ‘")]),t._v(" "),e("p",[t._v("æ³¨ï¼šæœ¬æ–‡ Go ä»£ç åŸºäºç‰ˆæœ¬ 11.4")])])}),[],!1,null,null,null);a.default=s.exports}}]);