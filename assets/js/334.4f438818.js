(window.webpackJsonp=window.webpackJsonp||[]).push([[334],{912:function(t,e,a){"use strict";a.r(e);var n=a(44),r=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_8-2-log-æ ‡å‡†åº“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-log-æ ‡å‡†åº“"}},[t._v("#")]),t._v(" 8.2 log æ ‡å‡†åº“")]),t._v(" "),a("h2",{attrs:{id:"æ—¥å¿—"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ—¥å¿—"}},[t._v("#")]),t._v(" æ—¥å¿—")]),t._v(" "),a("h3",{attrs:{id:"è¾“å‡º"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¾“å‡º"}},[t._v("#")]),t._v(" è¾“å‡º")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("2018/09/28 20:03:08 EDDYCJY Blog...\n")])])]),a("h3",{attrs:{id:"æ„æˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ„æˆ"}},[t._v("#")]),t._v(" æ„æˆ")]),t._v(" "),a("p",[t._v("[æ—¥æœŸ]<ç©ºæ ¼>[æ—¶åˆ†ç§’]<ç©ºæ ¼>[å†…å®¹]<\\n>")]),t._v(" "),a("h2",{attrs:{id:"æºç å‰–æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æºç å‰–æ"}},[t._v("#")]),t._v(" æºç å‰–æ")]),t._v(" "),a("h3",{attrs:{id:"logger"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logger"}},[t._v("#")]),t._v(" Logger")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("type Logger struct {\n\tmu     sync.Mutex \n\tprefix string\n\tflag   int\n\tout    io.Writer\n\tbuf    []byte\n}\n")])])]),a("ol",[a("li",[t._v("muï¼šäº’æ–¥é”ï¼Œç”¨äºç¡®ä¿åŸå­çš„å†™å…¥")]),t._v(" "),a("li",[t._v("prefixï¼šæ¯è¡Œéœ€å†™å…¥çš„æ—¥å¿—å‰ç¼€å†…å®¹")]),t._v(" "),a("li",[t._v("flagï¼šè®¾ç½®æ—¥å¿—è¾…åŠ©ä¿¡æ¯ï¼ˆæ—¶é—´ã€æ–‡ä»¶åã€è¡Œå·ï¼‰çš„å†™å…¥ã€‚å¯é€‰å¦‚ä¸‹æ ‡è¯†ä½ï¼š")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("const (\n\tLdate         = 1 << iota       // value: 1\n\tLtime                           // value: 2\n\tLmicroseconds                   // value: 4\n\tLlongfile                       // value: 8\n\tLshortfile                      // value: 16\n\tLUTC                            // value: 32\n\tLstdFlags     = Ldate | Ltime   // value: 3\n)\n")])])]),a("ul",[a("li",[t._v("Ldateï¼šå½“åœ°æ—¶åŒºçš„æ ¼å¼åŒ–æ—¥æœŸï¼š2009/01/23")]),t._v(" "),a("li",[t._v("Ltimeï¼šå½“åœ°æ—¶åŒºçš„æ ¼å¼åŒ–æ—¶é—´ï¼š01:23:23")]),t._v(" "),a("li",[t._v("Lmicrosecondsï¼šåœ¨ Ltime çš„åŸºç¡€ä¸Šï¼Œå¢åŠ å¾®ç§’çš„æ—¶é—´æ•°å€¼æ˜¾ç¤º")]),t._v(" "),a("li",[t._v("Llongfileï¼šå®Œæ•´çš„æ–‡ä»¶åå’Œè¡Œå·ï¼š/a/b/c/d.go:23")]),t._v(" "),a("li",[t._v("Lshortfileï¼šå½“å‰æ–‡ä»¶åå’Œè¡Œå·ï¼šd.goï¼š23ï¼Œä¼šè¦†ç›– Llongfile æ ‡è¯†")]),t._v(" "),a("li",[t._v("LUTCï¼šå¦‚æœè®¾ç½® Ldate æˆ– Ltimeï¼Œä¸”è®¾ç½® LUTCï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨ UTC æ—¶åŒºè€Œä¸æ˜¯æœ¬åœ°æ—¶åŒº")]),t._v(" "),a("li",[t._v("LstdFlagsï¼šLogger çš„é»˜è®¤åˆå§‹å€¼ï¼ˆLdate å’Œ Ltimeï¼‰")])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("outï¼šio.Writer")]),t._v(" "),a("li",[t._v("bufï¼šç”¨äºå­˜å‚¨å°†è¦å†™å…¥çš„æ—¥å¿—å†…å®¹")])]),t._v(" "),a("h3",{attrs:{id:"new"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#new"}},[t._v("#")]),t._v(" New")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('func New(out io.Writer, prefix string, flag int) *Logger {\n\treturn &Logger{out: out, prefix: prefix, flag: flag}\n}\n\nvar std = New(os.Stderr, "", LstdFlags)\n')])])]),a("p",[t._v("New æ–¹æ³•ç”¨äºåˆå§‹åŒ– Loggerï¼Œæ¥å—ä¸‰ä¸ªåˆå§‹å‚æ•°ï¼Œå¯ä»¥å®šåˆ¶åŒ–è€Œåœ¨ log åŒ…å†…é»˜è®¤ä¼šåˆå§‹ä¸€ä¸ª stdï¼Œå®ƒæŒ‡å‘æ ‡å‡†è¾“å…¥æµã€‚è€Œé»˜è®¤çš„æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯å°±æ˜¯æ˜¾ç¤ºå™¨ï¼ˆè¾“å‡ºåˆ°å±å¹•ä¸Šï¼‰ï¼Œæ ‡å‡†è¾“å…¥å°±æ˜¯é”®ç›˜ã€‚è¾…åŠ©çš„æ—¶é—´ä¿¡æ¯é»˜è®¤ä¸º "),a("code",[t._v("Ldate | Ltime")]),t._v("ï¼Œä¹Ÿå°±æ˜¯ "),a("code",[t._v("2009/01/23 01:23:23")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('// os\nvar (\n\tStdin  = NewFile(uintptr(syscall.Stdin), "/dev/stdin")\n\tStdout = NewFile(uintptr(syscall.Stdout), "/dev/stdout")\n\tStderr = NewFile(uintptr(syscall.Stderr), "/dev/stderr")\n)\n')])])]),a("ul",[a("li",[t._v("Stdinï¼šæ ‡å‡†è¾“å…¥")]),t._v(" "),a("li",[t._v("Stdoutï¼šæ ‡å‡†è¾“å‡º")]),t._v(" "),a("li",[t._v("Stderrï¼šæ ‡å‡†é”™è¯¯")])]),t._v(" "),a("h3",{attrs:{id:"getter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getter"}},[t._v("#")]),t._v(" Getter")]),t._v(" "),a("ul",[a("li",[t._v("Flags")]),t._v(" "),a("li",[t._v("Prefix")])]),t._v(" "),a("h3",{attrs:{id:"setter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setter"}},[t._v("#")]),t._v(" Setter")]),t._v(" "),a("ul",[a("li",[t._v("SetFlags")]),t._v(" "),a("li",[t._v("SetPrefix")]),t._v(" "),a("li",[t._v("SetOutput")])]),t._v(" "),a("h3",{attrs:{id:"print-fatal-panic"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#print-fatal-panic"}},[t._v("#")]),t._v(" Print*, Fatal*, Panic*")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("func Print(v ...interface{}) {\n\tstd.Output(2, fmt.Sprint(v...))\n}\n\nfunc Printf(format string, v ...interface{}) {\n\tstd.Output(2, fmt.Sprintf(format, v...))\n}\n\nfunc Println(v ...interface{}) {\n\tstd.Output(2, fmt.Sprintln(v...))\n}\n\nfunc Fatal(v ...interface{}) {\n\tstd.Output(2, fmt.Sprint(v...))\n\tos.Exit(1)\n}\n\nfunc Panic(v ...interface{}) {\n\ts := fmt.Sprint(v...)\n\tstd.Output(2, s)\n\tpanic(s)\n}\n\n...\n")])])]),a("p",[t._v("è¿™ä¸€éƒ¨åˆ†ä»‹ç»æœ€å¸¸ç”¨çš„æ—¥å¿—å†™å…¥æ–¹æ³•ï¼Œä»æºç å¯å¾—çŸ¥ "),a("code",[t._v("Xrintln")]),t._v("ã€"),a("code",[t._v("Xrintf")]),t._v(" å‡½æ•° "),a("strong",[t._v("æ¢è¡Œ")]),t._v("ã€"),a("strong",[t._v("å¯å˜å‚æ•°")]),t._v("éƒ½æ˜¯é€šè¿‡ "),a("code",[t._v("fmt")]),t._v(" æ ‡å‡†åº“çš„æ–¹æ³•å»å®ç°çš„")]),t._v(" "),a("p",[a("code",[t._v("Fatal")]),t._v(" å’Œ "),a("code",[t._v("Panic")]),t._v(" æ˜¯é€šè¿‡ "),a("code",[t._v("os.Exit(1)")]),t._v("ã€"),a("code",[t._v("panic(s)")]),t._v(" é›†æˆå®ç°çš„ã€‚è€Œå…·ä½“çš„ç»„è£…é€»è¾‘æ˜¯é€šè¿‡ "),a("code",[t._v("Output")]),t._v(" æ–¹æ³•å®ç°çš„")]),t._v(" "),a("h4",{attrs:{id:"logger-output"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logger-output"}},[t._v("#")]),t._v(" Logger.Output")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("func (l *Logger) Output(calldepth int, s string) error {\n\tnow := time.Now() // get this early.\n\tvar file string\n\tvar line int\n\tl.mu.Lock()\n\tdefer l.mu.Unlock()\n\tif l.flag&(Lshortfile|Llongfile) != 0 {\n\t\t// Release lock while getting caller info - it's expensive.\n\t\tl.mu.Unlock()\n\t\tvar ok bool\n\t\t_, file, line, ok = runtime.Caller(calldepth)\n\t\tif !ok {\n\t\t\tfile = \"???\"\n\t\t\tline = 0\n\t\t}\n\t\tl.mu.Lock()\n\t}\n\tl.buf = l.buf[:0]\n\tl.formatHeader(&l.buf, now, file, line)\n\tl.buf = append(l.buf, s...)\n\tif len(s) == 0 || s[len(s)-1] != '\\n' {\n\t\tl.buf = append(l.buf, '\\n')\n\t}\n\t_, err := l.out.Write(l.buf)\n\treturn err\n}\n")])])]),a("p",[t._v("Output æ–¹æ³•ï¼Œç®€å•æ¥è®²å°±æ˜¯å°†å†™å…¥çš„æ—¥å¿—äº‹ä»¶ä¿¡æ¯ç»„è£…å¹¶è¾“å‡ºï¼Œå®ƒä¼šæ ¹æ® flag æ ‡è¯†ä½çš„ä¸åŒæ¥ä½¿ç”¨ "),a("code",[t._v("runtime.Caller")]),t._v(" å»è·å–å½“å‰ goroutine æ‰€æ‰§è¡Œçš„å‡½æ•°æ–‡ä»¶ã€è¡Œå·ç­‰è°ƒç”¨ä¿¡æ¯ï¼ˆlog æ ‡å‡†åº“ä¸­é»˜è®¤æ·±åº¦ä¸º 2ï¼‰ã€‚å¦å¤–å¦‚æœç»“å°¾ä¸æ˜¯æ¢è¡Œç¬¦ "),a("code",[t._v("\\n")]),t._v("ï¼Œå°†è‡ªåŠ¨è¡¥å…¨ä¸€ä¸ªæ¢è¡Œ")]),t._v(" "),a("h4",{attrs:{id:"logger-formatheader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logger-formatheader"}},[t._v("#")]),t._v(" Logger.formatHeader")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("func (l *Logger) formatHeader(buf *[]byte, t time.Time, file string, line int) {\n\t*buf = append(*buf, l.prefix...)\n\tif l.flag&(Ldate|Ltime|Lmicroseconds) != 0 {\n\t\tif l.flag&LUTC != 0 {\n\t\t\tt = t.UTC()\n\t\t}\n\t\tif l.flag&Ldate != 0 {\n\t\t\tyear, month, day := t.Date()\n\t\t\titoa(buf, year, 4)\n\t\t\t*buf = append(*buf, '/')\n\t\t\titoa(buf, int(month), 2)\n\t\t\t*buf = append(*buf, '/')\n\t\t\titoa(buf, day, 2)\n\t\t\t*buf = append(*buf, ' ')\n\t\t}\n\t\tif l.flag&(Ltime|Lmicroseconds) != 0 {\n\t\t\thour, min, sec := t.Clock()\n\t\t\titoa(buf, hour, 2)\n\t\t\t*buf = append(*buf, ':')\n\t\t\titoa(buf, min, 2)\n\t\t\t*buf = append(*buf, ':')\n\t\t\titoa(buf, sec, 2)\n\t\t\tif l.flag&Lmicroseconds != 0 {\n\t\t\t\t*buf = append(*buf, '.')\n\t\t\t\titoa(buf, t.Nanosecond()/1e3, 6)\n\t\t\t}\n\t\t\t*buf = append(*buf, ' ')\n\t\t}\n\t}\n\tif l.flag&(Lshortfile|Llongfile) != 0 {\n\t\tif l.flag&Lshortfile != 0 {\n\t\t\tshort := file\n\t\t\tfor i := len(file) - 1; i > 0; i-- {\n\t\t\t\tif file[i] == '/' {\n\t\t\t\t\tshort = file[i+1:]\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\tfile = short\n\t\t}\n\t\t*buf = append(*buf, file...)\n\t\t*buf = append(*buf, ':')\n\t\titoa(buf, line, -1)\n\t\t*buf = append(*buf, \": \"...)\n\t}\n}\n")])])]),a("p",[t._v("è¯¥æ–¹æ³•ä¸»è¦æ˜¯ç”¨äºæ ¼å¼åŒ–æ—¥å¿—å¤´ï¼ˆå‰ç¼€ï¼‰ï¼Œæ ¹æ®å…¥å‚ä¸åŒçš„æ ‡è¯†ä½ï¼Œæ·»åŠ åˆ†éš”ç¬¦å’Œå¯¹åº”çš„å€¼åˆ°æ—¥å¿—ä¿¡æ¯ä¸­ã€‚æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š")]),t._v(" "),a("p",[t._v("ï¼ˆ1ï¼‰å¦‚æœä¸æ˜¯ç©ºå€¼ï¼Œåˆ™å°† prefix å†™å…¥ buf")]),t._v(" "),a("p",[t._v("ï¼ˆ2ï¼‰å¦‚æœè®¾ç½® "),a("code",[t._v("Ldate")]),t._v("ã€"),a("code",[t._v("Ltime")]),t._v("ã€"),a("code",[t._v("Lmicroseconds")]),t._v("ï¼Œåˆ™å¯¹åº”å°†æ—¥æœŸå’Œæ—¶é—´å†™å…¥ buf")]),t._v(" "),a("p",[t._v("ï¼ˆ3ï¼‰å¦‚æœè®¾ç½® "),a("code",[t._v("Lshortfile")]),t._v("ã€"),a("code",[t._v("Llongfile")]),t._v("ï¼Œåˆ™å¯¹åº”å°†æ–‡ä»¶å’Œè¡Œå·ä¿¡æ¯å†™å…¥ buf")]),t._v(" "),a("h4",{attrs:{id:"logger-itoa"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logger-itoa"}},[t._v("#")]),t._v(" Logger.itoa")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("func itoa(buf *[]byte, i int, wid int) {\n\t// Assemble decimal in reverse order.\n\tvar b [20]byte\n\tbp := len(b) - 1\n\tfor i >= 10 || wid > 1 {\n\t\twid--\n\t\tq := i / 10\n\t\tb[bp] = byte('0' + i - q*10)\n\t\tbp--\n\t\ti = q\n\t}\n\t// i < 10\n\tb[bp] = byte('0' + i)\n\t*buf = append(*buf, b[bp:]...)\n}\n")])])]),a("p",[t._v("è¯¥æ–¹æ³•ä¸»è¦ç”¨äºå°†æ•´æ•°è½¬æ¢ä¸ºå®šé•¿çš„åè¿›åˆ¶ ASCIIï¼ŒåŒæ—¶ç»™å‡ºè´Ÿæ•°å®½åº¦é¿å…å·¦ä¾§è¡¥ 0ã€‚å¦å¤–ä¼šä»¥ç›¸åçš„é¡ºåºç»„åˆåè¿›åˆ¶")]),t._v(" "),a("h3",{attrs:{id:"å¦‚ä½•å®šåˆ¶åŒ–-logger"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•å®šåˆ¶åŒ–-logger"}},[t._v("#")]),t._v(" å¦‚ä½•å®šåˆ¶åŒ– Logger")]),t._v(" "),a("p",[t._v("åœ¨æ ‡å‡†åº“å†…ï¼Œå¯é€šè¿‡å…¶å¼€æ”¾çš„ New æ–¹æ³•æ¥å®ç°å„ç§å„æ ·çš„è‡ªå®šä¹‰ Logger ç»„ä»¶ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¹Ÿå¯ä»¥ç›´æ¥ "),a("code",[t._v("log.Print*")]),t._v(" ç­‰æ–¹æ³•å‘¢ï¼Ÿ")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("func New(out io.Writer, prefix string, flag int) *Logger\n")])])]),a("p",[t._v("å…¶å®æ˜¯åœ¨æ ‡å‡†åº“å†…ï¼Œå¦‚æœä½ åˆšåˆšç»†å¿ƒçš„çœ‹äº†å‰é¢çš„å°èŠ‚ï¼Œä¸éš¾å‘ç°å…¶é»˜è®¤å®ç°äº†ä¸€ä¸ª Logger ç»„ä»¶")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('var std = New(os.Stderr, "", LstdFlags)\n')])])]),a("p",[t._v("è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå°å°çš„ç²¾å¦™ä¹‹å¤„ â­•ï¸")]),t._v(" "),a("h2",{attrs:{id:"æ€»ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[t._v("#")]),t._v(" æ€»ç»“")]),t._v(" "),a("p",[t._v("é€šè¿‡æŸ¥é˜… log æ ‡å‡†åº“çš„æºç ï¼Œå¯å¾—çŸ¥æœ€ç®€å•çš„ä¸€ä¸ªæ—¥å¿—åŒ…åº”è¯¥å¦‚ä½•ç¼–å†™ã€‚å¦å¤– log åŒ…æ˜¯åœ¨æ‰€æœ‰æ¶‰åŠåˆ° Logger çš„åœ°æ–¹éƒ½å¯¹ "),a("code",[t._v("sync.Mutex")]),t._v(" è¿›è¡Œæ“ä½œï¼ˆä»¥æ­¤è§£å†³åŸå­é—®é¢˜ï¼‰ï¼Œå…¶ä½™é€»è¾‘å‡ä¸ºç»„è£…æ—¥å¿—ä¿¡æ¯å’Œè½¬æ¢æ•°å€¼æ ¼å¼ï¼Œè¯¥åŒ…è¾ƒä¸ºç»å…¸ï¼Œå¯ä»¥å¤šè¯»å‡ é ğŸ˜„")]),t._v(" "),a("h2",{attrs:{id:"é—®é¢˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é—®é¢˜"}},[t._v("#")]),t._v(" é—®é¢˜")]),t._v(" "),a("p",[t._v("ä¸ºä»€ä¹ˆåœ¨è°ƒç”¨ "),a("code",[t._v("runtime.Caller")]),t._v(" å‰è¦å…ˆè§£é”ï¼Œåå†åŠ é”å‘¢?")])])}),[],!1,null,null,null);e.default=r.exports}}]);