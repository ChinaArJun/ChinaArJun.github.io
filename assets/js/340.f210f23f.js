(window.webpackJsonp=window.webpackJsonp||[]).push([[340],{918:function(t,e,a){"use strict";a.r(e);var i=a(44),r=Object(i.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_9-2-爬取汽车之家-二手车产品库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-爬取汽车之家-二手车产品库"}},[t._v("#")]),t._v(" 9.2 爬取汽车之家 二手车产品库")]),t._v(" "),a("p",[t._v("项目地址：https://github.com/go-crawler/car-prices")]),t._v(" "),a("h2",{attrs:{id:"目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目标"}},[t._v("#")]),t._v(" 目标")]),t._v(" "),a("p",[t._v("最近经常有人在耳边提起汽车之家，也好奇二手车在国内的价格是怎么样的，因此本次的目标站点是 "),a("a",{attrs:{href:"https://car.autohome.com.cn/2sc/440399/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("汽车之家"),a("OutboundLink")],1),t._v(" 的二手车产品库")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/03/30/5abe47f82a01f.png",alt:"image"}})]),t._v(" "),a("p",[t._v("分析目标源：")]),t._v(" "),a("ul",[a("li",[t._v("一页共24条")]),t._v(" "),a("li",[t._v("含分页，但这个老产品库，在100页后会存在问题，因此我们爬取99页")]),t._v(" "),a("li",[t._v("可以获取全部城市")]),t._v(" "),a("li",[t._v("共可爬取 19w+ 数据")])]),t._v(" "),a("h2",{attrs:{id:"开始"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始"}},[t._v("#")]),t._v(" 开始")]),t._v(" "),a("p",[t._v("爬取步骤")]),t._v(" "),a("ul",[a("li",[t._v("获取全部的城市")]),t._v(" "),a("li",[t._v("拼装全部城市URL入队列")]),t._v(" "),a("li",[t._v("解析二手车页面结构")]),t._v(" "),a("li",[t._v("下一页URL入队列")]),t._v(" "),a("li",[t._v("循环拉取所有分页的二手车数据")]),t._v(" "),a("li",[t._v("循环拉取队列中城市的二手车数据")]),t._v(" "),a("li",[t._v("等待，确定队列中无新的 URL")]),t._v(" "),a("li",[t._v("爬取的二手车数据入库")])]),t._v(" "),a("h3",{attrs:{id:"获取城市"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取城市"}},[t._v("#")]),t._v(" 获取城市")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/03/31/5abeff11ef583.png",alt:"image"}})]),t._v(" "),a("p",[t._v("通过页面查看，可发现在城市筛选区可得到全部的二手车城市列表，但是你仔细查阅代码。会发现它是JS加载进来的，城市也统一放在了一个变量中")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/03/31/5abf056389cf0.png",alt:"image"}})]),t._v(" "),a("p",[t._v("有两种提取方法")]),t._v(" "),a("ul",[a("li",[t._v("分析JS变量，提取出来")]),t._v(" "),a("li",[t._v("直接将 "),a("code",[t._v("areaJson")]),t._v(" 复制出来作为变量解析")])]),t._v(" "),a("p",[t._v("在这里我们直接将其复制粘贴出来即可，因为这是比较少变动的值")]),t._v(" "),a("h3",{attrs:{id:"获取分页"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取分页"}},[t._v("#")]),t._v(" 获取分页")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/03/31/5abf08ec812e2.png",alt:"image"}})]),t._v(" "),a("p",[t._v("通过分析页面可以得知分页链接是有一定规律的，例如："),a("code",[t._v("/2sc/hangzhou/a0_0msdgscncgpi1ltocsp2exb4/")]),t._v("，可以发现 "),a("code",[t._v("sp%d")]),t._v("，"),a("code",[t._v("sp")]),t._v(" 后面为页码")]),t._v(" "),a("p",[t._v("按照常理，可以通过预测所有分页链接，推入队列后 "),a("code",[t._v("go routine")]),t._v(" 一波 即可快速拉取")]),t._v(" "),a("p",[t._v("但是在这老产品库存在一个问题，在超过 100 页后，下一页永远是 101 页")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/03/31/5abf0e1e623ec.png",alt:"image"}})]),t._v(" "),a("p",[t._v("因此我们采取比较传统的做法，通过拉取下一页的链接去访问，以便适应可能的分页链接改变； 100 页以后的分页展示也很奇怪，先忽视")]),t._v(" "),a("h3",{attrs:{id:"获取二手车数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取二手车数据"}},[t._v("#")]),t._v(" 获取二手车数据")]),t._v(" "),a("p",[t._v("页面结构较为固定，常规的清洗 HTML 即可")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('func GetCars(doc *goquery.Document) (cars []QcCar) {\n\tcityName := GetCityName(doc)\n\tdoc.Find(".piclist ul li:not(.line)").Each(func(i int, selection *goquery.Selection) {\n\t\ttitle := selection.Find(".title a").Text()\n\t\tprice := selection.Find(".detail .detail-r").Find(".colf8").Text()\n\t\tkilometer := selection.Find(".detail .detail-l").Find("p").Eq(0).Text()\n\t\tyear := selection.Find(".detail .detail-l").Find("p").Eq(1).Text()\n\n\t\tkilometer = strings.Join(compileNumber.FindAllString(kilometer, -1), "")\n\t\tyear = strings.Join(compileNumber.FindAllString(strings.TrimSpace(year), -1), "")\n\t\tpriceS, _ := strconv.ParseFloat(price, 64)\n\t\tkilometerS, _ := strconv.ParseFloat(kilometer, 64)\n\t\tyearS, _ := strconv.Atoi(year)\n\n\t\tcars = append(cars, QcCar{\n\t\t\tCityName: cityName,\n\t\t\tTitle: title,\n\t\t\tPrice: priceS,\n\t\t\tKilometer: kilometerS,\n\t\t\tYear: yearS,\n\t\t})\n\t})\n\n\treturn cars\n}\n')])])]),a("h2",{attrs:{id:"数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据"}},[t._v("#")]),t._v(" 数据")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/03/31/5abf1d8042196.png",alt:"image"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/04/01/5abfbaa14b09c.png",alt:"image"}})]),t._v(" "),a("p",[t._v("在各城市的平均价格对比中，我们可以发现北上广深里的北京、上海、深圳都在榜单上，而近年势头较猛的杭州直接占领了榜首，且后几名都有一些距离")]),t._v(" "),a("p",[t._v("而其他城市大致都是梯级下降的趋势，看来一线城市的二手车也是不便宜了，当然这只是均价")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/03/31/5abf1dbc665f2.png",alt:"image"}})]),t._v(" "),a("p",[t._v("我们可以看到价格和公里数的对比，上海、成都、郑州的等比差异是有点大，感觉有需求的话可以在价格和公里数上做一个衡量")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/03/31/5abf1e1434edc.png",alt:"image"}})]),t._v(" "),a("p",[t._v("这图有点儿有趣，粗略的统计了一下总公里数。在前几张图里，平均价格排名较高的统统没有出现在这里，反倒是呼和浩特、大庆、中山等出现在了榜首")]),t._v(" "),a("p",[t._v("是否侧面反应了一线城市的车辆更新换代较快，而较后的城市的车辆倒是换代较慢，公里数基本都杠杠的")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2018/03/31/5abf1e4936640.png",alt:"image"}})]),t._v(" "),a("p",[t._v("通过对标题的分析，可以得知车辆产品库的命名基本都是品牌名称+自动/手动+XXXX款+属性，看标题就能知道个概况了")]),t._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("h3",{attrs:{id:"爬虫项目地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#爬虫项目地址"}},[t._v("#")]),t._v(" 爬虫项目地址")]),t._v(" "),a("ul",[a("li",[t._v("https://github.com/go-crawler/car-prices")])])])}),[],!1,null,null,null);e.default=r.exports}}]);