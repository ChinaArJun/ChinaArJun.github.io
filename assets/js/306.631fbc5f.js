(window.webpackJsonp=window.webpackJsonp||[]).push([[306],{884:function(e,t,n){"use strict";n.r(t);var a=n(44),i=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"ginæ­å»ºblog-api-s-ï¼ˆä¸‰ï¼‰"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ginæ­å»ºblog-api-s-ï¼ˆä¸‰ï¼‰"}},[e._v("#")]),e._v(" Ginæ­å»ºBlog API's ï¼ˆä¸‰ï¼‰")]),e._v(" "),n("p",[e._v("é¡¹ç›®åœ°å€ï¼šhttps://github.com/EDDYCJY/go-gin-example")]),e._v(" "),n("h2",{attrs:{id:"æ¶‰åŠçŸ¥è¯†ç‚¹"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ¶‰åŠçŸ¥è¯†ç‚¹"}},[e._v("#")]),e._v(" æ¶‰åŠçŸ¥è¯†ç‚¹")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/gin-gonic/gin",target:"_blank",rel:"noopener noreferrer"}},[e._v("Gin"),n("OutboundLink")],1),e._v("ï¼šGolangçš„ä¸€ä¸ªå¾®æ¡†æ¶ï¼Œæ€§èƒ½æä½³ã€‚")]),e._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/astaxie/beego/tree/master/validation",target:"_blank",rel:"noopener noreferrer"}},[e._v("beego-validation"),n("OutboundLink")],1),e._v("ï¼šæœ¬èŠ‚é‡‡ç”¨çš„beegoçš„è¡¨å•éªŒè¯åº“ï¼Œ"),n("a",{attrs:{href:"https://beego.me/docs/mvc/controller/validation.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("ä¸­æ–‡æ–‡æ¡£"),n("OutboundLink")],1),e._v("ã€‚")]),e._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/jinzhu/gorm",target:"_blank",rel:"noopener noreferrer"}},[e._v("gorm"),n("OutboundLink")],1),e._v("ï¼Œå¯¹å¼€å‘äººå‘˜å‹å¥½çš„ORMæ¡†æ¶ï¼Œ"),n("a",{attrs:{href:"http://gorm.io/docs/",target:"_blank",rel:"noopener noreferrer"}},[e._v("è‹±æ–‡æ–‡æ¡£"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/Unknwon/com",target:"_blank",rel:"noopener noreferrer"}},[e._v("com"),n("OutboundLink")],1),e._v("ï¼Œä¸€ä¸ªå°è€Œç¾çš„å·¥å…·åŒ…ã€‚")])]),e._v(" "),n("h2",{attrs:{id:"æœ¬æ–‡ç›®æ ‡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æœ¬æ–‡ç›®æ ‡"}},[e._v("#")]),e._v(" æœ¬æ–‡ç›®æ ‡")]),e._v(" "),n("ul",[n("li",[e._v("å®Œæˆåšå®¢çš„æ–‡ç« ç±»æ¥å£å®šä¹‰å’Œç¼–å†™")])]),e._v(" "),n("h2",{attrs:{id:"å®šä¹‰æ¥å£"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å®šä¹‰æ¥å£"}},[e._v("#")]),e._v(" å®šä¹‰æ¥å£")]),e._v(" "),n("p",[e._v("æœ¬èŠ‚ç¼–å†™æ–‡ç« çš„é€»è¾‘ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸‹æ¥å£å§ï¼")]),e._v(" "),n("ul",[n("li",[e._v('è·å–æ–‡ç« åˆ—è¡¨ï¼šGET("/articles")')]),e._v(" "),n("li",[e._v('è·å–æŒ‡å®šæ–‡ç« ï¼šPOST("/articles/:id")')]),e._v(" "),n("li",[e._v('æ–°å»ºæ–‡ç« ï¼šPOST("/articles")')]),e._v(" "),n("li",[e._v('æ›´æ–°æŒ‡å®šæ–‡ç« ï¼šPUT("/articles/:id")')]),e._v(" "),n("li",[e._v('åˆ é™¤æŒ‡å®šæ–‡ç« ï¼šDELETE("/articles/:id")')])]),e._v(" "),n("h2",{attrs:{id:"ç¼–å†™è·¯ç”±é€»è¾‘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ç¼–å†™è·¯ç”±é€»è¾‘"}},[e._v("#")]),e._v(" ç¼–å†™è·¯ç”±é€»è¾‘")]),e._v(" "),n("p",[e._v("åœ¨"),n("code",[e._v("routers")]),e._v("çš„v1ç‰ˆæœ¬ä¸‹ï¼Œæ–°å»º"),n("code",[e._v("article.go")]),e._v("æ–‡ä»¶ï¼Œå†™å…¥å†…å®¹ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('package v1\n\nimport (\n\t"github.com/gin-gonic/gin"\n)\n\n//è·å–å•ä¸ªæ–‡ç« \nfunc GetArticle(c *gin.Context) {\n}\n\n//è·å–å¤šä¸ªæ–‡ç« \nfunc GetArticles(c *gin.Context) {\n}\n\n//æ–°å¢æ–‡ç« \nfunc AddArticle(c *gin.Context) {\n}\n\n//ä¿®æ”¹æ–‡ç« \nfunc EditArticle(c *gin.Context) {\n}\n\n//åˆ é™¤æ–‡ç« \nfunc DeleteArticle(c *gin.Context) {\n}\n')])])]),n("p",[e._v("æˆ‘ä»¬æ‰“å¼€"),n("code",[e._v("routers")]),e._v("ä¸‹çš„"),n("code",[e._v("router.go")]),e._v("æ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶å†…å®¹ä¸ºï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('package routers\n\nimport (\n    "github.com/gin-gonic/gin"\n    \n    "github.com/EDDYCJY/go-gin-example/routers/api/v1"\n    "github.com/EDDYCJY/go-gin-example/pkg/setting"\n)\n\nfunc InitRouter() *gin.Engine {\n    ...\n    apiv1 := r.Group("/api/v1")\n    {\n        ...\n        //è·å–æ–‡ç« åˆ—è¡¨\n        apiv1.GET("/articles", v1.GetArticles)\n        //è·å–æŒ‡å®šæ–‡ç« \n        apiv1.GET("/articles/:id", v1.GetArticle)\n        //æ–°å»ºæ–‡ç« \n        apiv1.POST("/articles", v1.AddArticle)\n        //æ›´æ–°æŒ‡å®šæ–‡ç« \n        apiv1.PUT("/articles/:id", v1.EditArticle)\n        //åˆ é™¤æŒ‡å®šæ–‡ç« \n        apiv1.DELETE("/articles/:id", v1.DeleteArticle)\n    }\n\n    return r\n}\n')])])]),n("p",[e._v("å½“å‰ç›®å½•ç»“æ„ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("go-gin-example/\nâ”œâ”€â”€ conf\nâ”‚Â Â  â””â”€â”€ app.ini\nâ”œâ”€â”€ main.go\nâ”œâ”€â”€ middleware\nâ”œâ”€â”€ models\nâ”‚Â Â  â”œâ”€â”€ models.go\nâ”‚Â Â  â””â”€â”€ tag.go\nâ”œâ”€â”€ pkg\nâ”‚Â Â  â”œâ”€â”€ e\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ code.go\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ msg.go\nâ”‚Â Â  â”œâ”€â”€ setting\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ setting.go\nâ”‚Â Â  â””â”€â”€ util\nâ”‚Â Â      â””â”€â”€ pagination.go\nâ”œâ”€â”€ routers\nâ”‚Â Â  â”œâ”€â”€ api\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ v1\nâ”‚Â Â  â”‚Â Â      â”œâ”€â”€ article.go\nâ”‚Â Â  â”‚Â Â      â””â”€â”€ tag.go\nâ”‚Â Â  â””â”€â”€ router.go\nâ”œâ”€â”€ runtime\n\n")])])]),n("p",[e._v("åœ¨åŸºç¡€çš„è·¯ç”±è§„åˆ™é…ç½®ç»“æŸåï¼Œæˆ‘ä»¬"),n("strong",[e._v("å¼€å§‹ç¼–å†™æˆ‘ä»¬çš„æ¥å£")]),e._v("å§ï¼")]),e._v(" "),n("hr"),e._v(" "),n("p",[e._v("##ç¼–å†™modelsé€»è¾‘\nåˆ›å»º"),n("code",[e._v("models")]),e._v("ç›®å½•ä¸‹çš„"),n("code",[e._v("article.go")]),e._v("ï¼Œå†™å…¥æ–‡ä»¶å†…å®¹ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('package models\n\nimport (\n\t"github.com/jinzhu/gorm"\n\n\t"time"\n)\n\ntype Article struct {\n\tModel\n\n\tTagID int `json:"tag_id" gorm:"index"`\n\tTag   Tag `json:"tag"`\n\n\tTitle string `json:"title"`\n\tDesc string `json:"desc"`\n\tContent string `json:"content"`\n\tCreatedBy string `json:"created_by"`\n\tModifiedBy string `json:"modified_by"`\n\tState int `json:"state"`\n}\n\n\nfunc (article *Article) BeforeCreate(scope *gorm.Scope) error {\n    scope.SetColumn("CreatedOn", time.Now().Unix())\n\n    return nil\n}\n\nfunc (article *Article) BeforeUpdate(scope *gorm.Scope) error {\n\tscope.SetColumn("ModifiedOn", time.Now().Unix())\n\n\treturn nil\n}\n')])])]),n("p",[e._v("æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª"),n("code",[e._v("Article struct {}")]),e._v("ï¼Œä¸"),n("code",[e._v("Tag")]),e._v("ä¸åŒçš„æ˜¯ï¼Œ"),n("code",[e._v("Article")]),e._v("å¤šäº†å‡ é¡¹ï¼Œå¦‚ä¸‹ï¼š")]),e._v(" "),n("ol",[n("li",[n("code",[e._v("gorm:index")]),e._v("ï¼Œç”¨äºå£°æ˜è¿™ä¸ªå­—æ®µä¸ºç´¢å¼•ï¼Œå¦‚æœä½ ä½¿ç”¨äº†è‡ªåŠ¨è¿ç§»åŠŸèƒ½åˆ™ä¼šæœ‰æ‰€å½±å“ï¼Œåœ¨ä¸ä½¿ç”¨åˆ™æ— å½±å“")]),e._v(" "),n("li",[n("code",[e._v("Tag")]),e._v("å­—æ®µï¼Œå®é™…æ˜¯ä¸€ä¸ªåµŒå¥—çš„"),n("code",[e._v("struct")]),e._v("ï¼Œå®ƒåˆ©ç”¨"),n("code",[e._v("TagID")]),e._v("ä¸"),n("code",[e._v("Tag")]),e._v("æ¨¡å‹ç›¸äº’å…³è”ï¼Œåœ¨æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œèƒ½å¤Ÿè¾¾åˆ°"),n("code",[e._v("Article")]),e._v("ã€"),n("code",[e._v("Tag")]),e._v("å…³è”æŸ¥è¯¢çš„åŠŸèƒ½")]),e._v(" "),n("li",[n("code",[e._v("time.Now().Unix()")]),e._v(" è¿”å›å½“å‰çš„æ—¶é—´æˆ³")])]),e._v(" "),n("p",[e._v("æ¥ä¸‹æ¥ï¼Œè¯·ç¡®ä¿å·²å¯¹ä¸Šä¸€ç« èŠ‚çš„å†…å®¹é€šè¯»ä¸”äº†è§£ï¼Œç”±äºé€»è¾‘åå·®ä¸ä¼šå¤ªè¿œï¼Œæˆ‘ä»¬æœ¬èŠ‚ç›´æ¥ç¼–å†™è¿™äº”ä¸ªæ¥å£")]),e._v(" "),n("hr"),e._v(" "),n("p",[e._v("æ‰“å¼€"),n("code",[e._v("models")]),e._v("ç›®å½•ä¸‹çš„"),n("code",[e._v("article.go")]),e._v("ï¼Œä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('package models\n\nimport (\n\t"time"\n\n\t"github.com/jinzhu/gorm"\n)\n\ntype Article struct {\n\tModel\n\n\tTagID int `json:"tag_id" gorm:"index"`\n\tTag   Tag `json:"tag"`\n\n\tTitle string `json:"title"`\n\tDesc string `json:"desc"`\n\tContent string `json:"content"`\n\tCreatedBy string `json:"created_by"`\n\tModifiedBy string `json:"modified_by"`\n\tState int `json:"state"`\n}\n\n\nfunc ExistArticleByID(id int) bool {\n\tvar article Article\n\tdb.Select("id").Where("id = ?", id).First(&article)\n\n\tif article.ID > 0 {\n\t\treturn true\n\t}\n\n\treturn false\n}\n\nfunc GetArticleTotal(maps interface {}) (count int){\n\tdb.Model(&Article{}).Where(maps).Count(&count)\n\n\treturn\n}\n\nfunc GetArticles(pageNum int, pageSize int, maps interface {}) (articles []Article) {\n\tdb.Preload("Tag").Where(maps).Offset(pageNum).Limit(pageSize).Find(&articles)\n\n\treturn\n}\n\nfunc GetArticle(id int) (article Article) {\n\tdb.Where("id = ?", id).First(&article)\n\tdb.Model(&article).Related(&article.Tag)\n\n\treturn \n}\n\nfunc EditArticle(id int, data interface {}) bool {\n\tdb.Model(&Article{}).Where("id = ?", id).Updates(data)\n\n\treturn true\n}\n\nfunc AddArticle(data map[string]interface {}) bool {\n\tdb.Create(&Article {\n\t\tTagID : data["tag_id"].(int),\n\t\tTitle : data["title"].(string),\n\t\tDesc : data["desc"].(string),\n\t\tContent : data["content"].(string),\n\t\tCreatedBy : data["created_by"].(string),\n\t\tState : data["state"].(int),\n\t})\n\n\treturn true\n}\n\nfunc DeleteArticle(id int) bool {\n\tdb.Where("id = ?", id).Delete(Article{})\n\n\treturn true\n}\n\nfunc (article *Article) BeforeCreate(scope *gorm.Scope) error {\n    scope.SetColumn("CreatedOn", time.Now().Unix())\n\n    return nil\n}\n\nfunc (article *Article) BeforeUpdate(scope *gorm.Scope) error {\n\tscope.SetColumn("ModifiedOn", time.Now().Unix())\n\n\treturn nil\n}\n')])])]),n("p",[e._v("åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ‹¿å‡ºä¸‰ç‚¹ä¸åŒæ¥è®²ï¼Œå¦‚ä¸‹ï¼š")]),e._v(" "),n("p",[n("strong",[e._v("1ã€ æˆ‘ä»¬çš„"),n("code",[e._v("Article")]),e._v("æ˜¯å¦‚ä½•å…³è”åˆ°"),n("code",[e._v("Tag")]),e._v("ï¼Ÿ")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('func GetArticle(id int) (article Article) {\n\tdb.Where("id = ?", id).First(&article)\n\tdb.Model(&article).Related(&article.Tag)\n\n\treturn \n}\n')])])]),n("p",[e._v("èƒ½å¤Ÿè¾¾åˆ°å…³è”ï¼Œé¦–å…ˆæ˜¯"),n("code",[e._v("gorm")]),e._v("æœ¬èº«åšäº†å¤§é‡çš„çº¦å®šä¿—æˆ")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("Article")]),e._v("æœ‰ä¸€ä¸ªç»“æ„ä½“æˆå‘˜æ˜¯"),n("code",[e._v("TagID")]),e._v("ï¼Œå°±æ˜¯å¤–é”®ã€‚"),n("code",[e._v("gorm")]),e._v("ä¼šé€šè¿‡ç±»å+IDçš„æ–¹å¼å»æ‰¾åˆ°è¿™ä¸¤ä¸ªç±»ä¹‹é—´çš„å…³è”å…³ç³»")]),e._v(" "),n("li",[n("code",[e._v("Article")]),e._v("æœ‰ä¸€ä¸ªç»“æ„ä½“æˆå‘˜æ˜¯"),n("code",[e._v("Tag")]),e._v("ï¼Œå°±æ˜¯æˆ‘ä»¬åµŒå¥—åœ¨"),n("code",[e._v("Article")]),e._v("é‡Œçš„"),n("code",[e._v("Tag")]),e._v("ç»“æ„ä½“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡"),n("code",[e._v("Related")]),e._v("è¿›è¡Œå…³è”æŸ¥è¯¢")])]),e._v(" "),n("p",[n("strong",[e._v("2ã€ "),n("code",[e._v("Preload")]),e._v("æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œä¸ºä»€ä¹ˆæŸ¥è¯¢å¯ä»¥å¾—å‡ºæ¯ä¸€é¡¹çš„å…³è”"),n("code",[e._v("Tag")]),e._v("ï¼Ÿ")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('func GetArticles(pageNum int, pageSize int, maps interface {}) (articles []Article) {\n\tdb.Preload("Tag").Where(maps).Offset(pageNum).Limit(pageSize).Find(&articles)\n\n\treturn\n}\n')])])]),n("p",[n("code",[e._v("Preload")]),e._v("å°±æ˜¯ä¸€ä¸ªé¢„åŠ è½½å™¨ï¼Œå®ƒä¼šæ‰§è¡Œä¸¤æ¡SQLï¼Œåˆ†åˆ«æ˜¯"),n("code",[e._v("SELECT * FROM blog_articles;")]),e._v("å’Œ"),n("code",[e._v("SELECT * FROM blog_tag WHERE id IN (1,2,3,4);")]),e._v("ï¼Œé‚£ä¹ˆåœ¨æŸ¥è¯¢å‡ºç»“æ„åï¼Œ"),n("code",[e._v("gorm")]),e._v("å†…éƒ¨å¤„ç†å¯¹åº”çš„æ˜ å°„é€»è¾‘ï¼Œå°†å…¶å¡«å……åˆ°"),n("code",[e._v("Article")]),e._v("çš„"),n("code",[e._v("Tag")]),e._v("ä¸­ï¼Œä¼šç‰¹åˆ«æ–¹ä¾¿ï¼Œå¹¶ä¸”é¿å…äº†å¾ªç¯æŸ¥è¯¢")]),e._v(" "),n("p",[e._v("é‚£ä¹ˆæœ‰æ²¡æœ‰åˆ«çš„åŠæ³•å‘¢ï¼Œå¤§è‡´æ˜¯ä¸¤ç§")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("gorm")]),e._v("çš„"),n("code",[e._v("Join")])]),e._v(" "),n("li",[e._v("å¾ªç¯"),n("code",[e._v("Related")])])]),e._v(" "),n("p",[e._v("ç»¼åˆä¹‹ä¸‹ï¼Œè¿˜æ˜¯"),n("code",[e._v("Preload")]),e._v("æ›´å¥½ï¼Œå¦‚æœä½ æœ‰æ›´ä¼˜çš„æ–¹æ¡ˆï¼Œæ¬¢è¿è¯´ä¸€ä¸‹ ğŸ˜ƒ")]),e._v(" "),n("p",[n("strong",[e._v("3ã€ "),n("code",[e._v("v.(I)")]),e._v(" æ˜¯ä»€ä¹ˆï¼Ÿ")])]),e._v(" "),n("p",[n("code",[e._v("v")]),e._v("è¡¨ç¤ºä¸€ä¸ªæ¥å£å€¼ï¼Œ"),n("code",[e._v("I")]),e._v("è¡¨ç¤ºæ¥å£ç±»å‹ã€‚è¿™ä¸ªå®é™…å°±æ˜¯Golangä¸­çš„"),n("strong",[e._v("ç±»å‹æ–­è¨€")]),e._v("ï¼Œç”¨äºåˆ¤æ–­ä¸€ä¸ªæ¥å£å€¼çš„å®é™…ç±»å‹æ˜¯å¦ä¸ºæŸä¸ªç±»å‹ï¼Œæˆ–ä¸€ä¸ªéæ¥å£å€¼çš„ç±»å‹æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£ç±»å‹")]),e._v(" "),n("hr"),e._v(" "),n("p",[e._v("æ‰“å¼€"),n("code",[e._v("routers")]),e._v("ç›®å½•ä¸‹v1ç‰ˆæœ¬çš„"),n("code",[e._v("article.go")]),e._v("æ–‡ä»¶ï¼Œä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('package v1\n\nimport (\n\t"net/http"\n\t"log"\n\n\t"github.com/gin-gonic/gin"\n\t"github.com/astaxie/beego/validation"\n\t"github.com/unknwon/com"\n\n\t"github.com/EDDYCJY/go-gin-example/models"\n\t"github.com/EDDYCJY/go-gin-example/pkg/e"\n\t"github.com/EDDYCJY/go-gin-example/pkg/setting"\n\t"github.com/EDDYCJY/go-gin-example/pkg/util"\n)\n\n//è·å–å•ä¸ªæ–‡ç« \nfunc GetArticle(c *gin.Context) {\n    id := com.StrTo(c.Param("id")).MustInt()\n\n    valid := validation.Validation{}\n    valid.Min(id, 1, "id").Message("IDå¿…é¡»å¤§äº0")\n\n    code := e.INVALID_PARAMS\n    var data interface {}\n    if ! valid.HasErrors() {\n        if models.ExistArticleByID(id) {\n            data = models.GetArticle(id)\n            code = e.SUCCESS\n        } else {\n            code = e.ERROR_NOT_EXIST_ARTICLE\n        }\n    } else {\n        for _, err := range valid.Errors {\n            log.Printf("err.key: %s, err.message: %s", err.Key, err.Message)\n        }\n    }\n\n    c.JSON(http.StatusOK, gin.H{\n        "code" : code,\n        "msg" : e.GetMsg(code),\n        "data" : data,\n    })\n}\n\n//è·å–å¤šä¸ªæ–‡ç« \nfunc GetArticles(c *gin.Context) {\n    data := make(map[string]interface{})\n    maps := make(map[string]interface{})\n    valid := validation.Validation{}\n\n    var state int = -1\n    if arg := c.Query("state"); arg != "" {\n        state = com.StrTo(arg).MustInt()\n        maps["state"] = state\n\n        valid.Range(state, 0, 1, "state").Message("çŠ¶æ€åªå…è®¸0æˆ–1")\n    }\n\n    var tagId int = -1\n    if arg := c.Query("tag_id"); arg != "" {\n        tagId = com.StrTo(arg).MustInt()\n        maps["tag_id"] = tagId\n\n        valid.Min(tagId, 1, "tag_id").Message("æ ‡ç­¾IDå¿…é¡»å¤§äº0")\n    } \n\n    code := e.INVALID_PARAMS\n    if ! valid.HasErrors() {\n        code = e.SUCCESS\n\n        data["lists"] = models.GetArticles(util.GetPage(c), setting.PageSize, maps)\n        data["total"] = models.GetArticleTotal(maps)\n\n    } else {\n        for _, err := range valid.Errors {\n            log.Printf("err.key: %s, err.message: %s", err.Key, err.Message)\n        }\n    }\n\n    c.JSON(http.StatusOK, gin.H{\n        "code" : code,\n        "msg" : e.GetMsg(code),\n        "data" : data,\n    })\n}\n\n//æ–°å¢æ–‡ç« \nfunc AddArticle(c *gin.Context) {\n    tagId := com.StrTo(c.Query("tag_id")).MustInt()\n    title := c.Query("title")\n    desc := c.Query("desc")\n    content := c.Query("content")\n    createdBy := c.Query("created_by")\n    state := com.StrTo(c.DefaultQuery("state", "0")).MustInt()\n\n    valid := validation.Validation{}\n    valid.Min(tagId, 1, "tag_id").Message("æ ‡ç­¾IDå¿…é¡»å¤§äº0")\n    valid.Required(title, "title").Message("æ ‡é¢˜ä¸èƒ½ä¸ºç©º")\n    valid.Required(desc, "desc").Message("ç®€è¿°ä¸èƒ½ä¸ºç©º")\n    valid.Required(content, "content").Message("å†…å®¹ä¸èƒ½ä¸ºç©º")\n    valid.Required(createdBy, "created_by").Message("åˆ›å»ºäººä¸èƒ½ä¸ºç©º")\n    valid.Range(state, 0, 1, "state").Message("çŠ¶æ€åªå…è®¸0æˆ–1")\n\n    code := e.INVALID_PARAMS\n    if ! valid.HasErrors() {\n        if models.ExistTagByID(tagId) {\n            data := make(map[string]interface {})\n            data["tag_id"] = tagId\n            data["title"] = title\n            data["desc"] = desc\n            data["content"] = content\n            data["created_by"] = createdBy\n            data["state"] = state\n            \n            models.AddArticle(data)\n            code = e.SUCCESS\n        } else {\n            code = e.ERROR_NOT_EXIST_TAG\n        }\n    } else {\n        for _, err := range valid.Errors {\n            log.Printf("err.key: %s, err.message: %s", err.Key, err.Message)\n        }\n    }\n\n    c.JSON(http.StatusOK, gin.H{\n        "code" : code,\n        "msg" : e.GetMsg(code),\n        "data" : make(map[string]interface{}),\n    })\n}\n\n//ä¿®æ”¹æ–‡ç« \nfunc EditArticle(c *gin.Context) {\n    valid := validation.Validation{}\n\n    id := com.StrTo(c.Param("id")).MustInt()\n    tagId := com.StrTo(c.Query("tag_id")).MustInt()\n    title := c.Query("title")\n    desc := c.Query("desc")\n    content := c.Query("content")\n    modifiedBy := c.Query("modified_by")\n\n    var state int = -1\n    if arg := c.Query("state"); arg != "" {\n        state = com.StrTo(arg).MustInt()\n        valid.Range(state, 0, 1, "state").Message("çŠ¶æ€åªå…è®¸0æˆ–1")\n    }\n\n    valid.Min(id, 1, "id").Message("IDå¿…é¡»å¤§äº0")\n    valid.MaxSize(title, 100, "title").Message("æ ‡é¢˜æœ€é•¿ä¸º100å­—ç¬¦")\n    valid.MaxSize(desc, 255, "desc").Message("ç®€è¿°æœ€é•¿ä¸º255å­—ç¬¦")\n    valid.MaxSize(content, 65535, "content").Message("å†…å®¹æœ€é•¿ä¸º65535å­—ç¬¦")\n    valid.Required(modifiedBy, "modified_by").Message("ä¿®æ”¹äººä¸èƒ½ä¸ºç©º")\n    valid.MaxSize(modifiedBy, 100, "modified_by").Message("ä¿®æ”¹äººæœ€é•¿ä¸º100å­—ç¬¦")\n\n    code := e.INVALID_PARAMS\n    if ! valid.HasErrors() {\n        if models.ExistArticleByID(id) {\n            if models.ExistTagByID(tagId) {\n                data := make(map[string]interface {})\n                if tagId > 0 {\n                    data["tag_id"] = tagId\n                }\n                if title != "" {\n                    data["title"] = title\n                }\n                if desc != "" {\n                    data["desc"] = desc\n                }\n                if content != "" {\n                    data["content"] = content\n                }\n\n                data["modified_by"] = modifiedBy\n\n                models.EditArticle(id, data)\n                code = e.SUCCESS\n            } else {\n                code = e.ERROR_NOT_EXIST_TAG\n            }\n        } else {\n            code = e.ERROR_NOT_EXIST_ARTICLE\n        }\n    } else {\n        for _, err := range valid.Errors {\n            log.Printf("err.key: %s, err.message: %s", err.Key, err.Message)\n        }\n    }\n\n    c.JSON(http.StatusOK, gin.H{\n        "code" : code,\n        "msg" : e.GetMsg(code),\n        "data" : make(map[string]string),\n    })\n}\n\n//åˆ é™¤æ–‡ç« \nfunc DeleteArticle(c *gin.Context) {\n    id := com.StrTo(c.Param("id")).MustInt()\n\n    valid := validation.Validation{}\n    valid.Min(id, 1, "id").Message("IDå¿…é¡»å¤§äº0")\n\n    code := e.INVALID_PARAMS\n    if ! valid.HasErrors() {\n        if models.ExistArticleByID(id) {\n            models.DeleteArticle(id)\n            code = e.SUCCESS\n        } else {\n            code = e.ERROR_NOT_EXIST_ARTICLE\n        }\n    } else {\n        for _, err := range valid.Errors {\n            log.Printf("err.key: %s, err.message: %s", err.Key, err.Message)\n        }\n    }\n\n    c.JSON(http.StatusOK, gin.H{\n        "code" : code,\n        "msg" : e.GetMsg(code),\n        "data" : make(map[string]string),\n    })\n}\n')])])]),n("p",[e._v("å½“å‰ç›®å½•ç»“æ„ï¼š")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("go-gin-example/\nâ”œâ”€â”€ conf\nâ”‚Â Â  â””â”€â”€ app.ini\nâ”œâ”€â”€ main.go\nâ”œâ”€â”€ middleware\nâ”œâ”€â”€ models\nâ”‚Â Â  â”œâ”€â”€ article.go\nâ”‚Â Â  â”œâ”€â”€ models.go\nâ”‚Â Â  â””â”€â”€ tag.go\nâ”œâ”€â”€ pkg\nâ”‚Â Â  â”œâ”€â”€ e\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ code.go\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ msg.go\nâ”‚Â Â  â”œâ”€â”€ setting\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ setting.go\nâ”‚Â Â  â””â”€â”€ util\nâ”‚Â Â      â””â”€â”€ pagination.go\nâ”œâ”€â”€ routers\nâ”‚Â Â  â”œâ”€â”€ api\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ v1\nâ”‚Â Â  â”‚Â Â      â”œâ”€â”€ article.go\nâ”‚Â Â  â”‚Â Â      â””â”€â”€ tag.go\nâ”‚Â Â  â””â”€â”€ router.go\nâ”œâ”€â”€ runtime\n")])])]),n("h2",{attrs:{id:"éªŒè¯åŠŸèƒ½"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#éªŒè¯åŠŸèƒ½"}},[e._v("#")]),e._v(" éªŒè¯åŠŸèƒ½")]),e._v(" "),n("p",[e._v("æˆ‘ä»¬é‡å¯æœåŠ¡ï¼Œæ‰§è¡Œ"),n("code",[e._v("go run main.go")]),e._v("ï¼Œæ£€æŸ¥æ§åˆ¶å°è¾“å‡ºç»“æœ")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('$ go run main.go \n[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.\n - using env:\texport GIN_MODE=release\n - using code:\tgin.SetMode(gin.ReleaseMode)\n\n[GIN-debug] GET    /api/v1/tags              --\x3e gin-blog/routers/api/v1.GetTags (3 handlers)\n[GIN-debug] POST   /api/v1/tags              --\x3e gin-blog/routers/api/v1.AddTag (3 handlers)\n[GIN-debug] PUT    /api/v1/tags/:id          --\x3e gin-blog/routers/api/v1.EditTag (3 handlers)\n[GIN-debug] DELETE /api/v1/tags/:id          --\x3e gin-blog/routers/api/v1.DeleteTag (3 handlers)\n[GIN-debug] GET    /api/v1/articles          --\x3e gin-blog/routers/api/v1.GetArticles (3 handlers)\n[GIN-debug] GET    /api/v1/articles/:id      --\x3e gin-blog/routers/api/v1.GetArticle (3 handlers)\n[GIN-debug] POST   /api/v1/articles          --\x3e gin-blog/routers/api/v1.AddArticle (3 handlers)\n[GIN-debug] PUT    /api/v1/articles/:id      --\x3e gin-blog/routers/api/v1.EditArticle (3 handlers)\n[GIN-debug] DELETE /api/v1/articles/:id      --\x3e gin-blog/routers/api/v1.DeleteArticle (3 handlers)\n')])])]),n("p",[e._v("ä½¿ç”¨"),n("code",[e._v("Postman")]),e._v("æ£€éªŒæ¥å£æ˜¯å¦æ­£å¸¸ï¼Œåœ¨è¿™é‡Œå¤§å®¶å¯ä»¥é€‰ç”¨åˆé€‚çš„å‚æ•°ä¼ é€’æ–¹å¼ï¼Œæ­¤å¤„ä¸ºäº†æ–¹ä¾¿å±•ç¤ºæˆ‘é€‰ç”¨äº† GET/Param ä¼ å‚çš„æ–¹å¼ï¼Œè€ŒåæœŸä¼šæ”¹ä¸º POSTã€‚")]),e._v(" "),n("ul",[n("li",[e._v("POSTï¼šhttp://127.0.0.1:8000/api/v1/articles?tag_id=1&title=test1&desc=test-desc&content=test-content&created_by=test-created&state=1")]),e._v(" "),n("li",[e._v("GETï¼šhttp://127.0.0.1:8000/api/v1/articles")]),e._v(" "),n("li",[e._v("GETï¼šhttp://127.0.0.1:8000/api/v1/articles/1")]),e._v(" "),n("li",[e._v("PUTï¼šhttp://127.0.0.1:8000/api/v1/articles/1?tag_id=1&title=test-edit1&desc=test-desc-edit&content=test-content-edit&modified_by=test-created-edit&state=0")]),e._v(" "),n("li",[e._v("DELETEï¼šhttp://127.0.0.1:8000/api/v1/articles/1")])]),e._v(" "),n("p",[e._v("è‡³æ­¤ï¼Œæˆ‘ä»¬çš„API'sç¼–å†™å°±åˆ°è¿™é‡Œï¼Œä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†ä»‹ç»å¦å¤–çš„ä¸€äº›æŠ€å·§ï¼")]),e._v(" "),n("h2",{attrs:{id:"å‚è€ƒ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒ"}},[e._v("#")]),e._v(" å‚è€ƒ")]),e._v(" "),n("h3",{attrs:{id:"æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç "}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç "}},[e._v("#")]),e._v(" æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç ")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/EDDYCJY/go-gin-example",target:"_blank",rel:"noopener noreferrer"}},[e._v("go-gin-example"),n("OutboundLink")],1)])]),e._v(" "),n("h2",{attrs:{id:"å…³äº"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å…³äº"}},[e._v("#")]),e._v(" å…³äº")]),e._v(" "),n("h3",{attrs:{id:"ä¿®æ”¹è®°å½•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä¿®æ”¹è®°å½•"}},[e._v("#")]),e._v(" ä¿®æ”¹è®°å½•")]),e._v(" "),n("ul",[n("li",[e._v("ç¬¬ä¸€ç‰ˆï¼š2018å¹´02æœˆ16æ—¥å‘å¸ƒæ–‡ç« ")]),e._v(" "),n("li",[e._v("ç¬¬äºŒç‰ˆï¼š2019å¹´10æœˆ01æ—¥ä¿®æ”¹æ–‡ç« ")])]),e._v(" "),n("h2",{attrs:{id:"ï¼Ÿ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ï¼Ÿ"}},[e._v("#")]),e._v(" ï¼Ÿ")]),e._v(" "),n("p",[e._v("å¦‚æœæœ‰ä»»ä½•ç–‘é—®æˆ–é”™è¯¯ï¼Œæ¬¢è¿åœ¨ "),n("a",{attrs:{href:"https://github.com/EDDYCJY/blog",target:"_blank",rel:"noopener noreferrer"}},[e._v("issues"),n("OutboundLink")],1),e._v(" è¿›è¡Œæé—®æˆ–ç»™äºˆä¿®æ­£æ„è§ï¼Œå¦‚æœå–œæ¬¢æˆ–å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ Starï¼Œå¯¹ä½œè€…æ˜¯ä¸€ç§é¼“åŠ±å’Œæ¨è¿›ã€‚")]),e._v(" "),n("h3",{attrs:{id:"æˆ‘çš„å…¬ä¼—å·"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æˆ‘çš„å…¬ä¼—å·"}},[e._v("#")]),e._v(" æˆ‘çš„å…¬ä¼—å·")]),e._v(" "),n("p",[n("img",{attrs:{src:"https://image.eddycjy.com/8d0b0c3a11e74efd5fdfd7910257e70b.jpg",alt:"image"}})])])}),[],!1,null,null,null);t.default=i.exports}}]);