(window.webpackJsonp=window.webpackJsonp||[]).push([[320],{898:function(e,t,r){"use strict";r.r(t);var a=r(44),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"_4-3-grpc-streaming-client-and-server"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-grpc-streaming-client-and-server"}},[e._v("#")]),e._v(" 4.3 gRPC Streaming, Client and Server")]),e._v(" "),r("p",[e._v("é¡¹ç›®åœ°å€ï¼šhttps://github.com/EDDYCJY/go-grpc-example")]),e._v(" "),r("h2",{attrs:{id:"å‰è¨€"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[e._v("#")]),e._v(" å‰è¨€")]),e._v(" "),r("p",[e._v("æœ¬ç« èŠ‚å°†ä»‹ç» gRPC çš„æµå¼ï¼Œåˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("Server-side streaming RPCï¼šæœåŠ¡å™¨ç«¯æµå¼ RPC")]),e._v(" "),r("li",[e._v("Client-side streaming RPCï¼šå®¢æˆ·ç«¯æµå¼ RPC")]),e._v(" "),r("li",[e._v("Bidirectional streaming RPCï¼šåŒå‘æµå¼ RPC")])]),e._v(" "),r("h2",{attrs:{id:"æµ"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æµ"}},[e._v("#")]),e._v(" æµ")]),e._v(" "),r("p",[e._v("ä»»ä½•æŠ€æœ¯ï¼Œå› ä¸ºæœ‰ç—›ç‚¹ï¼Œæ‰€ä»¥æ‰æœ‰äº†å­˜åœ¨çš„å¿…è¦æ€§ã€‚å¦‚æœæ‚¨æƒ³è¦äº†è§£ gRPC çš„æµå¼è°ƒç”¨ï¼Œè¯·ç»§ç»­")]),e._v(" "),r("h3",{attrs:{id:"å›¾"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#å›¾"}},[e._v("#")]),e._v(" å›¾")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://image.eddycjy.com/8812038d20ffece377c0e4901c9a9231.png",alt:"image"}})]),e._v(" "),r("p",[e._v("gRPC Streaming æ˜¯åŸºäº HTTP/2 çš„ï¼Œåç»­ç« èŠ‚å†è¿›è¡Œè¯¦ç»†è®²è§£")]),e._v(" "),r("h3",{attrs:{id:"ä¸ºä»€ä¹ˆä¸ç”¨-simple-rpc"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆä¸ç”¨-simple-rpc"}},[e._v("#")]),e._v(" ä¸ºä»€ä¹ˆä¸ç”¨ Simple RPC")]),e._v(" "),r("p",[e._v("æµå¼ä¸ºä»€ä¹ˆè¦å­˜åœ¨å‘¢ï¼Œæ˜¯ Simple RPC æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿé€šè¿‡æ¨¡æ‹Ÿä¸šåŠ¡åœºæ™¯ï¼Œå¯å¾—çŸ¥åœ¨ä½¿ç”¨ Simple RPC æ—¶ï¼Œæœ‰å¦‚ä¸‹é—®é¢˜ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("æ•°æ®åŒ…è¿‡å¤§é€ æˆçš„ç¬æ—¶å‹åŠ›")]),e._v(" "),r("li",[e._v("æ¥æ”¶æ•°æ®åŒ…æ—¶ï¼Œéœ€è¦æ‰€æœ‰æ•°æ®åŒ…éƒ½æ¥å—æˆåŠŸä¸”æ­£ç¡®åï¼Œæ‰èƒ½å¤Ÿå›è°ƒå“åº”ï¼Œè¿›è¡Œä¸šåŠ¡å¤„ç†ï¼ˆæ— æ³•å®¢æˆ·ç«¯è¾¹å‘é€ï¼ŒæœåŠ¡ç«¯è¾¹å¤„ç†ï¼‰")])]),e._v(" "),r("h3",{attrs:{id:"ä¸ºä»€ä¹ˆç”¨-streaming-rpc"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆç”¨-streaming-rpc"}},[e._v("#")]),e._v(" ä¸ºä»€ä¹ˆç”¨ Streaming RPC")]),e._v(" "),r("ul",[r("li",[e._v("å¤§è§„æ¨¡æ•°æ®åŒ…")]),e._v(" "),r("li",[e._v("å®æ—¶åœºæ™¯")])]),e._v(" "),r("h4",{attrs:{id:"æ¨¡æ‹Ÿåœºæ™¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æ¨¡æ‹Ÿåœºæ™¯"}},[e._v("#")]),e._v(" æ¨¡æ‹Ÿåœºæ™¯")]),e._v(" "),r("p",[e._v("æ¯å¤©æ—©ä¸Š 6 ç‚¹ï¼Œéƒ½æœ‰ä¸€æ‰¹ç™¾ä¸‡çº§åˆ«çš„æ•°æ®é›†è¦åŒä» A åŒæ­¥åˆ° Bï¼Œåœ¨åŒæ­¥çš„æ—¶å€™ï¼Œä¼šåšä¸€ç³»åˆ—æ“ä½œï¼ˆå½’æ¡£ã€æ•°æ®åˆ†æã€ç”»åƒã€æ—¥å¿—ç­‰ï¼‰ã€‚è¿™ä¸€æ¬¡æ€§æ¶‰åŠçš„æ•°æ®é‡ç¡®å®å¤§")]),e._v(" "),r("p",[e._v("åœ¨åŒæ­¥å®Œæˆåï¼Œä¹Ÿæœ‰äººé©¬ä¸Šä¼šå»æŸ¥é˜…æ•°æ®ï¼Œä¸ºäº†æ–°çš„ä¸€å¤©ç­¹å¤‡ã€‚ä¹Ÿç¬¦åˆå®æ—¶æ€§ã€‚")]),e._v(" "),r("p",[e._v("ä¸¤è€…ç›¸è¾ƒä¸‹ï¼Œè¿™ä¸ªåœºæ™¯ä¸‹æ›´é€‚åˆä½¿ç”¨ Streaming RPC")]),e._v(" "),r("h2",{attrs:{id:"grpc"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#grpc"}},[e._v("#")]),e._v(" gRPC")]),e._v(" "),r("p",[e._v("åœ¨è®²è§£å…·ä½“çš„ gRPC æµå¼ä»£ç æ—¶ï¼Œä¼š"),r("strong",[e._v("ç€é‡åœ¨ç¬¬ä¸€èŠ‚è®²è§£")]),e._v("ï¼Œå› ä¸ºä¸‰ç§æ¨¡å¼å…¶å®æ˜¯ä¸åŒçš„ç»„åˆã€‚å¸Œæœ›ä½ èƒ½å¤Ÿæ³¨é‡ç†è§£ï¼Œä¸¾ä¸€åä¸‰ï¼Œå…¶å®éƒ½æ˜¯ä¸€æ ·çš„çŸ¥è¯†ç‚¹ ğŸ‘")]),e._v(" "),r("h3",{attrs:{id:"ç›®å½•ç»“æ„"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ç›®å½•ç»“æ„"}},[e._v("#")]),e._v(" ç›®å½•ç»“æ„")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("$ tree go-grpc-example \ngo-grpc-example\nâ”œâ”€â”€ client\nâ”‚Â Â  â”œâ”€â”€ simple_client\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ client.go\nâ”‚Â Â  â””â”€â”€ stream_client\nâ”‚Â Â      â””â”€â”€ client.go\nâ”œâ”€â”€ proto\nâ”‚Â Â  â”œâ”€â”€ search.proto\nâ”‚Â Â  â””â”€â”€ stream.proto\nâ””â”€â”€ server\n    â”œâ”€â”€ simple_server\n    â”‚Â Â  â””â”€â”€ server.go\n    â””â”€â”€ stream_server\n        â””â”€â”€ server.go\n")])])]),r("p",[e._v("å¢åŠ  stream_serverã€stream_client å­˜æ”¾æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ–‡ä»¶ï¼Œproto/stream.proto ç”¨äºç¼–å†™ IDL")]),e._v(" "),r("h3",{attrs:{id:"idl"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#idl"}},[e._v("#")]),e._v(" IDL")]),e._v(" "),r("p",[e._v("åœ¨ proto æ–‡ä»¶å¤¹ä¸‹çš„ stream.proto æ–‡ä»¶ä¸­ï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('syntax = "proto3";\n\npackage proto;\n\nservice StreamService {\n    rpc List(StreamRequest) returns (stream StreamResponse) {};\n\n    rpc Record(stream StreamRequest) returns (StreamResponse) {};\n\n    rpc Route(stream StreamRequest) returns (stream StreamResponse) {};\n}\n\n\nmessage StreamPoint {\n  string name = 1;\n  int32 value = 2;\n}\n\nmessage StreamRequest {\n  StreamPoint pt = 1;\n}\n\nmessage StreamResponse {\n  StreamPoint pt = 1;\n}\n')])])]),r("p",[e._v("æ³¨æ„å…³é”®å­— streamï¼Œå£°æ˜å…¶ä¸ºä¸€ä¸ªæµæ–¹æ³•ã€‚è¿™é‡Œå…±æ¶‰åŠä¸‰ä¸ªæ–¹æ³•ï¼Œå¯¹åº”å…³ç³»ä¸º")]),e._v(" "),r("ul",[r("li",[e._v("Listï¼šæœåŠ¡å™¨ç«¯æµå¼ RPC")]),e._v(" "),r("li",[e._v("Recordï¼šå®¢æˆ·ç«¯æµå¼ RPC")]),e._v(" "),r("li",[e._v("Routeï¼šåŒå‘æµå¼ RPC")])]),e._v(" "),r("h3",{attrs:{id:"åŸºç¡€æ¨¡æ¿-ç©ºå®šä¹‰"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#åŸºç¡€æ¨¡æ¿-ç©ºå®šä¹‰"}},[e._v("#")]),e._v(" åŸºç¡€æ¨¡æ¿ + ç©ºå®šä¹‰")]),e._v(" "),r("h4",{attrs:{id:"server"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#server"}},[e._v("#")]),e._v(" Server")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('package main\n\nimport (\n\t"log"\n\t"net"\n\n\t"google.golang.org/grpc"\n\n\tpb "github.com/EDDYCJY/go-grpc-example/proto"\n\t\n)\n\ntype StreamService struct{}\n\nconst (\n\tPORT = "9002"\n)\n\nfunc main() {\n\tserver := grpc.NewServer()\n\tpb.RegisterStreamServiceServer(server, &StreamService{})\n\n\tlis, err := net.Listen("tcp", ":"+PORT)\n\tif err != nil {\n\t\tlog.Fatalf("net.Listen err: %v", err)\n\t}\n\n\tserver.Serve(lis)\n}\n\nfunc (s *StreamService) List(r *pb.StreamRequest, stream pb.StreamService_ListServer) error {\n\treturn nil\n}\n\nfunc (s *StreamService) Record(stream pb.StreamService_RecordServer) error {\n\treturn nil\n}\n\nfunc (s *StreamService) Route(stream pb.StreamService_RouteServer) error {\n\treturn nil\n}\n')])])]),r("p",[e._v("å†™ä»£ç å‰ï¼Œå»ºè®®å…ˆå°† gRPC Server çš„åŸºç¡€æ¨¡æ¿å’Œæ¥å£ç»™ç©ºå®šä¹‰å‡ºæ¥ã€‚è‹¥æœ‰ä¸æ¸…æ¥šå¯å‚è§ä¸Šä¸€ç« èŠ‚çš„çŸ¥è¯†ç‚¹")]),e._v(" "),r("h4",{attrs:{id:"client"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#client"}},[e._v("#")]),e._v(" Client")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('package main\n\nimport (\n    "log"\n    \n\t"google.golang.org/grpc"\n\n\tpb "github.com/EDDYCJY/go-grpc-example/proto"\n)\n\nconst (\n\tPORT = "9002"\n)\n\nfunc main() {\n\tconn, err := grpc.Dial(":"+PORT, grpc.WithInsecure())\n\tif err != nil {\n\t\tlog.Fatalf("grpc.Dial err: %v", err)\n\t}\n\n\tdefer conn.Close()\n\n\tclient := pb.NewStreamServiceClient(conn)\n\n\terr = printLists(client, &pb.StreamRequest{Pt: &pb.StreamPoint{Name: "gRPC Stream Client: List", Value: 2018}})\n\tif err != nil {\n\t\tlog.Fatalf("printLists.err: %v", err)\n\t}\n\n\terr = printRecord(client, &pb.StreamRequest{Pt: &pb.StreamPoint{Name: "gRPC Stream Client: Record", Value: 2018}})\n\tif err != nil {\n\t\tlog.Fatalf("printRecord.err: %v", err)\n\t}\n\n\terr = printRoute(client, &pb.StreamRequest{Pt: &pb.StreamPoint{Name: "gRPC Stream Client: Route", Value: 2018}})\n\tif err != nil {\n\t\tlog.Fatalf("printRoute.err: %v", err)\n\t}\n}\n\nfunc printLists(client pb.StreamServiceClient, r *pb.StreamRequest) error {\n\treturn nil\n}\n\nfunc printRecord(client pb.StreamServiceClient, r *pb.StreamRequest) error {\n\treturn nil\n}\n\nfunc printRoute(client pb.StreamServiceClient, r *pb.StreamRequest) error {\n\treturn nil\n}\n')])])]),r("h3",{attrs:{id:"ä¸€ã€server-side-streaming-rpcï¼šæœåŠ¡å™¨ç«¯æµå¼-rpc"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ã€server-side-streaming-rpcï¼šæœåŠ¡å™¨ç«¯æµå¼-rpc"}},[e._v("#")]),e._v(" ä¸€ã€Server-side streaming RPCï¼šæœåŠ¡å™¨ç«¯æµå¼ RPC")]),e._v(" "),r("p",[e._v("æœåŠ¡å™¨ç«¯æµå¼ RPCï¼Œæ˜¾ç„¶æ˜¯å•å‘æµï¼Œå¹¶ä»£æŒ‡ Server ä¸º Stream è€Œ Client ä¸ºæ™®é€š RPC è¯·æ±‚")]),e._v(" "),r("p",[e._v("ç®€å•æ¥è®²å°±æ˜¯å®¢æˆ·ç«¯å‘èµ·ä¸€æ¬¡æ™®é€šçš„ RPC è¯·æ±‚ï¼ŒæœåŠ¡ç«¯é€šè¿‡æµå¼å“åº”å¤šæ¬¡å‘é€æ•°æ®é›†ï¼Œå®¢æˆ·ç«¯ Recv æ¥æ”¶æ•°æ®é›†ã€‚å¤§è‡´å¦‚å›¾ï¼š")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://image.eddycjy.com/b25a47e2f2fb2a8c352a547f7612808b.png",alt:"image"}})]),e._v(" "),r("h4",{attrs:{id:"server-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#server-2"}},[e._v("#")]),e._v(" Server")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("func (s *StreamService) List(r *pb.StreamRequest, stream pb.StreamService_ListServer) error {\n\tfor n := 0; n <= 6; n++ {\n\t\terr := stream.Send(&pb.StreamResponse{\n\t\t\tPt: &pb.StreamPoint{\n\t\t\t\tName:  r.Pt.Name,\n\t\t\t\tValue: r.Pt.Value + int32(n),\n\t\t\t},\n\t\t})\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t}\n\n\treturn nil\n}\n")])])]),r("p",[e._v("åœ¨ Serverï¼Œä¸»è¦ç•™æ„ "),r("code",[e._v("stream.Send")]),e._v(" æ–¹æ³•ã€‚å®ƒçœ‹ä¸Šå»èƒ½å‘é€ N æ¬¡ï¼Ÿæœ‰æ²¡æœ‰å¤§å°é™åˆ¶ï¼Ÿ")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("type StreamService_ListServer interface {\n\tSend(*StreamResponse) error\n\tgrpc.ServerStream\n}\n\nfunc (x *streamServiceListServer) Send(m *StreamResponse) error {\n\treturn x.ServerStream.SendMsg(m)\n}\n")])])]),r("p",[e._v("é€šè¿‡é˜…è¯»æºç ï¼Œå¯å¾—çŸ¥æ˜¯ protoc åœ¨ç”Ÿæˆæ—¶ï¼Œæ ¹æ®å®šä¹‰ç”Ÿæˆäº†å„å¼å„æ ·ç¬¦åˆæ ‡å‡†çš„æ¥å£æ–¹æ³•ã€‚æœ€ç»ˆå†ç»Ÿä¸€è°ƒåº¦å†…éƒ¨çš„ "),r("code",[e._v("SendMsg")]),e._v(" æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¶‰åŠä»¥ä¸‹è¿‡ç¨‹:")]),e._v(" "),r("ul",[r("li",[e._v("æ¶ˆæ¯ä½“ï¼ˆå¯¹è±¡ï¼‰åºåˆ—åŒ–")]),e._v(" "),r("li",[e._v("å‹ç¼©åºåˆ—åŒ–åçš„æ¶ˆæ¯ä½“")]),e._v(" "),r("li",[e._v("å¯¹æ­£åœ¨ä¼ è¾“çš„æ¶ˆæ¯ä½“å¢åŠ  5 ä¸ªå­—èŠ‚çš„ header")]),e._v(" "),r("li",[e._v("åˆ¤æ–­å‹ç¼©+åºåˆ—åŒ–åçš„æ¶ˆæ¯ä½“æ€»å­—èŠ‚é•¿åº¦æ˜¯å¦å¤§äºé¢„è®¾çš„ maxSendMessageSizeï¼ˆé¢„è®¾å€¼ä¸º "),r("code",[e._v("math.MaxInt32")]),e._v("ï¼‰ï¼Œè‹¥è¶…å‡ºåˆ™æç¤ºé”™è¯¯")]),e._v(" "),r("li",[e._v("å†™å…¥ç»™æµçš„æ•°æ®é›†")])]),e._v(" "),r("h4",{attrs:{id:"client-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#client-2"}},[e._v("#")]),e._v(" Client")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('func printLists(client pb.StreamServiceClient, r *pb.StreamRequest) error {\n\tstream, err := client.List(context.Background(), r)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tfor {\n\t\tresp, err := stream.Recv()\n\t\tif err == io.EOF {\n\t\t\tbreak\n\t\t}\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\tlog.Printf("resp: pj.name: %s, pt.value: %d", resp.Pt.Name, resp.Pt.Value)\n\t}\n\n\treturn nil\n}\n')])])]),r("p",[e._v("åœ¨ Clientï¼Œä¸»è¦ç•™æ„ "),r("code",[e._v("stream.Recv()")]),e._v(" æ–¹æ³•ã€‚ä»€ä¹ˆæƒ…å†µä¸‹ "),r("code",[e._v("io.EOF")]),e._v(" ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹å­˜åœ¨é”™è¯¯ä¿¡æ¯å‘¢?")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("type StreamService_ListClient interface {\n\tRecv() (*StreamResponse, error)\n\tgrpc.ClientStream\n}\n\nfunc (x *streamServiceListClient) Recv() (*StreamResponse, error) {\n\tm := new(StreamResponse)\n\tif err := x.ClientStream.RecvMsg(m); err != nil {\n\t\treturn nil, err\n\t}\n\treturn m, nil\n}\n")])])]),r("p",[e._v("RecvMsg ä¼šä»æµä¸­è¯»å–å®Œæ•´çš„ gRPC æ¶ˆæ¯ä½“ï¼Œå¦å¤–é€šè¿‡é˜…è¯»æºç å¯å¾—çŸ¥ï¼š")]),e._v(" "),r("p",[e._v("ï¼ˆ1ï¼‰RecvMsg æ˜¯é˜»å¡ç­‰å¾…çš„")]),e._v(" "),r("p",[e._v("ï¼ˆ2ï¼‰RecvMsg å½“æµæˆåŠŸ/ç»“æŸï¼ˆè°ƒç”¨äº† Closeï¼‰æ—¶ï¼Œä¼šè¿”å› "),r("code",[e._v("io.EOF")])]),e._v(" "),r("p",[e._v("ï¼ˆ3ï¼‰RecvMsg å½“æµå‡ºç°ä»»ä½•é”™è¯¯æ—¶ï¼Œæµä¼šè¢«ä¸­æ­¢ï¼Œé”™è¯¯ä¿¡æ¯ä¼šåŒ…å« RPC é”™è¯¯ç ã€‚è€Œåœ¨ RecvMsg ä¸­å¯èƒ½å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("io.EOF")]),e._v(" "),r("li",[e._v("io.ErrUnexpectedEOF")]),e._v(" "),r("li",[e._v("transport.ConnectionError")]),e._v(" "),r("li",[e._v("google.golang.org/grpc/codes")])]),e._v(" "),r("p",[e._v("åŒæ—¶éœ€è¦æ³¨æ„ï¼Œé»˜è®¤çš„ MaxReceiveMessageSize å€¼ä¸º 1024 * 1024 * 4ï¼Œå»ºè®®ä¸è¦è¶…å‡º")]),e._v(" "),r("h4",{attrs:{id:"éªŒè¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#éªŒè¯"}},[e._v("#")]),e._v(" éªŒè¯")]),e._v(" "),r("p",[e._v("è¿è¡Œ stream_server/server.goï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("$ go run server.go\n")])])]),r("p",[e._v("è¿è¡Œ stream_client/client.goï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("$ go run client.go \n2018/09/24 16:18:25 resp: pj.name: gRPC Stream Client: List, pt.value: 2018\n2018/09/24 16:18:25 resp: pj.name: gRPC Stream Client: List, pt.value: 2019\n2018/09/24 16:18:25 resp: pj.name: gRPC Stream Client: List, pt.value: 2020\n2018/09/24 16:18:25 resp: pj.name: gRPC Stream Client: List, pt.value: 2021\n2018/09/24 16:18:25 resp: pj.name: gRPC Stream Client: List, pt.value: 2022\n2018/09/24 16:18:25 resp: pj.name: gRPC Stream Client: List, pt.value: 2023\n2018/09/24 16:18:25 resp: pj.name: gRPC Stream Client: List, pt.value: 2024\n")])])]),r("h3",{attrs:{id:"äºŒã€client-side-streaming-rpcï¼šå®¢æˆ·ç«¯æµå¼-rpc"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#äºŒã€client-side-streaming-rpcï¼šå®¢æˆ·ç«¯æµå¼-rpc"}},[e._v("#")]),e._v(" äºŒã€Client-side streaming RPCï¼šå®¢æˆ·ç«¯æµå¼ RPC")]),e._v(" "),r("p",[e._v("å®¢æˆ·ç«¯æµå¼ RPCï¼Œå•å‘æµï¼Œå®¢æˆ·ç«¯é€šè¿‡æµå¼å‘èµ·"),r("strong",[e._v("å¤šæ¬¡")]),e._v(" RPC è¯·æ±‚ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å‘èµ·"),r("strong",[e._v("ä¸€æ¬¡")]),e._v("å“åº”ç»™å®¢æˆ·ç«¯ï¼Œå¤§è‡´å¦‚å›¾ï¼š")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://image.eddycjy.com/97473884d939ec91d6cdf53090bef92e.png",alt:"image"}})]),e._v(" "),r("h4",{attrs:{id:"server-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#server-3"}},[e._v("#")]),e._v(" Server")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('func (s *StreamService) Record(stream pb.StreamService_RecordServer) error {\n\tfor {\n\t\tr, err := stream.Recv()\n\t\tif err == io.EOF {\n\t\t\treturn stream.SendAndClose(&pb.StreamResponse{Pt: &pb.StreamPoint{Name: "gRPC Stream Server: Record", Value: 1}})\n\t\t}\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\tlog.Printf("stream.Recv pt.name: %s, pt.value: %d", r.Pt.Name, r.Pt.Value)\n\t}\n\n\treturn nil\n}\n')])])]),r("p",[e._v("å¤šäº†ä¸€ä¸ªä»æœªè§è¿‡çš„æ–¹æ³• "),r("code",[e._v("stream.SendAndClose")]),e._v("ï¼Œå®ƒæ˜¯åšä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿ")]),e._v(" "),r("p",[e._v("åœ¨è¿™æ®µç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸€ä¸ª Recv éƒ½è¿›è¡Œäº†å¤„ç†ï¼Œå½“å‘ç° "),r("code",[e._v("io.EOF")]),e._v(" (æµå…³é—­) åï¼Œéœ€è¦å°†æœ€ç»ˆçš„å“åº”ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ—¶å…³é—­æ­£åœ¨å¦å¤–ä¸€ä¾§ç­‰å¾…çš„ Recv")]),e._v(" "),r("h4",{attrs:{id:"client-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#client-3"}},[e._v("#")]),e._v(" Client")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('func printRecord(client pb.StreamServiceClient, r *pb.StreamRequest) error {\n\tstream, err := client.Record(context.Background())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tfor n := 0; n < 6; n++ {\n\t\terr := stream.Send(r)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t}\n\n\tresp, err := stream.CloseAndRecv()\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tlog.Printf("resp: pj.name: %s, pt.value: %d", resp.Pt.Name, resp.Pt.Value)\n\n\treturn nil\n}\n')])])]),r("p",[r("code",[e._v("stream.CloseAndRecv")]),e._v(" å’Œ "),r("code",[e._v("stream.SendAndClose")]),e._v(" æ˜¯é…å¥—ä½¿ç”¨çš„æµæ–¹æ³•ï¼Œç›¸ä¿¡èªæ˜çš„ä½ å·²ç»ç§’æ‡‚å®ƒçš„ä½œç”¨äº†")]),e._v(" "),r("h4",{attrs:{id:"éªŒè¯-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#éªŒè¯-2"}},[e._v("#")]),e._v(" éªŒè¯")]),e._v(" "),r("p",[e._v("é‡å¯ stream_server/server.goï¼Œå†æ¬¡è¿è¡Œ stream_client/client.goï¼š")]),e._v(" "),r("h5",{attrs:{id:"stream-clientï¼š"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#stream-clientï¼š"}},[e._v("#")]),e._v(" stream_clientï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("$ go run client.go\n2018/09/24 16:23:03 resp: pj.name: gRPC Stream Server: Record, pt.value: 1\n")])])]),r("h5",{attrs:{id:"stream-serverï¼š"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#stream-serverï¼š"}},[e._v("#")]),e._v(" stream_serverï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("$ go run server.go\n2018/09/24 16:23:03 stream.Recv pt.name: gRPC Stream Client: Record, pt.value: 2018\n2018/09/24 16:23:03 stream.Recv pt.name: gRPC Stream Client: Record, pt.value: 2018\n2018/09/24 16:23:03 stream.Recv pt.name: gRPC Stream Client: Record, pt.value: 2018\n2018/09/24 16:23:03 stream.Recv pt.name: gRPC Stream Client: Record, pt.value: 2018\n2018/09/24 16:23:03 stream.Recv pt.name: gRPC Stream Client: Record, pt.value: 2018\n2018/09/24 16:23:03 stream.Recv pt.name: gRPC Stream Client: Record, pt.value: 2018\n")])])]),r("h3",{attrs:{id:"ä¸‰ã€bidirectional-streaming-rpcï¼šåŒå‘æµå¼-rpc"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ã€bidirectional-streaming-rpcï¼šåŒå‘æµå¼-rpc"}},[e._v("#")]),e._v(" ä¸‰ã€Bidirectional streaming RPCï¼šåŒå‘æµå¼ RPC")]),e._v(" "),r("p",[e._v("åŒå‘æµå¼ RPCï¼Œé¡¾åæ€ä¹‰æ˜¯åŒå‘æµã€‚ç”±å®¢æˆ·ç«¯ä»¥æµå¼çš„æ–¹å¼å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯åŒæ ·ä»¥æµå¼çš„æ–¹å¼å“åº”è¯·æ±‚")]),e._v(" "),r("p",[e._v("é¦–ä¸ªè¯·æ±‚ä¸€å®šæ˜¯ Client å‘èµ·ï¼Œä½†å…·ä½“äº¤äº’æ–¹å¼ï¼ˆè°å…ˆè°åã€ä¸€æ¬¡å‘å¤šå°‘ã€å“åº”å¤šå°‘ã€ä»€ä¹ˆæ—¶å€™å…³é—­ï¼‰æ ¹æ®ç¨‹åºç¼–å†™çš„æ–¹å¼æ¥ç¡®å®šï¼ˆå¯ä»¥ç»“åˆåç¨‹ï¼‰")]),e._v(" "),r("p",[e._v("å‡è®¾è¯¥åŒå‘æµæ˜¯"),r("strong",[e._v("æŒ‰é¡ºåºå‘é€")]),e._v("çš„è¯ï¼Œå¤§è‡´å¦‚å›¾ï¼š")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://image.eddycjy.com/ab80297cd6715048a235e0c9b0f36091.png",alt:"image"}})]),e._v(" "),r("p",[e._v("è¿˜æ˜¯è¦å¼ºè°ƒï¼ŒåŒå‘æµå˜åŒ–å¾ˆå¤§ï¼Œå› ç¨‹åºç¼–å†™çš„ä¸åŒè€Œä¸åŒã€‚"),r("strong",[e._v("åŒå‘æµå›¾ç¤ºæ— æ³•é€‚ç”¨ä¸åŒçš„åœºæ™¯")])]),e._v(" "),r("h4",{attrs:{id:"server-4"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#server-4"}},[e._v("#")]),e._v(" Server")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('func (s *StreamService) Route(stream pb.StreamService_RouteServer) error {\n\tn := 0\n\tfor {\n\t\terr := stream.Send(&pb.StreamResponse{\n\t\t\tPt: &pb.StreamPoint{\n\t\t\t\tName:  "gPRC Stream Client: Route",\n\t\t\t\tValue: int32(n),\n\t\t\t},\n\t\t})\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\tr, err := stream.Recv()\n\t\tif err == io.EOF {\n\t\t\treturn nil\n\t\t}\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\tn++\n\n\t\tlog.Printf("stream.Recv pt.name: %s, pt.value: %d", r.Pt.Name, r.Pt.Value)\n\t}\n\n\treturn nil\n}\n')])])]),r("h4",{attrs:{id:"client-4"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#client-4"}},[e._v("#")]),e._v(" Client")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('func printRoute(client pb.StreamServiceClient, r *pb.StreamRequest) error {\n\tstream, err := client.Route(context.Background())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tfor n := 0; n <= 6; n++ {\n\t\terr = stream.Send(r)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\tresp, err := stream.Recv()\n\t\tif err == io.EOF {\n\t\t\tbreak\n\t\t}\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\tlog.Printf("resp: pj.name: %s, pt.value: %d", resp.Pt.Name, resp.Pt.Value)\n\t}\n\n\tstream.CloseSend()\n\n\treturn nil\n}\n')])])]),r("h4",{attrs:{id:"éªŒè¯-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#éªŒè¯-3"}},[e._v("#")]),e._v(" éªŒè¯")]),e._v(" "),r("p",[e._v("é‡å¯ stream_server/server.goï¼Œå†æ¬¡è¿è¡Œ stream_client/client.goï¼š")]),e._v(" "),r("h5",{attrs:{id:"stream-server"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#stream-server"}},[e._v("#")]),e._v(" stream_server")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("$ go run server.go\n2018/09/24 16:29:43 stream.Recv pt.name: gRPC Stream Client: Route, pt.value: 2018\n2018/09/24 16:29:43 stream.Recv pt.name: gRPC Stream Client: Route, pt.value: 2018\n2018/09/24 16:29:43 stream.Recv pt.name: gRPC Stream Client: Route, pt.value: 2018\n2018/09/24 16:29:43 stream.Recv pt.name: gRPC Stream Client: Route, pt.value: 2018\n2018/09/24 16:29:43 stream.Recv pt.name: gRPC Stream Client: Route, pt.value: 2018\n2018/09/24 16:29:43 stream.Recv pt.name: gRPC Stream Client: Route, pt.value: 2018\n")])])]),r("h5",{attrs:{id:"stream-client"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#stream-client"}},[e._v("#")]),e._v(" stream_client")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("$ go run client.go\n2018/09/24 16:29:43 resp: pj.name: gPRC Stream Client: Route, pt.value: 0\n2018/09/24 16:29:43 resp: pj.name: gPRC Stream Client: Route, pt.value: 1\n2018/09/24 16:29:43 resp: pj.name: gPRC Stream Client: Route, pt.value: 2\n2018/09/24 16:29:43 resp: pj.name: gPRC Stream Client: Route, pt.value: 3\n2018/09/24 16:29:43 resp: pj.name: gPRC Stream Client: Route, pt.value: 4\n2018/09/24 16:29:43 resp: pj.name: gPRC Stream Client: Route, pt.value: 5\n2018/09/24 16:29:43 resp: pj.name: gPRC Stream Client: Route, pt.value: 6\n")])])]),r("h2",{attrs:{id:"æ€»ç»“"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[e._v("#")]),e._v(" æ€»ç»“")]),e._v(" "),r("p",[e._v("åœ¨æœ¬æ–‡å…±ä»‹ç»äº†ä¸‰ç±»æµçš„äº¤äº’æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®å®é™…çš„ä¸šåŠ¡åœºæ™¯å»é€‰æ‹©åˆé€‚çš„æ–¹å¼ã€‚ä¼šäº‹åŠåŠŸå€å“¦ ğŸ‘")]),e._v(" "),r("h2",{attrs:{id:"å‚è€ƒ"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒ"}},[e._v("#")]),e._v(" å‚è€ƒ")]),e._v(" "),r("h3",{attrs:{id:"æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç "}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç "}},[e._v("#")]),e._v(" æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç ")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://github.com/EDDYCJY/go-grpc-example",target:"_blank",rel:"noopener noreferrer"}},[e._v("go-grpc-example"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);