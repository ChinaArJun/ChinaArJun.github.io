(window.webpackJsonp=window.webpackJsonp||[]).push([[335],{913:function(t,n,e){"use strict";e.r(n);var a=e(44),v=Object(a.a)({},(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"_8-3-æœ‰ç‚¹ä¸å®‰å…¨å´åˆä¸€äº®çš„-go-unsafe-pointer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-æœ‰ç‚¹ä¸å®‰å…¨å´åˆä¸€äº®çš„-go-unsafe-pointer"}},[t._v("#")]),t._v(" 8.3 æœ‰ç‚¹ä¸å®‰å…¨å´åˆä¸€äº®çš„ Go unsafe.Pointer")]),t._v(" "),e("p",[t._v("åœ¨ä¸Šä¸€ç¯‡æ–‡ç« "),e("a",{attrs:{href:"https://book.eddycjy.com/golang/slice/slice.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ã€Šæ·±å…¥ç†è§£ Go Sliceã€‹"),e("OutboundLink")],1),t._v("ä¸­ï¼Œå¤§å®¶ä¼šå‘ç°å…¶åº•å±‚æ•°æ®ç»“æ„ä½¿ç”¨äº† "),e("code",[t._v("unsafe.Pointer")]),t._v("ã€‚å› æ­¤æƒ³ç€å†ä»‹ç»ä¸€ä¸‹å…¶å…³è”çŸ¥è¯†")]),t._v(" "),e("h2",{attrs:{id:"å‰è¨€"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[t._v("#")]),t._v(" å‰è¨€")]),t._v(" "),e("p",[t._v("åœ¨å¤§å®¶å­¦ä¹  Go çš„æ—¶å€™ï¼Œè‚¯å®šéƒ½å­¦è¿‡ â€œGo çš„æŒ‡é’ˆæ˜¯ä¸æ”¯æŒæŒ‡é’ˆè¿ç®—å’Œè½¬æ¢â€ è¿™ä¸ªçŸ¥è¯†ç‚¹ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ")]),t._v(" "),e("p",[t._v("é¦–å…ˆï¼ŒGo æ˜¯ä¸€é—¨é™æ€è¯­è¨€ï¼Œæ‰€æœ‰çš„å˜é‡éƒ½å¿…é¡»ä¸ºæ ‡é‡ç±»å‹ã€‚ä¸åŒçš„ç±»å‹ä¸èƒ½å¤Ÿè¿›è¡Œèµ‹å€¼ã€è®¡ç®—ç­‰è·¨ç±»å‹çš„æ“ä½œã€‚é‚£ä¹ˆæŒ‡é’ˆä¹Ÿå¯¹åº”ç€ç›¸å¯¹çš„ç±»å‹ï¼Œä¹Ÿåœ¨ Compile çš„é™æ€ç±»å‹æ£€æŸ¥çš„èŒƒå›´å†…ã€‚åŒæ—¶é™æ€è¯­è¨€ï¼Œä¹Ÿç§°ä¸ºå¼ºç±»å‹ã€‚ä¹Ÿå°±æ˜¯ä¸€æ—¦å®šä¹‰äº†ï¼Œå°±ä¸èƒ½å†æ”¹å˜å®ƒ")]),t._v(" "),e("h2",{attrs:{id:"é”™è¯¯ç¤ºä¾‹"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#é”™è¯¯ç¤ºä¾‹"}},[t._v("#")]),t._v(" é”™è¯¯ç¤ºä¾‹")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("func main(){\n\tnum := 5\n\tnumPointer := &num\n\n\tflnum := (*float32)(numPointer)\n\tfmt.Println(flnum)\n}\n")])])]),e("p",[t._v("è¾“å‡ºç»“æœï¼š")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# command-line-arguments\n...: cannot convert numPointer (type *int) to type *float32\n")])])]),e("p",[t._v("åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª "),e("code",[t._v("num")]),t._v(" å˜é‡ï¼Œå€¼ä¸º 5ï¼Œç±»å‹ä¸º "),e("code",[t._v("int")]),t._v("ã€‚å–äº†å…¶å¯¹äºçš„æŒ‡é’ˆåœ°å€åï¼Œè¯•å›¾å¼ºåˆ¶è½¬æ¢ä¸º "),e("code",[t._v("*float32")]),t._v("ï¼Œç»“æœå¤±è´¥...")]),t._v(" "),e("h2",{attrs:{id:"unsafe"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#unsafe"}},[t._v("#")]),t._v(" unsafe")]),t._v(" "),e("p",[t._v("é’ˆå¯¹åˆšåˆšçš„ â€œé”™è¯¯ç¤ºä¾‹â€ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä»Šå¤©çš„ç”·ä¸»è§’ "),e("code",[t._v("unsafe")]),t._v(" æ ‡å‡†åº“æ¥è§£å†³ã€‚å®ƒæ˜¯ä¸€ä¸ªç¥å¥‡çš„åŒ…ï¼Œåœ¨å®˜æ–¹çš„è¯ é‡Šä¸­ï¼Œæœ‰å¦‚ä¸‹æ¦‚è¿°ï¼š")]),t._v(" "),e("ul",[e("li",[t._v("å›´ç»• Go ç¨‹åºå†…å­˜å®‰å…¨åŠç±»å‹çš„æ“ä½œ")]),t._v(" "),e("li",[t._v("å¾ˆå¯èƒ½ä¼šæ˜¯ä¸å¯ç§»æ¤çš„")]),t._v(" "),e("li",[t._v("ä¸å— Go 1 å…¼å®¹æ€§æŒ‡å—çš„ä¿æŠ¤")])]),t._v(" "),e("p",[t._v("ç®€å•æ¥è®²å°±æ˜¯ï¼Œä¸æ€ä¹ˆæ¨èä½ ä½¿ç”¨ã€‚å› ä¸ºå®ƒæ˜¯ unsafeï¼ˆä¸å®‰å…¨çš„ï¼‰ï¼Œä½†æ˜¯åœ¨ç‰¹æ®Šçš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨äº†å®ƒã€‚å¯ä»¥æ‰“ç ´ Go çš„ç±»å‹å’Œå†…å­˜å®‰å…¨æœºåˆ¶ï¼Œè®©ä½ è·å¾—çœ¼å‰ä¸€äº®çš„æƒŠå–œæ•ˆæœ ğŸ˜„")]),t._v(" "),e("h3",{attrs:{id:"pointer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pointer"}},[t._v("#")]),t._v(" Pointer")]),t._v(" "),e("p",[t._v("ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ç”¨åˆ° "),e("code",[t._v("unsafe.Pointer")]),t._v("ã€‚å®ƒè¡¨ç¤ºä»»æ„ç±»å‹ä¸”å¯å¯»å€çš„æŒ‡é’ˆå€¼ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æŒ‡é’ˆç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼ˆç±»ä¼¼ C è¯­è¨€çš„ void * çš„ç”¨é€”ï¼‰")]),t._v(" "),e("p",[t._v("å…¶åŒ…å«å››ç§æ ¸å¿ƒæ“ä½œï¼š")]),t._v(" "),e("ul",[e("li",[t._v("ä»»ä½•ç±»å‹çš„æŒ‡é’ˆå€¼éƒ½å¯ä»¥è½¬æ¢ä¸º Pointer")]),t._v(" "),e("li",[t._v("Pointer å¯ä»¥è½¬æ¢ä¸ºä»»ä½•ç±»å‹çš„æŒ‡é’ˆå€¼")]),t._v(" "),e("li",[t._v("uintptr å¯ä»¥è½¬æ¢ä¸º Pointer")]),t._v(" "),e("li",[t._v("Pointer å¯ä»¥è½¬æ¢ä¸º uintptr")])]),t._v(" "),e("p",[t._v("åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œé‡ç‚¹çœ‹ç¬¬ä¸€ç‚¹ã€ç¬¬äºŒç‚¹ã€‚ä½ å†æƒ³æƒ³æ€ä¹ˆä¿®æ”¹ â€œé”™è¯¯ç¤ºä¾‹â€ è®©å®ƒè¿è¡Œèµ·æ¥ï¼Ÿ")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("func main(){\n\tnum := 5\n\tnumPointer := &num\n\n\tflnum := (*float32)(unsafe.Pointer(numPointer))\n\tfmt.Println(flnum)\n}\n")])])]),e("p",[t._v("è¾“å‡ºç»“æœï¼š")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("0xc4200140b0\n")])])]),e("p",[t._v("åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°åŠ æ”¹åŠ¨ã€‚é€šè¿‡ "),e("code",[t._v("unsafe.Pointer")]),t._v(" çš„ç‰¹æ€§å¯¹è¯¥æŒ‡é’ˆå˜é‡è¿›è¡Œäº†ä¿®æ”¹ï¼Œå°±å¯ä»¥å®Œæˆä»»æ„ç±»å‹ï¼ˆ*Tï¼‰çš„æŒ‡é’ˆè½¬æ¢")]),t._v(" "),e("p",[t._v("éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ—¶è¿˜æ— æ³•å¯¹å˜é‡è¿›è¡Œæ“ä½œæˆ–è®¿é—®ã€‚å› ä¸ºä¸çŸ¥é“è¯¥æŒ‡é’ˆåœ°å€æŒ‡å‘çš„ä¸œè¥¿å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹ã€‚ä¸çŸ¥é“æ˜¯ä»€ä¹ˆç±»å‹ï¼Œåˆå¦‚ä½•è¿›è¡Œè§£æå‘¢ã€‚æ— æ³•è§£æä¹Ÿå°±è‡ªç„¶æ— æ³•å¯¹å…¶å˜æ›´äº†")]),t._v(" "),e("h3",{attrs:{id:"offsetof"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#offsetof"}},[t._v("#")]),t._v(" Offsetof")]),t._v(" "),e("p",[t._v("åœ¨ä¸Šå°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¯¹æ™®é€šçš„æŒ‡é’ˆå˜é‡è¿›è¡Œäº†ä¿®æ”¹ã€‚é‚£ä¹ˆå®ƒæ˜¯å¦èƒ½åšæ›´å¤æ‚ä¸€ç‚¹çš„äº‹å‘¢ï¼Ÿ")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('type Num struct{\n\ti string\n\tj int64\n}\n\nfunc main(){\n\tn := Num{i: "EDDYCJY", j: 1}\n\tnPointer := unsafe.Pointer(&n)\n\n\tniPointer := (*string)(unsafe.Pointer(nPointer))\n\t*niPointer = "ç…é±¼"\n\n\tnjPointer := (*int64)(unsafe.Pointer(uintptr(nPointer) + unsafe.Offsetof(n.j)))\n\t*njPointer = 2\n\n\tfmt.Printf("n.i: %s, n.j: %d", n.i, n.j)\n}\n\n')])])]),e("p",[t._v("è¾“å‡ºç»“æœï¼š")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("n.i: ç…é±¼, n.j: 2\n")])])]),e("p",[t._v("åœ¨å‰–æè¿™æ®µä»£ç åšäº†ä»€ä¹ˆäº‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ç»“æ„ä½“çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼š")]),t._v(" "),e("ul",[e("li",[t._v("ç»“æ„ä½“çš„æˆå‘˜å˜é‡åœ¨å†…å­˜å­˜å‚¨ä¸Šæ˜¯ä¸€æ®µè¿ç»­çš„å†…å­˜")]),t._v(" "),e("li",[t._v("ç»“æ„ä½“çš„åˆå§‹åœ°å€å°±æ˜¯ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡çš„å†…å­˜åœ°å€")]),t._v(" "),e("li",[t._v("åŸºäºç»“æ„ä½“çš„æˆå‘˜åœ°å€å»è®¡ç®—åç§»é‡ã€‚å°±èƒ½å¤Ÿå¾—å‡ºå…¶ä»–æˆå‘˜å˜é‡çš„å†…å­˜åœ°å€")])]),t._v(" "),e("p",[t._v("å†å›æ¥çœ‹çœ‹ä¸Šè¿°ä»£ç ï¼Œå¾—å‡ºæ‰§è¡Œæµç¨‹ï¼š")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("ä¿®æ”¹ "),e("code",[t._v("n.i")]),t._v(" å€¼ï¼š"),e("code",[t._v("i")]),t._v(" ä¸ºç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡ã€‚å› æ­¤ä¸éœ€è¦è¿›è¡Œåç§»é‡è®¡ç®—ï¼Œç›´æ¥å–å‡ºæŒ‡é’ˆåè½¬æ¢ä¸º "),e("code",[t._v("Pointer")]),t._v("ï¼Œå†å¼ºåˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹çš„æŒ‡é’ˆå€¼å³å¯")])]),t._v(" "),e("li",[e("p",[t._v("ä¿®æ”¹ "),e("code",[t._v("n.j")]),t._v(" å€¼ï¼š"),e("code",[t._v("j")]),t._v(" ä¸ºç¬¬äºŒä¸ªæˆå‘˜å˜é‡ã€‚éœ€è¦è¿›è¡Œåç§»é‡è®¡ç®—ï¼Œæ‰å¯ä»¥å¯¹å…¶å†…å­˜åœ°å€è¿›è¡Œä¿®æ”¹ã€‚åœ¨è¿›è¡Œäº†åç§»è¿ç®—åï¼Œå½“å‰åœ°å€å·²ç»æŒ‡å‘ç¬¬äºŒä¸ªæˆå‘˜å˜é‡ã€‚æ¥ç€é‡å¤è½¬æ¢èµ‹å€¼å³å¯")])])]),t._v(" "),e("p",[t._v("éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä½¿ç”¨äº†å¦‚ä¸‹æ–¹æ³•ï¼ˆæ¥å®Œæˆåç§»è®¡ç®—çš„ç›®æ ‡ï¼‰ï¼š")]),t._v(" "),e("p",[t._v("1ã€uintptrï¼š"),e("code",[t._v("uintptr")]),t._v(" æ˜¯ Go çš„å†…ç½®ç±»å‹ã€‚è¿”å›æ— ç¬¦å·æ•´æ•°ï¼Œå¯å­˜å‚¨ä¸€ä¸ªå®Œæ•´çš„åœ°å€ã€‚åç»­å¸¸ç”¨äºæŒ‡é’ˆè¿ç®—")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("type uintptr uintptr\n")])])]),e("p",[t._v("2ã€unsafe.Offsetofï¼šè¿”å›æˆå‘˜å˜é‡ x åœ¨ç»“æ„ä½“å½“ä¸­çš„åç§»é‡ã€‚æ›´å…·ä½“çš„è®²ï¼Œå°±æ˜¯è¿”å›ç»“æ„ä½“åˆå§‹ä½ç½®åˆ° x ä¹‹é—´çš„å­—èŠ‚æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å…¥å‚ "),e("code",[t._v("ArbitraryType")]),t._v(" è¡¨ç¤ºä»»æ„ç±»å‹ï¼Œå¹¶éå®šä¹‰çš„ "),e("code",[t._v("int")]),t._v("ã€‚å®ƒå®é™…ä½œç”¨æ˜¯ä¸€ä¸ªå ä½ç¬¦")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("func Offsetof(x ArbitraryType) uintptr\n")])])]),e("p",[t._v("åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œå…¶å®å°±æ˜¯å·§ç”¨äº† "),e("code",[t._v("Pointer")]),t._v(" çš„ç¬¬ä¸‰ã€ç¬¬å››ç‚¹ç‰¹æ€§ã€‚è¿™æ—¶å€™å°±å·²ç»å¯ä»¥å¯¹å˜é‡è¿›è¡Œæ“ä½œäº† ğŸ˜„")]),t._v(" "),e("h3",{attrs:{id:"é”™è¯¯ç¤ºä¾‹-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#é”™è¯¯ç¤ºä¾‹-2"}},[t._v("#")]),t._v(" é”™è¯¯ç¤ºä¾‹")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('func main(){\n\tn := Num{i: "EDDYCJY", j: 1}\n\tnPointer := unsafe.Pointer(&n)\n    ...\n\n\tptr := uintptr(nPointer)\n\tnjPointer := (*int64)(unsafe.Pointer(ptr + unsafe.Offsetof(n.j)))\n\t...\n}\n')])])]),e("p",[t._v("è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œ"),e("code",[t._v("uintptr")]),t._v(" ç±»å‹æ˜¯ä¸èƒ½å­˜å‚¨åœ¨ä¸´æ—¶å˜é‡ä¸­çš„ã€‚å› ä¸ºä» GC çš„è§’åº¦æ¥çœ‹ï¼Œ"),e("code",[t._v("uintptr")]),t._v(" ç±»å‹çš„ä¸´æ—¶å˜é‡åªæ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œå¹¶ä¸çŸ¥é“å®ƒæ˜¯ä¸€ä¸ªæŒ‡é’ˆåœ°å€")]),t._v(" "),e("p",[t._v("å› æ­¤å½“æ»¡è¶³ä¸€å®šæ¡ä»¶åï¼Œ"),e("code",[t._v("ptr")]),t._v(" è¿™ä¸ªä¸´æ—¶å˜é‡æ˜¯å¯èƒ½è¢«åƒåœ¾å›æ”¶æ‰çš„ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„å†…å­˜æ“ä½œï¼Œå²‚ä¸æˆè¿·ï¼Ÿ")]),t._v(" "),e("h2",{attrs:{id:"æ€»ç»“"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[t._v("#")]),t._v(" æ€»ç»“")]),t._v(" "),e("p",[t._v("ç®€æ´å›é¡¾ä¸¤ä¸ªçŸ¥è¯†ç‚¹ã€‚ç¬¬ä¸€æ˜¯ "),e("code",[t._v("unsafe.Pointer")]),t._v(" å¯ä»¥è®©ä½ çš„å˜é‡åœ¨ä¸åŒçš„æŒ‡é’ˆç±»å‹è½¬æ¥è½¬å»ï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºä¸ºä»»æ„å¯å¯»å€çš„æŒ‡é’ˆç±»å‹ã€‚ç¬¬äºŒæ˜¯ "),e("code",[t._v("uintptr")]),t._v(" å¸¸ç”¨äºä¸ "),e("code",[t._v("unsafe.Pointer")]),t._v(" æ‰“é…åˆï¼Œç”¨äºåšæŒ‡é’ˆè¿ç®—ï¼Œå·§å¦™åœ°å¾ˆ")]),t._v(" "),e("p",[t._v("æœ€åè¿˜æ˜¯é‚£å¥ï¼Œæ²¡æœ‰ç‰¹æ®Šå¿…è¦çš„è¯ã€‚æ˜¯ä¸å»ºè®®ä½¿ç”¨ "),e("code",[t._v("unsafe")]),t._v(" æ ‡å‡†åº“ï¼Œå®ƒå¹¶ä¸å®‰å…¨ã€‚è™½ç„¶å®ƒå¸¸å¸¸èƒ½è®©ä½ çœ¼å‰ä¸€äº® ğŸ‘Œ")])])}),[],!1,null,null,null);n.default=v.exports}}]);