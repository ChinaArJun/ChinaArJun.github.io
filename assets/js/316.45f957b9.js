(window.webpackJsonp=window.webpackJsonp||[]).push([[316],{894:function(e,t,r){"use strict";r.r(t);var a=r(44),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"_4-4-tls-è¯ä¹¦è®¤è¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-tls-è¯ä¹¦è®¤è¯"}},[e._v("#")]),e._v(" 4.4 TLS è¯ä¹¦è®¤è¯")]),e._v(" "),r("p",[e._v("é¡¹ç›®åœ°å€ï¼šhttps://github.com/EDDYCJY/go-grpc-example")]),e._v(" "),r("h2",{attrs:{id:"å‰è¨€"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[e._v("#")]),e._v(" å‰è¨€")]),e._v(" "),r("p",[e._v("åœ¨å‰é¢çš„ç« èŠ‚é‡Œï¼Œæˆ‘ä»¬ä»‹ç»äº† gRPC çš„å››ç§ API ä½¿ç”¨æ–¹å¼ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•å‘¢ ğŸ˜€")]),e._v(" "),r("p",[e._v("æ­¤æ—¶å­˜åœ¨ä¸€ä¸ªå®‰å…¨é—®é¢˜ï¼Œå…ˆå‰çš„ä¾‹å­ä¸­ gRPC Client/Server éƒ½æ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œä¼šä¸ä¼šæœ‰è¢«çªƒå¬çš„é£é™©å‘¢ï¼Ÿ")]),e._v(" "),r("p",[e._v("ä»ç»“è®ºä¸Šæ¥è®²ï¼Œæ˜¯æœ‰çš„ã€‚åœ¨æ˜æ–‡é€šè®¯çš„æƒ…å†µä¸‹ï¼Œä½ çš„è¯·æ±‚å°±æ˜¯è£¸å¥”çš„ï¼Œæœ‰å¯èƒ½è¢«ç¬¬ä¸‰æ–¹æ¶æ„ç¯¡æ”¹æˆ–è€…ä¼ªé€ ä¸ºâ€œéæ³•â€çš„æ•°æ®")]),e._v(" "),r("h2",{attrs:{id:"æŠ“ä¸ªåŒ…"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æŠ“ä¸ªåŒ…"}},[e._v("#")]),e._v(" æŠ“ä¸ªåŒ…")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://image.eddycjy.com/15e68df2ba9aa7cace3e26e35c79f200.jpg",alt:"image"}})]),e._v(" "),r("p",[r("img",{attrs:{src:"https://image.eddycjy.com/ebebd3ea7d306ad2fcd311f1d8b46cc0.jpg",alt:"image"}})]),e._v(" "),r("p",[e._v("å—¯ï¼Œæ˜æ–‡ä¼ è¾“æ— è¯¯ã€‚è¿™æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ¥ä¸‹å°†æ”¹é€ æˆ‘ä»¬çš„ gRPCï¼Œä»¥ä¾¿äºè§£å†³è¿™ä¸ªé—®é¢˜ ğŸ˜¤")]),e._v(" "),r("h2",{attrs:{id:"è¯ä¹¦ç”Ÿæˆ"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#è¯ä¹¦ç”Ÿæˆ"}},[e._v("#")]),e._v(" è¯ä¹¦ç”Ÿæˆ")]),e._v(" "),r("h3",{attrs:{id:"ç§é’¥"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ç§é’¥"}},[e._v("#")]),e._v(" ç§é’¥")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("openssl ecparam -genkey -name secp384r1 -out server.key\n")])])]),r("h3",{attrs:{id:"è‡ªç­¾å…¬é’¥"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#è‡ªç­¾å…¬é’¥"}},[e._v("#")]),e._v(" è‡ªç­¾å…¬é’¥")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("openssl req -new -x509 -sha256 -key server.key -out server.pem -days 3650\n")])])]),r("h4",{attrs:{id:"å¡«å†™ä¿¡æ¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#å¡«å†™ä¿¡æ¯"}},[e._v("#")]),e._v(" å¡«å†™ä¿¡æ¯")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("Country Name (2 letter code) []:\nState or Province Name (full name) []:\nLocality Name (eg, city) []:\nOrganization Name (eg, company) []:\nOrganizational Unit Name (eg, section) []:\nCommon Name (eg, fully qualified host name) []:go-grpc-example\nEmail Address []:\n")])])]),r("h3",{attrs:{id:"ç”Ÿæˆå®Œæ¯•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ç”Ÿæˆå®Œæ¯•"}},[e._v("#")]),e._v(" ç”Ÿæˆå®Œæ¯•")]),e._v(" "),r("p",[e._v("ç”Ÿæˆè¯ä¹¦ç»“æŸåï¼Œå°†è¯ä¹¦ç›¸å…³æ–‡ä»¶æ”¾åˆ° conf/ ä¸‹ï¼Œç›®å½•ç»“æ„ï¼š")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("$ tree go-grpc-example \ngo-grpc-example\nâ”œâ”€â”€ client\nâ”œâ”€â”€ conf\nâ”‚Â Â  â”œâ”€â”€ server.key\nâ”‚Â Â  â””â”€â”€ server.pem\nâ”œâ”€â”€ proto\nâ””â”€â”€ server\n    â”œâ”€â”€ simple_server\n    â””â”€â”€ stream_server\n")])])]),r("p",[e._v("ç”±äºæœ¬æ–‡åå‘ gRPCï¼Œè¯¦è§£å¯å‚è§ "),r("a",{attrs:{href:"https://segmentfault.com/a/1190000013408485#articleHeader3",target:"_blank",rel:"noopener noreferrer"}},[e._v("ã€Šåˆ¶ä½œè¯ä¹¦ã€‹"),r("OutboundLink")],1),e._v("ã€‚åç»­ç•ªå¤–å¯èƒ½ä¼šå±•å¼€ç»†èŠ‚æè¿° ğŸ‘Œ")]),e._v(" "),r("h2",{attrs:{id:"ä¸ºä»€ä¹ˆä¹‹å‰ä¸éœ€è¦è¯ä¹¦"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆä¹‹å‰ä¸éœ€è¦è¯ä¹¦"}},[e._v("#")]),e._v(" ä¸ºä»€ä¹ˆä¹‹å‰ä¸éœ€è¦è¯ä¹¦")]),e._v(" "),r("p",[e._v("åœ¨ simple_server ä¸­ï¼Œä¸ºä»€ä¹ˆâ€œå•¥äº‹éƒ½æ²¡å¹²â€å°±èƒ½åœ¨ä¸éœ€è¦è¯ä¹¦çš„æƒ…å†µä¸‹è¿è¡Œå‘¢ï¼Ÿ")]),e._v(" "),r("h3",{attrs:{id:"server"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#server"}},[e._v("#")]),e._v(" Server")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("grpc.NewServer()\n")])])]),r("p",[e._v("åœ¨æœåŠ¡ç«¯æ˜¾ç„¶æ²¡æœ‰ä¼ å…¥ä»»ä½• DialOptions")]),e._v(" "),r("h3",{attrs:{id:"client"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#client"}},[e._v("#")]),e._v(" Client")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('conn, err := grpc.Dial(":"+PORT, grpc.WithInsecure())\n')])])]),r("p",[e._v("åœ¨å®¢æˆ·ç«¯ç•™æ„åˆ° "),r("code",[e._v("grpc.WithInsecure()")]),e._v(" æ–¹æ³•")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("func WithInsecure() DialOption {\n\treturn newFuncDialOption(func(o *dialOptions) {\n\t\to.insecure = true\n\t})\n}\n")])])]),r("p",[e._v("åœ¨æ–¹æ³•å†…å¯ä»¥çœ‹åˆ° "),r("code",[e._v("WithInsecure")]),e._v(" è¿”å›ä¸€ä¸ª "),r("code",[e._v("DialOption")]),e._v("ï¼Œå¹¶ä¸”å®ƒæœ€ç»ˆä¼šé€šè¿‡è¯»å–è®¾ç½®çš„å€¼æ¥ç¦ç”¨å®‰å…¨ä¼ è¾“")]),e._v(" "),r("p",[e._v("é‚£ä¹ˆå®ƒâ€œæœ€ç»ˆâ€åˆæ˜¯åœ¨å“ªé‡Œå¤„ç†çš„å‘¢ï¼Œæˆ‘ä»¬æŠŠè§†çº¿ç§»åˆ° "),r("code",[e._v("grpc.Dial()")]),e._v(" æ–¹æ³•å†…")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('func DialContext(ctx context.Context, target string, opts ...DialOption) (conn *ClientConn, err error) {\n    ...\n    \n    for _, opt := range opts {\n\t\topt.apply(&cc.dopts)\n\t}\n    ...\n    \n    if !cc.dopts.insecure {\n\t\tif cc.dopts.copts.TransportCredentials == nil {\n\t\t\treturn nil, errNoTransportSecurity\n\t\t}\n\t} else {\n\t\tif cc.dopts.copts.TransportCredentials != nil {\n\t\t\treturn nil, errCredentialsConflict\n\t\t}\n\t\tfor _, cd := range cc.dopts.copts.PerRPCCredentials {\n\t\t\tif cd.RequireTransportSecurity() {\n\t\t\t\treturn nil, errTransportCredentialsMissing\n\t\t\t}\n\t\t}\n\t}\n\t...\n\t\n\tcreds := cc.dopts.copts.TransportCredentials\n\tif creds != nil && creds.Info().ServerName != "" {\n\t\tcc.authority = creds.Info().ServerName\n\t} else if cc.dopts.insecure && cc.dopts.authority != "" {\n\t\tcc.authority = cc.dopts.authority\n\t} else {\n\t\t// Use endpoint from "scheme://authority/endpoint" as the default\n\t\t// authority for ClientConn.\n\t\tcc.authority = cc.parsedTarget.Endpoint\n\t}\n\t...\n}\n')])])]),r("h2",{attrs:{id:"grpc"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#grpc"}},[e._v("#")]),e._v(" gRPC")]),e._v(" "),r("p",[e._v("æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ­£å¼å¼€å§‹ç¼–ç ï¼Œåœ¨ gRPC Client/Server ä¸Šå®ç° TLS è¯ä¹¦è®¤è¯çš„æ”¯æŒ ğŸ¤”")]),e._v(" "),r("h3",{attrs:{id:"tls-server"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#tls-server"}},[e._v("#")]),e._v(" TLS Server")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('package main\n\nimport (\n\t"context"\n\t"log"\n\t"net"\n\n\t"google.golang.org/grpc"\n\t"google.golang.org/grpc/credentials"\n\n\tpb "github.com/EDDYCJY/go-grpc-example/proto"\n)\n\n...\n\nconst PORT = "9001"\n\nfunc main() {\n\tc, err := credentials.NewServerTLSFromFile("../../conf/server.pem", "../../conf/server.key")\n\tif err != nil {\n\t\tlog.Fatalf("credentials.NewServerTLSFromFile err: %v", err)\n\t}\n\n\tserver := grpc.NewServer(grpc.Creds(c))\n\tpb.RegisterSearchServiceServer(server, &SearchService{})\n\n\tlis, err := net.Listen("tcp", ":"+PORT)\n\tif err != nil {\n\t\tlog.Fatalf("net.Listen err: %v", err)\n\t}\n\n\tserver.Serve(lis)\n}\n')])])]),r("ul",[r("li",[e._v("credentials.NewServerTLSFromFileï¼šæ ¹æ®æœåŠ¡ç«¯è¾“å…¥çš„è¯ä¹¦æ–‡ä»¶å’Œå¯†é’¥æ„é€  TLS å‡­è¯")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("func NewServerTLSFromFile(certFile, keyFile string) (TransportCredentials, error) {\n\tcert, err := tls.LoadX509KeyPair(certFile, keyFile)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn NewTLS(&tls.Config{Certificates: []tls.Certificate{cert}}), nil\n}\n")])])]),r("ul",[r("li",[e._v("grpc.Creds()ï¼šè¿”å›ä¸€ä¸ª ServerOptionï¼Œç”¨äºè®¾ç½®æœåŠ¡å™¨è¿æ¥çš„å‡­æ®ã€‚ç”¨äº "),r("code",[e._v("grpc.NewServer(opt ...ServerOption)")]),e._v(" ä¸º gRPC Server è®¾ç½®è¿æ¥é€‰é¡¹")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("func Creds(c credentials.TransportCredentials) ServerOption {\n\treturn func(o *options) {\n\t\to.creds = c\n\t}\n}\n")])])]),r("p",[e._v("ç»è¿‡ä»¥ä¸Šä¸¤ä¸ªç®€å•æ­¥éª¤ï¼ŒgRPC Server å°±å»ºç«‹èµ·éœ€è¯ä¹¦è®¤è¯çš„æœåŠ¡å•¦ ğŸ¤”")]),e._v(" "),r("h3",{attrs:{id:"tls-client"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#tls-client"}},[e._v("#")]),e._v(" TLS Client")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('package main\n\nimport (\n\t"context"\n\t"log"\n\n\t"google.golang.org/grpc"\n\t"google.golang.org/grpc/credentials"\n\n\tpb "github.com/EDDYCJY/go-grpc-example/proto"\n)\n\nconst PORT = "9001"\n\nfunc main() {\n\tc, err := credentials.NewClientTLSFromFile("../../conf/server.pem", "go-grpc-example")\n\tif err != nil {\n\t\tlog.Fatalf("credentials.NewClientTLSFromFile err: %v", err)\n\t}\n\n\tconn, err := grpc.Dial(":"+PORT, grpc.WithTransportCredentials(c))\n\tif err != nil {\n\t\tlog.Fatalf("grpc.Dial err: %v", err)\n\t}\n\tdefer conn.Close()\n\n\tclient := pb.NewSearchServiceClient(conn)\n\tresp, err := client.Search(context.Background(), &pb.SearchRequest{\n\t\tRequest: "gRPC",\n\t})\n\tif err != nil {\n\t\tlog.Fatalf("client.Search err: %v", err)\n\t}\n\n\tlog.Printf("resp: %s", resp.GetResponse())\n}\n')])])]),r("ul",[r("li",[e._v("credentials.NewClientTLSFromFile()ï¼šæ ¹æ®å®¢æˆ·ç«¯è¾“å…¥çš„è¯ä¹¦æ–‡ä»¶å’Œå¯†é’¥æ„é€  TLS å‡­è¯ã€‚serverNameOverride ä¸ºæœåŠ¡åç§°")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('func NewClientTLSFromFile(certFile, serverNameOverride string) (TransportCredentials, error) {\n\tb, err := ioutil.ReadFile(certFile)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tcp := x509.NewCertPool()\n\tif !cp.AppendCertsFromPEM(b) {\n\t\treturn nil, fmt.Errorf("credentials: failed to append certificates")\n\t}\n\treturn NewTLS(&tls.Config{ServerName: serverNameOverride, RootCAs: cp}), nil\n}\n')])])]),r("ul",[r("li",[e._v("grpc.WithTransportCredentials()ï¼šè¿”å›ä¸€ä¸ªé…ç½®è¿æ¥çš„ DialOption é€‰é¡¹ã€‚ç”¨äº "),r("code",[e._v("grpc.Dial(target string, opts ...DialOption)")]),e._v(" è®¾ç½®è¿æ¥é€‰é¡¹")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("func WithTransportCredentials(creds credentials.TransportCredentials) DialOption {\n\treturn newFuncDialOption(func(o *dialOptions) {\n\t\to.copts.TransportCredentials = creds\n\t})\n}\n")])])]),r("h2",{attrs:{id:"éªŒè¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#éªŒè¯"}},[e._v("#")]),e._v(" éªŒè¯")]),e._v(" "),r("h3",{attrs:{id:"è¯·æ±‚"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#è¯·æ±‚"}},[e._v("#")]),e._v(" è¯·æ±‚")]),e._v(" "),r("p",[e._v("é‡æ–°å¯åŠ¨ server.go å’Œæ‰§è¡Œ client.goï¼Œå¾—åˆ°å“åº”ç»“æœ")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("$ go run client.go\n2018/09/30 20:00:21 resp: gRPC Server\n")])])]),r("h3",{attrs:{id:"æŠ“ä¸ªåŒ…-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æŠ“ä¸ªåŒ…-2"}},[e._v("#")]),e._v(" æŠ“ä¸ªåŒ…")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://image.eddycjy.com/c8ad6edf1f7d084883b847b3eee29dd2.jpg",alt:"image"}})]),e._v(" "),r("p",[e._v("æˆåŠŸã€‚")]),e._v(" "),r("h2",{attrs:{id:"æ€»ç»“"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[e._v("#")]),e._v(" æ€»ç»“")]),e._v(" "),r("p",[e._v("åœ¨æœ¬ç« èŠ‚æˆ‘ä»¬å®ç°äº† gRPC TLS Client/Servertï¼Œä½ ä»¥ä¸ºå¤§åŠŸå‘Šæˆäº†å—ï¼Ÿæˆ‘ä¸ ğŸ˜¤")]),e._v(" "),r("h2",{attrs:{id:"é—®é¢˜"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#é—®é¢˜"}},[e._v("#")]),e._v(" é—®é¢˜")]),e._v(" "),r("p",[e._v("ä½ ä»”ç»†å†çœ‹çœ‹ï¼ŒClient æ˜¯åŸºäº Server ç«¯çš„è¯ä¹¦å’ŒæœåŠ¡åç§°æ¥å»ºç«‹è¯·æ±‚çš„ã€‚è¿™æ ·çš„è¯ï¼Œä½ å°±éœ€è¦å°† Server çš„è¯ä¹¦é€šè¿‡å„ç§æ‰‹æ®µç»™åˆ° Client ç«¯ï¼Œå¦åˆ™æ˜¯æ— æ³•å®Œæˆè¿™é¡¹ä»»åŠ¡çš„")]),e._v(" "),r("p",[e._v("é—®é¢˜ä¹Ÿå°±æ¥äº†ï¼Œä½ æ— æ³•ä¿è¯ä½ çš„â€œå„ç§æ‰‹æ®µâ€æ˜¯å®‰å…¨çš„ï¼Œæ¯•ç«Ÿç°åœ¨çš„ç½‘ç»œç¯å¢ƒæ˜¯å¾ˆå±é™©çš„ï¼Œä¸‡ä¸€è¢«...")]),e._v(" "),r("p",[e._v("æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« èŠ‚è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¿è¯å…¶å¯é æ€§ ğŸ™‚")]),e._v(" "),r("h2",{attrs:{id:"å‚è€ƒ"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒ"}},[e._v("#")]),e._v(" å‚è€ƒ")]),e._v(" "),r("h3",{attrs:{id:"æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç "}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç "}},[e._v("#")]),e._v(" æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç ")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://github.com/EDDYCJY/go-grpc-example",target:"_blank",rel:"noopener noreferrer"}},[e._v("go-grpc-example"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);