(window.webpackJsonp=window.webpackJsonp||[]).push([[315],{893:function(t,e,r){"use strict";r.r(e);var n=r(44),a=Object(n.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"_4-7-è®©ä½ çš„æœåŠ¡åŒæ—¶æä¾›-http-æ¥å£"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-è®©ä½ çš„æœåŠ¡åŒæ—¶æä¾›-http-æ¥å£"}},[t._v("#")]),t._v(" 4.7 è®©ä½ çš„æœåŠ¡åŒæ—¶æä¾› HTTP æ¥å£")]),t._v(" "),r("p",[t._v("é¡¹ç›®åœ°å€ï¼šhttps://github.com/EDDYCJY/go-grpc-example")]),t._v(" "),r("h2",{attrs:{id:"å‰è¨€"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[t._v("#")]),t._v(" å‰è¨€")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("æ¥å£éœ€è¦æä¾›ç»™å…¶ä»–ä¸šåŠ¡ç»„è®¿é—®ï¼Œä½†æ˜¯ RPC åè®®ä¸åŒæ— æ³•å†…è°ƒï¼Œå¯¹æ–¹é—®èƒ½å¦èµ° HTTP æ¥å£ï¼Œæ€ä¹ˆåŠï¼Ÿ")])]),t._v(" "),r("li",[r("p",[t._v("å¾®ä¿¡ï¼ˆå…¬ä¼—å·ã€å°ç¨‹åºï¼‰ç­‰ç¬¬ä¸‰æ–¹å›è°ƒæ¥å£åªæ”¯æŒ HTTP æ¥å£ï¼Œæ€ä¹ˆåŠ")])])]),t._v(" "),r("p",[t._v("æˆ‘ç›¸ä¿¡ä½ åœ¨å®é™…å·¥ä½œä¸­éƒ½ä¼šé‡åˆ°å¦‚ä¸Šé—®é¢˜ï¼Œåœ¨ gRPC ä¸­éƒ½æ˜¯æœ‰è§£å†³æ–¹æ¡ˆçš„ï¼Œæœ¬ç« èŠ‚å°†ä¼šè¿›è¡Œä»‹ç» ğŸ¤”")]),t._v(" "),r("h2",{attrs:{id:"ä¸ºä»€ä¹ˆå¯ä»¥åŒæ—¶æä¾›-http-æ¥å£"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆå¯ä»¥åŒæ—¶æä¾›-http-æ¥å£"}},[t._v("#")]),t._v(" ä¸ºä»€ä¹ˆå¯ä»¥åŒæ—¶æä¾› HTTP æ¥å£")]),t._v(" "),r("p",[t._v("å…³é”®ä¸€ç‚¹ï¼ŒgRPC çš„åè®®æ˜¯åŸºäº HTTP/2 çš„ï¼Œå› æ­¤åº”ç”¨ç¨‹åºèƒ½å¤Ÿåœ¨å•ä¸ª TCP ç«¯å£ä¸Šæä¾› HTTP/1.1 å’Œ gRPC æ¥å£æœåŠ¡ï¼ˆä¸¤ç§ä¸åŒçš„æµé‡ï¼‰")]),t._v(" "),r("h2",{attrs:{id:"æ€ä¹ˆåŒæ—¶æä¾›-http-æ¥å£"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æ€ä¹ˆåŒæ—¶æä¾›-http-æ¥å£"}},[t._v("#")]),t._v(" æ€ä¹ˆåŒæ—¶æä¾› HTTP æ¥å£")]),t._v(" "),r("h3",{attrs:{id:"æ£€æµ‹åè®®"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æ£€æµ‹åè®®"}},[t._v("#")]),t._v(" æ£€æµ‹åè®®")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v('if r.ProtoMajor == 2 && strings.Contains(r.Header.Get("Content-Type"), "application/grpc") {\n    server.ServeHTTP(w, r)\n} else {\n    mux.ServeHTTP(w, r)\n}\n')])])]),r("h3",{attrs:{id:"æµç¨‹"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æµç¨‹"}},[t._v("#")]),t._v(" æµç¨‹")]),t._v(" "),r("ol",[r("li",[t._v("æ£€æµ‹è¯·æ±‚åè®®æ˜¯å¦ä¸º HTTP/2")]),t._v(" "),r("li",[t._v("åˆ¤æ–­ Content-Type æ˜¯å¦ä¸º application/grpcï¼ˆgRPC çš„é»˜è®¤æ ‡è¯†ä½ï¼‰")]),t._v(" "),r("li",[t._v("æ ¹æ®åè®®çš„ä¸åŒè½¬å‘åˆ°ä¸åŒçš„æœåŠ¡å¤„ç†")])]),t._v(" "),r("h2",{attrs:{id:"grpc"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#grpc"}},[t._v("#")]),t._v(" gRPC")]),t._v(" "),r("h3",{attrs:{id:"tls"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#tls"}},[t._v("#")]),t._v(" TLS")]),t._v(" "),r("p",[t._v("åœ¨å‰é¢çš„ç« èŠ‚ï¼Œä¸ºäº†ä¾¿äºå±•ç¤ºå› æ­¤æ²¡æœ‰ç®€å•å°è£…")]),t._v(" "),r("p",[t._v("åœ¨æœ¬èŠ‚éœ€å¤ç”¨ä»£ç ï¼Œé‡æ–°å°è£…äº†ï¼Œå¯è¯¦è§ï¼š"),r("a",{attrs:{href:"https://github.com/EDDYCJY/go-grpc-example/tree/master/pkg/gtls",target:"_blank",rel:"noopener noreferrer"}},[t._v("go-grpc-example"),r("OutboundLink")],1)]),t._v(" "),r("h3",{attrs:{id:"ç›®å½•ç»“æ„"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ç›®å½•ç»“æ„"}},[t._v("#")]),t._v(" ç›®å½•ç»“æ„")]),t._v(" "),r("p",[t._v("æ–°å»º simple_http_clientã€simple_http_server ç›®å½•ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("go-grpc-example\nâ”œâ”€â”€ client\nâ”‚Â Â  â”œâ”€â”€ simple_client\nâ”‚Â Â  â”œâ”€â”€ simple_http_client\nâ”‚Â Â  â””â”€â”€ stream_client\nâ”œâ”€â”€ conf\nâ”œâ”€â”€ pkg\nâ”‚Â Â  â””â”€â”€ gtls\nâ”œâ”€â”€ proto\nâ”œâ”€â”€ server\nâ”‚Â Â  â”œâ”€â”€ simple_http_server\nâ”‚Â Â  â”œâ”€â”€ simple_server\nâ”‚Â Â  â””â”€â”€ stream_server\n")])])]),r("h3",{attrs:{id:"server"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#server"}},[t._v("#")]),t._v(" Server")]),t._v(" "),r("p",[t._v("åœ¨ simple_http_server ç›®å½•ä¸‹æ–°å»º server.goï¼Œå†™å…¥æ–‡ä»¶å†…å®¹ï¼š")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v('package main\n\nimport (\n\t"context"\n\t"log"\n\t"net/http"\n\t"strings"\n\n\t"github.com/EDDYCJY/go-grpc-example/pkg/gtls"\n\tpb "github.com/EDDYCJY/go-grpc-example/proto"\n\n\t"google.golang.org/grpc"\n)\n\ntype SearchService struct{}\n\nfunc (s *SearchService) Search(ctx context.Context, r *pb.SearchRequest) (*pb.SearchResponse, error) {\n\treturn &pb.SearchResponse{Response: r.GetRequest() + " HTTP Server"}, nil\n}\n\nconst PORT = "9003"\n\nfunc main() {\n\tcertFile := "../../conf/server/server.pem"\n\tkeyFile := "../../conf/server/server.key"\n\ttlsServer := gtls.Server{\n\t\tCertFile: certFile,\n\t\tKeyFile:  keyFile,\n\t}\n\n\tc, err := tlsServer.GetTLSCredentials()\n\tif err != nil {\n\t\tlog.Fatalf("tlsServer.GetTLSCredentials err: %v", err)\n\t}\n\n\tmux := GetHTTPServeMux()\n\n\tserver := grpc.NewServer(grpc.Creds(c))\n\tpb.RegisterSearchServiceServer(server, &SearchService{})\n\n\thttp.ListenAndServeTLS(":"+PORT,\n\t\tcertFile,\n\t\tkeyFile,\n\t\thttp.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\t\t\tif r.ProtoMajor == 2 && strings.Contains(r.Header.Get("Content-Type"), "application/grpc") {\n\t\t\t\tserver.ServeHTTP(w, r)\n\t\t\t} else {\n\t\t\t\tmux.ServeHTTP(w, r)\n\t\t\t}\n\n\t\t\treturn\n\t\t}),\n\t)\n}\n\nfunc GetHTTPServeMux() *http.ServeMux {\n\tmux := http.NewServeMux()\n\tmux.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {\n\t\tw.Write([]byte("eddycjy: go-grpc-example"))\n\t})\n\n\treturn mux\n}\n')])])]),r("ul",[r("li",[t._v("http.NewServeMuxï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ ServeMuxï¼ŒServeMux æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè·¯ç”±è¡¨ã€‚å®ƒé»˜è®¤å®ç°äº† ServeHTTPï¼Œå› æ­¤è¿”å› Handler åå¯ç›´æ¥é€šè¿‡ HandleFunc æ³¨å†Œ pattern å’Œå¤„ç†é€»è¾‘çš„æ–¹æ³•")]),t._v(" "),r("li",[t._v("http.ListenAndServeTLSï¼šå¯ç®€å•çš„ç†è§£ä¸ºæä¾›ç›‘å¬ HTTPS æœåŠ¡çš„æ–¹æ³•ï¼Œé‡ç‚¹çš„åè®®åˆ¤æ–­è½¬å‘ï¼Œä¹Ÿåœ¨è¿™é‡Œé¢")])]),t._v(" "),r("p",[t._v("å…¶å®ï¼Œä½ ç†è§£åå°±ä¼šè§‰å¾—å¾ˆç®€å•ï¼Œæ ¸å¿ƒæ­¥éª¤ï¼šåˆ¤æ–­ -> è½¬å‘ -> å“åº”ã€‚æˆ‘ä»¬æ”¹å˜äº†å‰ä¸¤æ­¥çš„é»˜è®¤é€»è¾‘ï¼Œä»…æ­¤è€Œå·²")]),t._v(" "),r("h3",{attrs:{id:"client"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#client"}},[t._v("#")]),t._v(" Client")]),t._v(" "),r("p",[t._v("åœ¨ simple_http_server ç›®å½•ä¸‹æ–°å»º client.goï¼Œå†™å…¥æ–‡ä»¶å†…å®¹ï¼š")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v('package main\n\nimport (\n\t"context"\n\t"log"\n\n\t"google.golang.org/grpc"\n\n\t"github.com/EDDYCJY/go-grpc-example/pkg/gtls"\n\tpb "github.com/EDDYCJY/go-grpc-example/proto"\n)\n\nconst PORT = "9003"\n\nfunc main() {\n\ttlsClient := gtls.Client{\n\t\tServerName: "go-grpc-example",\n\t\tCertFile:   "../../conf/server/server.pem",\n\t}\n\tc, err := tlsClient.GetTLSCredentials()\n\tif err != nil {\n\t\tlog.Fatalf("tlsClient.GetTLSCredentials err: %v", err)\n\t}\n\n\tconn, err := grpc.Dial(":"+PORT, grpc.WithTransportCredentials(c))\n\tif err != nil {\n\t\tlog.Fatalf("grpc.Dial err: %v", err)\n\t}\n\tdefer conn.Close()\n\n\tclient := pb.NewSearchServiceClient(conn)\n\tresp, err := client.Search(context.Background(), &pb.SearchRequest{\n\t\tRequest: "gRPC",\n\t})\n\tif err != nil {\n\t\tlog.Fatalf("client.Search err: %v", err)\n\t}\n\n\tlog.Printf("resp: %s", resp.GetResponse())\n}\n')])])]),r("h2",{attrs:{id:"éªŒè¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#éªŒè¯"}},[t._v("#")]),t._v(" éªŒè¯")]),t._v(" "),r("h3",{attrs:{id:"grpc-client"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#grpc-client"}},[t._v("#")]),t._v(" gRPC Client")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("$ go run client.go \n2018/10/04 14:56:56 resp: gRPC HTTP Server\n")])])]),r("h3",{attrs:{id:"http-1-1-è®¿é—®"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#http-1-1-è®¿é—®"}},[t._v("#")]),t._v(" HTTP/1.1 è®¿é—®")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://image.eddycjy.com/1d92cb9e949e32eef7f8a64a6a77deb9.jpg",alt:"image"}})]),t._v(" "),r("h2",{attrs:{id:"æ€»ç»“"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[t._v("#")]),t._v(" æ€»ç»“")]),t._v(" "),r("p",[t._v("é€šè¿‡æœ¬ç« èŠ‚ï¼Œè¡¨é¢ä¸Šå®Œæˆäº†åŒç«¯å£æä¾›åŒæœåŠ¡çš„åŠŸèƒ½ï¼Œä½†å®é™…ä¸Šï¼Œåº”è¯¥æ˜¯åŠ æ·±äº† HTTP/2 çš„ç†è§£å’Œä½¿ç”¨ï¼Œè¿™æ‰æ˜¯æœ¬è´¨")]),t._v(" "),r("h2",{attrs:{id:"æ‹“å±•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æ‹“å±•"}},[t._v("#")]),t._v(" æ‹“å±•")]),t._v(" "),r("p",[t._v("å¦‚æœä½ æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œæ˜¯è¦"),r("strong",[t._v("åŒæ—¶æä¾›")]),t._v(" RPC å’Œ RESTful JSON API ä¸¤ç§æ¥å£çš„ï¼Œä¸è¦çŠ¹è±«ï¼Œç‚¹è¿›å»ï¼š"),r("a",{attrs:{href:"https://segmentfault.com/a/1190000013339403",target:"_blank",rel:"noopener noreferrer"}},[t._v("gRPC + gRPC Gateway å®è·µ"),r("OutboundLink")],1)]),t._v(" "),r("h2",{attrs:{id:"é—®é¢˜"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#é—®é¢˜"}},[t._v("#")]),t._v(" é—®é¢˜")]),t._v(" "),r("p",[t._v("ä½ ä»¥ä¸ºè¿™ä¸ªæ–¹æ¡ˆå°±ä¸‡èƒ½äº†å—ï¼Œä¸ã€‚Envoy Proxy çš„æ”¯æŒå°±ä¸å®Œç¾ï¼Œæ— æ³•åŒæ—¶ç›‘å¬ä¸€ä¸ªç«¯å£çš„ä¸¤ç§æµé‡ ğŸ˜¤")]),t._v(" "),r("h2",{attrs:{id:"å‚è€ƒ"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒ"}},[t._v("#")]),t._v(" å‚è€ƒ")]),t._v(" "),r("h3",{attrs:{id:"æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç "}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç "}},[t._v("#")]),t._v(" æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç ")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://github.com/EDDYCJY/go-grpc-example",target:"_blank",rel:"noopener noreferrer"}},[t._v("go-grpc-example"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=a.exports}}]);