(window.webpackJsonp=window.webpackJsonp||[]).push([[336],{914:function(t,s,a){"use strict";a.r(s);var r=a(44),n=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_9-1-go-å¤§æ€å™¨ä¹‹æ€§èƒ½å‰–æ-pprof"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-go-å¤§æ€å™¨ä¹‹æ€§èƒ½å‰–æ-pprof"}},[t._v("#")]),t._v(" 9.1 Go å¤§æ€å™¨ä¹‹æ€§èƒ½å‰–æ PProf")]),t._v(" "),a("h2",{attrs:{id:"å‰è¨€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[t._v("#")]),t._v(" å‰è¨€")]),t._v(" "),a("p",[t._v("å†™äº†å‡ å¨ä»£ç ï¼Œå®ç°äº†å‡ ç™¾ä¸ªæ¥å£ã€‚åŠŸèƒ½æµ‹è¯•ä¹Ÿé€šè¿‡äº†ï¼Œç»ˆäºæˆåŠŸçš„éƒ¨ç½²ä¸Šçº¿äº†")]),t._v(" "),a("p",[t._v("ç»“æœï¼Œæ€§èƒ½ä¸ä½³ï¼Œä»€ä¹ˆé¬¼ï¼ŸğŸ˜­")]),t._v(" "),a("h2",{attrs:{id:"æƒ³åšæ€§èƒ½åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æƒ³åšæ€§èƒ½åˆ†æ"}},[t._v("#")]),t._v(" æƒ³åšæ€§èƒ½åˆ†æ")]),t._v(" "),a("h3",{attrs:{id:"pprof"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pprof"}},[t._v("#")]),t._v(" PProf")]),t._v(" "),a("p",[t._v("æƒ³è¦è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œé¦–å…ˆç©ç›®åœ¨ Go è‡ªèº«æä¾›çš„å·¥å…·é“¾æ¥ä½œä¸ºåˆ†æä¾æ®ï¼Œæœ¬æ–‡å°†å¸¦ä½ å­¦ä¹ ã€ä½¿ç”¨ Go åèŠ±å›­ï¼Œæ¶‰åŠå¦‚ä¸‹ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("runtime/pprofï¼šé‡‡é›†ç¨‹åºï¼ˆé Serverï¼‰çš„è¿è¡Œæ•°æ®è¿›è¡Œåˆ†æ")]),t._v(" "),a("li",[t._v("net/http/pprofï¼šé‡‡é›† HTTP Server çš„è¿è¡Œæ—¶æ•°æ®è¿›è¡Œåˆ†æ")])]),t._v(" "),a("h3",{attrs:{id:"æ˜¯ä»€ä¹ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ˜¯ä»€ä¹ˆ"}},[t._v("#")]),t._v(" æ˜¯ä»€ä¹ˆ")]),t._v(" "),a("p",[t._v("pprof æ˜¯ç”¨äºå¯è§†åŒ–å’Œåˆ†ææ€§èƒ½åˆ†ææ•°æ®çš„å·¥å…·")]),t._v(" "),a("p",[t._v("pprof ä»¥ "),a("a",{attrs:{href:"https://github.com/google/pprof/blob/master/proto/profile.proto",target:"_blank",rel:"noopener noreferrer"}},[t._v("profile.proto"),a("OutboundLink")],1),t._v(" è¯»å–åˆ†ææ ·æœ¬çš„é›†åˆï¼Œå¹¶ç”ŸæˆæŠ¥å‘Šä»¥å¯è§†åŒ–å¹¶å¸®åŠ©åˆ†ææ•°æ®ï¼ˆæ”¯æŒæ–‡æœ¬å’Œå›¾å½¢æŠ¥å‘Šï¼‰")]),t._v(" "),a("p",[t._v("profile.proto æ˜¯ä¸€ä¸ª Protocol Buffer v3 çš„æè¿°æ–‡ä»¶ï¼Œå®ƒæè¿°äº†ä¸€ç»„ callstack å’Œ symbolization ä¿¡æ¯ï¼Œ ä½œç”¨æ˜¯è¡¨ç¤ºç»Ÿè®¡åˆ†æçš„ä¸€ç»„é‡‡æ ·çš„è°ƒç”¨æ ˆï¼Œæ˜¯å¾ˆå¸¸è§çš„ stacktrace é…ç½®æ–‡ä»¶æ ¼å¼")]),t._v(" "),a("h3",{attrs:{id:"æ”¯æŒä»€ä¹ˆä½¿ç”¨æ¨¡å¼"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ”¯æŒä»€ä¹ˆä½¿ç”¨æ¨¡å¼"}},[t._v("#")]),t._v(" æ”¯æŒä»€ä¹ˆä½¿ç”¨æ¨¡å¼")]),t._v(" "),a("ul",[a("li",[t._v("Report generationï¼šæŠ¥å‘Šç”Ÿæˆ")]),t._v(" "),a("li",[t._v("Interactive terminal useï¼šäº¤äº’å¼ç»ˆç«¯ä½¿ç”¨")]),t._v(" "),a("li",[t._v("Web interfaceï¼šWeb ç•Œé¢")])]),t._v(" "),a("h3",{attrs:{id:"å¯ä»¥åšä»€ä¹ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¯ä»¥åšä»€ä¹ˆ"}},[t._v("#")]),t._v(" å¯ä»¥åšä»€ä¹ˆ")]),t._v(" "),a("ul",[a("li",[t._v("CPU Profilingï¼šCPU åˆ†æï¼ŒæŒ‰ç…§ä¸€å®šçš„é¢‘ç‡é‡‡é›†æ‰€ç›‘å¬çš„åº”ç”¨ç¨‹åº CPUï¼ˆå«å¯„å­˜å™¨ï¼‰çš„ä½¿ç”¨æƒ…å†µï¼Œå¯ç¡®å®šåº”ç”¨ç¨‹åºåœ¨ä¸»åŠ¨æ¶ˆè€— CPU å‘¨æœŸæ—¶èŠ±è´¹æ—¶é—´çš„ä½ç½®")]),t._v(" "),a("li",[t._v("Memory Profilingï¼šå†…å­˜åˆ†æï¼Œåœ¨åº”ç”¨ç¨‹åºè¿›è¡Œå †åˆ†é…æ—¶è®°å½•å †æ ˆè·Ÿè¸ªï¼Œç”¨äºç›‘è§†å½“å‰å’Œå†å²å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠæ£€æŸ¥å†…å­˜æ³„æ¼")]),t._v(" "),a("li",[t._v("Block Profilingï¼šé˜»å¡åˆ†æï¼Œè®°å½• goroutine é˜»å¡ç­‰å¾…åŒæ­¥ï¼ˆåŒ…æ‹¬å®šæ—¶å™¨é€šé“ï¼‰çš„ä½ç½®")]),t._v(" "),a("li",[t._v("Mutex Profilingï¼šäº’æ–¥é”åˆ†æï¼ŒæŠ¥å‘Šäº’æ–¥é”çš„ç«äº‰æƒ…å†µ")])]),t._v(" "),a("h2",{attrs:{id:"ä¸€ä¸ªç®€å•çš„ä¾‹å­"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ä¸ªç®€å•çš„ä¾‹å­"}},[t._v("#")]),t._v(" ä¸€ä¸ªç®€å•çš„ä¾‹å­")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªç®€å•ä¸”æœ‰ç‚¹é—®é¢˜çš„ä¾‹å­ï¼Œç”¨äºåŸºæœ¬çš„ç¨‹åºåˆæ­¥åˆ†æ")]),t._v(" "),a("h3",{attrs:{id:"ç¼–å†™-demo-æ–‡ä»¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¼–å†™-demo-æ–‡ä»¶"}},[t._v("#")]),t._v(" ç¼–å†™ demo æ–‡ä»¶")]),t._v(" "),a("p",[t._v("ï¼ˆ1ï¼‰demo.goï¼Œæ–‡ä»¶å†…å®¹ï¼š")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net/http"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net/http/pprof"')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/EDDYCJY/go-pprof-example/data"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tlog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://github.com/EDDYCJY"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\thttp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListenAndServe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0:6060"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("ï¼ˆ2ï¼‰data/d.goï¼Œæ–‡ä»¶å†…å®¹ï¼š")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" data\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" datas "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tdata "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tsData "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tdatas "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("datas"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sData\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œä½ çš„ HTTP æœåŠ¡ä¼šå¤šå‡º /debug/pprof çš„ endpoint å¯ç”¨äºè§‚å¯Ÿåº”ç”¨ç¨‹åºçš„æƒ…å†µ")]),t._v(" "),a("h3",{attrs:{id:"åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†æ"}},[t._v("#")]),t._v(" åˆ†æ")]),t._v(" "),a("h4",{attrs:{id:"ä¸€ã€é€šè¿‡-web-ç•Œé¢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ã€é€šè¿‡-web-ç•Œé¢"}},[t._v("#")]),t._v(" ä¸€ã€é€šè¿‡ Web ç•Œé¢")]),t._v(" "),a("p",[t._v("æŸ¥çœ‹å½“å‰æ€»è§ˆï¼šè®¿é—® "),a("code",[t._v("http://127.0.0.1:6060/debug/pprof/")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/debug/pprof/\n\nprofiles:\n0\tblock\n5\tgoroutine\n3\theap\n0\tmutex\n9\tthreadcreate\n\nfull goroutine stack dump\n")])])]),a("p",[t._v("è¿™ä¸ªé¡µé¢ä¸­æœ‰è®¸å¤šå­é¡µé¢ï¼Œå’±ä»¬ç»§ç»­æ·±ç©¶ä¸‹å»ï¼Œçœ‹çœ‹å¯ä»¥å¾—åˆ°ä»€ä¹ˆï¼Ÿ")]),t._v(" "),a("ul",[a("li",[t._v("cpuï¼ˆCPU Profilingï¼‰: "),a("code",[t._v("$HOST/debug/pprof/profile")]),t._v("ï¼Œé»˜è®¤è¿›è¡Œ 30s çš„ CPU Profilingï¼Œå¾—åˆ°ä¸€ä¸ªåˆ†æç”¨çš„ profile æ–‡ä»¶")]),t._v(" "),a("li",[t._v("blockï¼ˆBlock Profilingï¼‰ï¼š"),a("code",[t._v("$HOST/debug/pprof/block")]),t._v("ï¼ŒæŸ¥çœ‹å¯¼è‡´é˜»å¡åŒæ­¥çš„å †æ ˆè·Ÿè¸ª")]),t._v(" "),a("li",[t._v("goroutineï¼š"),a("code",[t._v("$HOST/debug/pprof/goroutine")]),t._v("ï¼ŒæŸ¥çœ‹å½“å‰æ‰€æœ‰è¿è¡Œçš„ goroutines å †æ ˆè·Ÿè¸ª")]),t._v(" "),a("li",[t._v("heapï¼ˆMemory Profilingï¼‰: "),a("code",[t._v("$HOST/debug/pprof/heap")]),t._v("ï¼ŒæŸ¥çœ‹æ´»åŠ¨å¯¹è±¡çš„å†…å­˜åˆ†é…æƒ…å†µ")]),t._v(" "),a("li",[t._v("mutexï¼ˆMutex Profilingï¼‰ï¼š"),a("code",[t._v("$HOST/debug/pprof/mutex")]),t._v("ï¼ŒæŸ¥çœ‹å¯¼è‡´äº’æ–¥é”çš„ç«äº‰æŒæœ‰è€…çš„å †æ ˆè·Ÿè¸ª")]),t._v(" "),a("li",[t._v("threadcreateï¼š"),a("code",[t._v("$HOST/debug/pprof/threadcreate")]),t._v("ï¼ŒæŸ¥çœ‹åˆ›å»ºæ–°OSçº¿ç¨‹çš„å †æ ˆè·Ÿè¸ª")])]),t._v(" "),a("h4",{attrs:{id:"äºŒã€é€šè¿‡äº¤äº’å¼ç»ˆç«¯ä½¿ç”¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äºŒã€é€šè¿‡äº¤äº’å¼ç»ˆç«¯ä½¿ç”¨"}},[t._v("#")]),t._v(" äºŒã€é€šè¿‡äº¤äº’å¼ç»ˆç«¯ä½¿ç”¨")]),t._v(" "),a("p",[t._v("ï¼ˆ1ï¼‰go tool pprof http://localhost:6060/debug/pprof/profile?seconds=60")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ go tool pprof http://localhost:6060/debug/pprof/profile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("?seconds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v("\n\nFetching profile over HTTP from http://localhost:6060/debug/pprof/profile?seconds"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v("\nSaved profile "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" /Users/eddycjy/pprof/pprof.samples.cpu.007.pb.gz\nType: cpu\nDuration: 1mins, Total samples "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v(".55s "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("44.15")]),t._v("%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nEntering interactive mode "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"help"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" commands, "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"o"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n")])])]),a("p",[t._v("æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œéœ€ç­‰å¾… 60 ç§’ï¼ˆå¯è°ƒæ•´ seconds çš„å€¼ï¼‰ï¼Œpprof ä¼šè¿›è¡Œ CPU Profilingã€‚ç»“æŸåå°†é»˜è®¤è¿›å…¥ pprof çš„äº¤äº’å¼å‘½ä»¤æ¨¡å¼ï¼Œå¯ä»¥å¯¹åˆ†æçš„ç»“æœè¿›è¡ŒæŸ¥çœ‹æˆ–å¯¼å‡ºã€‚å…·ä½“å¯æ‰§è¡Œ "),a("code",[t._v("pprof help")]),t._v(" æŸ¥çœ‹å‘½ä»¤è¯´æ˜")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" top10\nShowing nodes accounting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v(".92s, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("97.63")]),t._v("% of "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),t._v(".55s total\nDropped "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("85")]),t._v(" nodes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cum "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".13s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nShowing "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("top")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" nodes out of "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v("\n      flat  flat%   sum%        cum   cum%\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(".28s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("87.68")]),t._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("87.68")]),t._v("%     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(".29s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("87.72")]),t._v("%  syscall.Syscall\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".77s  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.90")]),t._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("90.58")]),t._v("%      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".77s  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.90")]),t._v("%  runtime.memmove\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".58s  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.18")]),t._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("92.77")]),t._v("%      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".58s  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.18")]),t._v("%  runtime.freedefer\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".53s  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.00")]),t._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("94.76")]),t._v("%      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".42s  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.35")]),t._v("%  runtime.scanobject\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".36s  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.36")]),t._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("96.12")]),t._v("%      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".39s  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.47")]),t._v("%  runtime.heapBitsForObject\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".35s  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.32")]),t._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("97.44")]),t._v("%      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".45s  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.69")]),t._v("%  runtime.greyobject\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".02s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.075")]),t._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("97.51")]),t._v("%     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(".96s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("94.01")]),t._v("%  main.main.func1\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".01s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.038")]),t._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("97.55")]),t._v("%     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(".91s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("90.06")]),t._v("%  os."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("*File"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".Write\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".01s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.038")]),t._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("97.59")]),t._v("%      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".19s  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.72")]),t._v("%  runtime.mallocgc\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".01s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.038")]),t._v("% "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("97.63")]),t._v("%     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(".30s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("87.76")]),t._v("%  syscall.Write\n")])])]),a("ul",[a("li",[t._v("flatï¼šç»™å®šå‡½æ•°ä¸Šè¿è¡Œè€—æ—¶")]),t._v(" "),a("li",[t._v("flat%ï¼šåŒä¸Šçš„ CPU è¿è¡Œè€—æ—¶æ€»æ¯”ä¾‹")]),t._v(" "),a("li",[t._v("sum%ï¼šç»™å®šå‡½æ•°ç´¯ç§¯ä½¿ç”¨ CPU æ€»æ¯”ä¾‹")]),t._v(" "),a("li",[t._v("cumï¼šå½“å‰å‡½æ•°åŠ ä¸Šå®ƒä¹‹ä¸Šçš„è°ƒç”¨è¿è¡Œæ€»è€—æ—¶")]),t._v(" "),a("li",[t._v("cum%ï¼šåŒä¸Šçš„ CPU è¿è¡Œè€—æ—¶æ€»æ¯”ä¾‹")])]),t._v(" "),a("p",[t._v("æœ€åä¸€åˆ—ä¸ºå‡½æ•°åç§°ï¼Œåœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº”åˆ—å¾—å‡ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è¿è¡Œæƒ…å†µï¼ŒåŠ ä»¥ä¼˜åŒ– ğŸ¤”")]),t._v(" "),a("p",[t._v("ï¼ˆ2ï¼‰go tool pprof http://localhost:6060/debug/pprof/heap")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ go tool pprof http://localhost:6060/debug/pprof/heap\nFetching profile over HTTP from http://localhost:6060/debug/pprof/heap\nSaved profile "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" /Users/eddycjy/pprof/pprof.alloc_objects.alloc_space.inuse_objects.inuse_space.008.pb.gz\nType: inuse_space\nEntering interactive mode "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"help"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" commands, "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"o"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pprof"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("top")]),t._v("\nShowing nodes accounting "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("837")]),t._v(".48MB, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% of "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("837")]),t._v(".48MB total\n      flat  flat%   sum%        cum   cum%\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("837")]),t._v(".48MB   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("837")]),t._v(".48MB   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("%  main.main.func1\n")])])]),a("ul",[a("li",[a("p",[t._v("-inuse_spaceï¼šåˆ†æåº”ç”¨ç¨‹åºçš„å¸¸é©»å†…å­˜å ç”¨æƒ…å†µ")])]),t._v(" "),a("li",[a("p",[t._v("-alloc_objectsï¼šåˆ†æåº”ç”¨ç¨‹åºçš„å†…å­˜ä¸´æ—¶åˆ†é…æƒ…å†µ")])])]),t._v(" "),a("p",[t._v("ï¼ˆ3ï¼‰ go tool pprof http://localhost:6060/debug/pprof/block")]),t._v(" "),a("p",[t._v("ï¼ˆ4ï¼‰ go tool pprof http://localhost:6060/debug/pprof/mutex")]),t._v(" "),a("h4",{attrs:{id:"ä¸‰ã€pprof-å¯è§†åŒ–ç•Œé¢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ã€pprof-å¯è§†åŒ–ç•Œé¢"}},[t._v("#")]),t._v(" ä¸‰ã€PProf å¯è§†åŒ–ç•Œé¢")]),t._v(" "),a("p",[t._v("è¿™æ˜¯ä»¤äººæœŸå¾…çš„ä¸€å°èŠ‚ã€‚åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç®€å•çš„ç¼–å†™å¥½æµ‹è¯•ç”¨ä¾‹æ¥è·‘ä¸€ä¸‹")]),t._v(" "),a("h5",{attrs:{id:"ç¼–å†™æµ‹è¯•ç”¨ä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¼–å†™æµ‹è¯•ç”¨ä¾‹"}},[t._v("#")]),t._v(" ç¼–å†™æµ‹è¯•ç”¨ä¾‹")]),t._v(" "),a("p",[t._v("ï¼ˆ1ï¼‰æ–°å»º data/d_test.goï¼Œæ–‡ä»¶å†…å®¹ï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('package data\n\nimport "testing"\n\nconst url = "https://github.com/EDDYCJY"\n\nfunc TestAdd(t *testing.T) {\n\ts := Add(url)\n\tif s == "" {\n\t\tt.Errorf("Test.Add error!")\n\t}\n}\n\nfunc BenchmarkAdd(b *testing.B) {\n\tfor i := 0; i < b.N; i++ {\n\t\tAdd(url)\n\t}\n}\n')])])]),a("p",[t._v("ï¼ˆ2ï¼‰æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ go test -bench=. -cpuprofile=cpu.prof\npkg: github.com/EDDYCJY/go-pprof-example/data\nBenchmarkAdd-4   \t10000000\t       187 ns/op\nPASS\nok  \tgithub.com/EDDYCJY/go-pprof-example/data\t2.300s\n")])])]),a("p",[t._v("-memprofile ä¹Ÿå¯ä»¥äº†è§£ä¸€ä¸‹")]),t._v(" "),a("h5",{attrs:{id:"å¯åŠ¨-pprof-å¯è§†åŒ–ç•Œé¢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¯åŠ¨-pprof-å¯è§†åŒ–ç•Œé¢"}},[t._v("#")]),t._v(" å¯åŠ¨ PProf å¯è§†åŒ–ç•Œé¢")]),t._v(" "),a("h6",{attrs:{id:"æ–¹æ³•ä¸€ï¼š"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ–¹æ³•ä¸€ï¼š"}},[t._v("#")]),t._v(" æ–¹æ³•ä¸€ï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ go tool pprof -http=:8080 cpu.prof\n")])])]),a("h6",{attrs:{id:"æ–¹æ³•äºŒï¼š"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ–¹æ³•äºŒï¼š"}},[t._v("#")]),t._v(" æ–¹æ³•äºŒï¼š")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ go tool pprof cpu.prof \n$ (pprof) web\n")])])]),a("p",[t._v("å¦‚æœå‡ºç° "),a("code",[t._v("Could not execute dot; may need to install graphviz.")]),t._v("ï¼Œå°±æ˜¯æç¤ºä½ è¦å®‰è£… "),a("code",[t._v("graphviz")]),t._v(" äº† ï¼ˆè¯·å³æ‹è°·æ­Œï¼‰")]),t._v(" "),a("h5",{attrs:{id:"æŸ¥çœ‹-pprof-å¯è§†åŒ–ç•Œé¢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥çœ‹-pprof-å¯è§†åŒ–ç•Œé¢"}},[t._v("#")]),t._v(" æŸ¥çœ‹ PProf å¯è§†åŒ–ç•Œé¢")]),t._v(" "),a("p",[t._v("ï¼ˆ1ï¼‰Top")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/RxJO0zH.jpg",alt:"image"}})]),t._v(" "),a("p",[t._v("ï¼ˆ2ï¼‰Graph")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/Bowv9PX.jpg",alt:"image"}})]),t._v(" "),a("p",[t._v("æ¡†è¶Šå¤§ï¼Œçº¿è¶Šç²—ä»£è¡¨å®ƒå ç”¨çš„æ—¶é—´è¶Šå¤§å“¦")]),t._v(" "),a("p",[t._v("ï¼ˆ3ï¼‰Peek")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/V67zTDQ.jpg",alt:"image"}})]),t._v(" "),a("p",[t._v("ï¼ˆ4ï¼‰Source")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/3K81wyn.jpg",alt:"image"}})]),t._v(" "),a("p",[t._v("é€šè¿‡ PProf çš„å¯è§†åŒ–ç•Œé¢ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´æ–¹ä¾¿ã€æ›´ç›´è§‚çš„çœ‹åˆ° Go åº”ç”¨ç¨‹åºçš„è°ƒç”¨é“¾ã€ä½¿ç”¨æƒ…å†µç­‰ï¼Œå¹¶ä¸”åœ¨ View èœå•æ ä¸­ï¼Œè¿˜æ”¯æŒå¦‚ä¸Šå¤šç§æ–¹å¼çš„åˆ‡æ¢")]),t._v(" "),a("p",[t._v("ä½ æƒ³æƒ³ï¼Œåœ¨çƒ¦æ¼ä¸çŸ¥é“ä»€ä¹ˆé—®é¢˜çš„æ—¶å€™ï¼Œèƒ½ç”¨è¿™äº›è¾…åŠ©å·¥å…·æ¥æ£€æµ‹é—®é¢˜ï¼Œæ˜¯ä¸æ˜¯ç¬é—´æ•ˆç‡ç¿»å€äº†å‘¢ ğŸ‘Œ")]),t._v(" "),a("h4",{attrs:{id:"å››ã€pprof-ç«ç„°å›¾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å››ã€pprof-ç«ç„°å›¾"}},[t._v("#")]),t._v(" å››ã€PProf ç«ç„°å›¾")]),t._v(" "),a("p",[t._v("å¦ä¸€ç§å¯è§†åŒ–æ•°æ®çš„æ–¹æ³•æ˜¯ç«ç„°å›¾ï¼Œéœ€æ‰‹åŠ¨å®‰è£…åŸç”Ÿ PProf å·¥å…·ï¼š")]),t._v(" "),a("p",[t._v("ï¼ˆ1ï¼‰ å®‰è£… PProf")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ go get -u github.com/google/pprof\n")])])]),a("p",[t._v("ï¼ˆ2ï¼‰ å¯åŠ¨ PProf å¯è§†åŒ–ç•Œé¢:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ pprof -http=:8080 cpu.prof\n")])])]),a("p",[t._v("ï¼ˆ3ï¼‰ æŸ¥çœ‹ PProf å¯è§†åŒ–ç•Œé¢")]),t._v(" "),a("p",[t._v("æ‰“å¼€ PProf çš„å¯è§†åŒ–ç•Œé¢æ—¶ï¼Œä½ ä¼šæ˜æ˜¾å‘ç°æ¯”å®˜æ–¹å·¥å…·é“¾çš„ PProf ç²¾è‡´ä¸€äº›ï¼Œå¹¶ä¸”å¤šäº† Flame Graphï¼ˆç«ç„°å›¾ï¼‰")]),t._v(" "),a("p",[t._v("å®ƒå°±æ˜¯æœ¬æ¬¡çš„ç›®æ ‡ä¹‹ä¸€ï¼Œå®ƒçš„æœ€å¤§ä¼˜ç‚¹æ˜¯åŠ¨æ€çš„ã€‚è°ƒç”¨é¡ºåºç”±ä¸Šåˆ°ä¸‹ï¼ˆA -> B -> C -> Dï¼‰ï¼Œæ¯ä¸€å—ä»£è¡¨ä¸€ä¸ªå‡½æ•°ï¼Œè¶Šå¤§ä»£è¡¨å ç”¨ CPU çš„æ—¶é—´æ›´é•¿ã€‚åŒæ—¶å®ƒä¹Ÿæ”¯æŒç‚¹å‡»å—æ·±å…¥è¿›è¡Œåˆ†æï¼")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/g58bQpg.jpg",alt:"image"}})]),t._v(" "),a("h2",{attrs:{id:"æ€»ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[t._v("#")]),t._v(" æ€»ç»“")]),t._v(" "),a("p",[t._v("åœ¨æœ¬ç« èŠ‚ï¼Œç²—ç•¥åœ°ä»‹ç»äº† Go çš„æ€§èƒ½åˆ©å™¨ PProfã€‚åœ¨ç‰¹å®šçš„åœºæ™¯ä¸­ï¼ŒPProf ç»™å®šä½ã€å‰–æé—®é¢˜å¸¦äº†æå¤§çš„å¸®åŠ©")]),t._v(" "),a("p",[t._v("å¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œå¦å¤–å»ºè®®èƒ½å¤Ÿè‡ªå·±å®é™…æ“ä½œä¸€éï¼Œæœ€å¥½æ˜¯å¯ä»¥æ·±å…¥ç¢ç£¨ä¸€ä¸‹ï¼Œå†…å«å¤§é‡çš„ç”¨æ³•ã€çŸ¥è¯†ç‚¹ ğŸ¤“")]),t._v(" "),a("h2",{attrs:{id:"æ€è€ƒé¢˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ€è€ƒé¢˜"}},[t._v("#")]),t._v(" æ€è€ƒé¢˜")]),t._v(" "),a("p",[t._v("ä½ å¾ˆä¼˜ç§€çš„çœ‹åˆ°äº†æœ€åï¼Œé‚£ä¹ˆæœ‰ä¸¤é“ç®€å•çš„æ€è€ƒé¢˜ï¼Œå¸Œæœ›æ‹“å±•ä½ çš„æ€è·¯")]),t._v(" "),a("p",[t._v("ï¼ˆ1ï¼‰flat ä¸€å®šå¤§äº cum å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ cum ä¼šæ¯” flat å¤§ï¼Ÿ")]),t._v(" "),a("p",[t._v("ï¼ˆ2ï¼‰æœ¬ç« èŠ‚çš„ demo ä»£ç ï¼Œæœ‰ä»€ä¹ˆæ€§èƒ½é—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³å®ƒï¼Ÿ")])])}),[],!1,null,null,null);s.default=n.exports}}]);