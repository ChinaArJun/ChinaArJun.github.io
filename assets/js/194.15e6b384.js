(window.webpackJsonp=window.webpackJsonp||[]).push([[194],{771:function(e,n,t){"use strict";t.r(n);var a=t(44),c=Object(a.a)({},(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"dockerfile体系结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile体系结构"}},[e._v("#")]),e._v(" Dockerfile体系结构")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#dockerfile%e4%bd%93%e7%b3%bb%e7%bb%93%e6%9e%84"}},[e._v("Dockerfile体系结构")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#%e4%bf%9d%e7%95%99%e5%ad%97%e6%8c%87%e4%bb%a4"}},[e._v("保留字指令")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#dockerfile%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6"}},[e._v("dockerfile运行机制")])]),e._v(" "),t("li",[t("a",{attrs:{href:"#%e4%be%8b%e5%ad%90"}},[e._v("例子")])])])])]),e._v(" "),t("h2",{attrs:{id:"保留字指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#保留字指令"}},[e._v("#")]),e._v(" 保留字指令")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('FROM：基础镜像，当前新镜像是基于哪个镜像的\n\nMAINTANER：镜像维护者的姓名和邮箱地址\n\nRUN：容器构建需要运行的命令\n\nEXPOSE：当前容器对外暴露的端口\n\nEXPOSE 指令是声明运行时容器提供服务端口，这只是一个声明，在运行时并不会因为这个声明应用就会开启这个端口的服务。\n\n在 Dockerfile 中写入这样的声明有两个好处，一个是帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射；\n\n另一个用处则是在运行时使用随机端口映射时，也就是 docker run -P 时，会自动随机映射 EXPOSE 的端口。\n\n要将 EXPOSE 和在运行时使用 -p <宿主端口>:<容器端口> 区分开来。\n\n-p，是映射宿主端口和容器端口，换句话说，就是将容器的对应端口服务公开给外界访问，\n而 EXPOSE 仅仅是声明容器打算使用什么端口而已，并不会自动在宿主进行端口映射。\n\n\nWORKDIR：指定在创建容器后，终端默认登录的进来工作目录，一个落脚点\n\nENV：用来构建镜像过程中设置环境变量\n\nADD：将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包\n\nCOPY：类似ADD，拷贝文件和目录到镜像中，将从构建上下文目录中<源路径>的文件/目录复制到新的一层镜像内的<目标路径>位置\nCOPY src dest\nCOPY ["src", "dest"]\n\nVOLUME：容器数据卷，用于数据保存和持久化工作\n\nCMD：指定一个容器启动时要运行的命令，\nDockerfile中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换\n\nCMD ["curl", "-s", "http://ip.cn"]\nCMD -i \n\nENTRYPOINT：指定一个容器启动时要运行的命令，和CMD一样都是在指定容器启动程序以及参数 \n指定会追加 不会被覆盖\n\nENTRYPOINT  ["curl", "-s", "http://ip.cn"]\n\n\nONBUILD： 当构建一个被继承的Dockerfile时运行命令，父镜像在被子继承后父镜像的onbuild被触发\n')])])]),t("h2",{attrs:{id:"dockerfile运行机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile运行机制"}},[e._v("#")]),e._v(" dockerfile运行机制")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/Syncma/Figurebed/master/img/dockerfile2.png",alt:""}})]),e._v(" "),t("h2",{attrs:{id:"例子"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[e._v("#")]),e._v(" 例子")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("base镜像(scratch)： Docker Hub中99%的镜像都是通过在base镜像中安装和配置需要的软件构建起来的\n\n自定义镜像(mycentos)\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[root@laptop mydocker]# cat dockerfile\n\nFROM centos\nMAINTAINER majian<majian@qq.com>\nENV mypath /tmp\nWORKDIR $mypath\nRUN yum -y install vim\nRUN yum -y install net-tools\nEXPOSE 80\nCMD /bin/bash\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[root@laptop mydocker]# docker build -f dockerfile -t mycentos:1.3 .\n\nSending build context to Docker daemon 2.048kB\nStep 1/8 : FROM centos\n---\x3e 0f3e07c0138f\nStep 2/8 : MAINTAINER majian<majian@qq.com>\n---\x3e Running in 6d4684ead2fa\nRemoving intermediate container 6d4684ead2fa\n---\x3e e899711fd7b2\nStep 3/8 : ENV mypath /tmp\n---\x3e Running in 25e2618ca1c0\nRemoving intermediate container 25e2618ca1c0\n---\x3e 498e81a2ddc6\nStep 4/8 : WORKDIR $mypath\n---\x3e Running in 51c12df8bf5d\nRemoving intermediate container 51c12df8bf5d\n---\x3e 051be51956d5\nStep 5/8 : RUN yum -y install vim\n---\x3e Running in 40f00feca24d\n\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[root@laptop mydocker]# docker images\n\nREPOSITORY TAG IMAGE ID CREATED SIZE\nmycentos 1.3 b9d313b868fc 32 seconds ago 316MB\ncentos latest 0f3e07c0138f 6 weeks ago 220MB\n\n\n[root@laptop mydocker]# docker images mycentos\n\nREPOSITORY TAG IMAGE ID CREATED SIZE\nmycentos 1.3 b9d313b868fc About a minute ago 316MB\n\n\n[root@laptop mydocker]# docker run -it mycentos:1.3\n\n[root@9eb191b85d6e tmp]# pwd\n/tmp\n[root@9eb191b85d6e tmp]# which vim\n/usr/bin/vim\n[root@9eb191b85d6e tmp]# which ifconfig\n/usr/sbin/ifconfig\n\n")])])]),t("p",[e._v("列出镜像的变更历史：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('[root@laptop mydocker]# docker images\n\nREPOSITORY TAG IMAGE ID CREATED SIZE\nmycentos 1.3 b9d313b868fc 3 minutes ago 316MB\nabc/centos latest 0760a8000e5d 5 hours ago 220MB\nabc/mytomcat 1.2 f73b412690d6 6 hours ago 507MB\ntomcat latest 882487b8be1d 3 weeks ago 507MB\ncentos latest 0f3e07c0138f 6 weeks ago 220MB\n\n[root@laptop mydocker]# docker history b9d313b868fc\n\nIMAGE CREATED CREATED BY SIZE COMMENT\nb9d313b868fc 3 minutes ago /bin/sh -c #(nop) CMD ["/bin/sh" "-c" "/bin… 0B\n2c49c2457ddc 3 minutes ago /bin/sh -c #(nop) EXPOSE 80 0B\n4c1421515876 3 minutes ago /bin/sh -c yum -y install net-tools 29.3MB\n1e5944f9ebf8 3 minutes ago /bin/sh -c yum -y install vim 66.9MB\n051be51956d5 4 minutes ago /bin/sh -c #(nop) WORKDIR /tmp 0B\n498e81a2ddc6 4 minutes ago /bin/sh -c #(nop) ENV mypath=/tmp 0B\ne899711fd7b2 4 minutes ago /bin/sh -c #(nop) MAINTAINER majian<majian@… 0B\n0f3e07c0138f 6 weeks ago /bin/sh -c #(nop) CMD ["/bin/bash"] 0B\n<missing> 6 weeks ago /bin/sh -c #(nop) LABEL org.label-schema.sc… 0B\n<missing> 6 weeks ago /bin/sh -c #(nop) ADD file:d6fdacc1972df524a… 220MB\n')])])]),t("p",[e._v("再看一个例子:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('[root@laptop mydocker]# cat dockerfile\n\nFROM centos\n\nONBUILD RUN echo "father image onbuild"\n\n[root@laptop mydocker]# docker build -f dockerfile -t myip_father .\n\nSending build context to Docker daemon 2.048kB\nStep 1/2 : FROM centos\n---\x3e 0f3e07c0138f\nStep 2/2 : ONBUILD RUN echo "father image onbuild"\n---\x3e Running in 9f077f1c3c30\nRemoving intermediate container 9f077f1c3c30\n---\x3e 145433c7a943\nSuccessfully built 145433c7a943\nSuccessfully tagged myip_father:latest\n\n')])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[root@laptop mydocker]# cat dockerfile2\n\nFROM myip_father\n\n[root@laptop mydocker]# docker build -f dockerfile2 -t myip:son .\nSending build context to Docker daemon 3.072kB\nStep 1/1 : FROM myip_father\n# Executing 1 build trigger\n---\x3e Running in d636ed5d3e0c\nfather image onbuild\nRemoving intermediate container d636ed5d3e0c\n---\x3e ec2d399db156\nSuccessfully built ec2d399db156\nSuccessfully tagged myip:son\n")])])])])}),[],!1,null,null,null);n.default=c.exports}}]);