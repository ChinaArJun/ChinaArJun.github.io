(window.webpackJsonp=window.webpackJsonp||[]).push([[283],{861:function(t,r,e){"use strict";e.r(r);var n=e(44),a=Object(n.a)({},(function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"_1-3-ç”¨-go-æ¥äº†è§£ä¸€ä¸‹-redis-é€šè®¯åè®®"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-ç”¨-go-æ¥äº†è§£ä¸€ä¸‹-redis-é€šè®¯åè®®"}},[t._v("#")]),t._v(" 1.3 ç”¨ Go æ¥äº†è§£ä¸€ä¸‹ Redis é€šè®¯åè®®")]),t._v(" "),e("p",[t._v("Goã€PHPã€Java... éƒ½æœ‰é‚£ä¹ˆå¤šåŒ…æ¥æ”¯æ’‘ä½ ä½¿ç”¨ Redisï¼Œé‚£ä½ æ˜¯å¦æœ‰æƒ³è¿‡")]),t._v(" "),e("p",[t._v("æœ‰äº†æœåŠ¡ç«¯ï¼Œæœ‰äº†å®¢æˆ·ç«¯ï¼Œä»–ä»¬ä¿©æ˜¯æ€æ ·é€šè®¯ï¼Œåˆæ˜¯åŸºäºä»€ä¹ˆé€šè®¯åè®®åšå‡ºäº¤äº’çš„å‘¢ï¼Ÿ")]),t._v(" "),e("h2",{attrs:{id:"ä»‹ç»"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ä»‹ç»"}},[t._v("#")]),t._v(" ä»‹ç»")]),t._v(" "),e("p",[t._v("åŸºäºæˆ‘ä»¬çš„ç›®çš„ï¼Œæœ¬æ–‡ä¸»è¦è®²è§£å’Œå®è·µ Redis çš„é€šè®¯åè®®")]),t._v(" "),e("p",[t._v("Redis çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯é€šè¿‡ TCP è¿æ¥æ¥è¿›è¡Œæ•°æ®äº¤äº’ï¼Œ æœåŠ¡å™¨é»˜è®¤çš„ç«¯å£å·ä¸º 6379")]),t._v(" "),e("p",[t._v("å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‘é€çš„å‘½ä»¤æˆ–æ•°æ®ä¸€å¾‹ä»¥ \\r\\n ï¼ˆCRLFï¼‰ç»“å°¾ï¼ˆè¿™æ˜¯ä¸€æ¡çº¦å®šï¼‰")]),t._v(" "),e("h2",{attrs:{id:"åè®®"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#åè®®"}},[t._v("#")]),t._v(" åè®®")]),t._v(" "),e("p",[t._v("åœ¨ Redis ä¸­åˆ†ä¸º"),e("strong",[t._v("è¯·æ±‚")]),t._v("å’Œ"),e("strong",[t._v("å›å¤")]),t._v("ï¼Œè€Œè¯·æ±‚åè®®åˆåˆ†ä¸ºæ–°ç‰ˆå’Œæ—§ç‰ˆï¼Œæ–°ç‰ˆç»Ÿä¸€è¯·æ±‚åè®®åœ¨ Redis 1.2 ç‰ˆæœ¬ä¸­å¼•å…¥ï¼Œæœ€ç»ˆåœ¨ Redis 2.0 ç‰ˆæœ¬æˆä¸º Redis æœåŠ¡å™¨é€šä¿¡çš„æ ‡å‡†æ–¹å¼")]),t._v(" "),e("p",[t._v("æœ¬æ–‡æ˜¯åŸºäºæ–°ç‰ˆåè®®æ¥å®ç°åŠŸèƒ½ï¼Œä¸å»ºè®®ä½¿ç”¨æ—§ç‰ˆï¼ˆ1.2 æŒºè€æ—§äº†ï¼‰ã€‚å¦‚ä¸‹æ˜¯æ–°åè®®çš„å„ç§èŒƒä¾‹ï¼š")]),t._v(" "),e("h3",{attrs:{id:"è¯·æ±‚åè®®"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#è¯·æ±‚åè®®"}},[t._v("#")]),t._v(" è¯·æ±‚åè®®")]),t._v(" "),e("p",[t._v("1ã€ æ ¼å¼ç¤ºä¾‹")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("*<å‚æ•°æ•°é‡> CR LF\n$<å‚æ•° 1 çš„å­—èŠ‚æ•°é‡> CR LF\n<å‚æ•° 1 çš„æ•°æ®> CR LF\n...\n$<å‚æ•° N çš„å­—èŠ‚æ•°é‡> CR LF\n<å‚æ•° N çš„æ•°æ®> CR LF\n")])])]),e("p",[t._v("åœ¨è¯¥åè®®ä¸‹æ‰€æœ‰å‘é€è‡³ Redis æœåŠ¡å™¨çš„å‚æ•°éƒ½æ˜¯äºŒè¿›åˆ¶å®‰å…¨ï¼ˆbinary safeï¼‰çš„")]),t._v(" "),e("p",[t._v("2ã€æ‰“å°ç¤ºä¾‹")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("*3\n$3\nSET\n$5\nmykey\n$7\nmyvalue\n")])])]),e("p",[t._v("3ã€å®é™…åè®®å€¼")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('"*3\\r\\n$3\\r\\nSET\\r\\n$5\\r\\nmykey\\r\\n$7\\r\\nmyvalue\\r\\n"\n')])])]),e("p",[t._v("è¿™å°±æ˜¯ Redis çš„è¯·æ±‚åè®®è§„èŒƒï¼ŒæŒ‰ç…§èŒƒä¾‹1ç¼–å†™å®¢æˆ·ç«¯é€»è¾‘ï¼Œæœ€ç»ˆå‘é€çš„æ˜¯èŒƒä¾‹3ï¼Œç›¸ä¿¡ä½ å·²ç»æœ‰å¤§è‡´çš„æ¦‚å¿µäº†ï¼ŒRedis çš„åè®®éå¸¸çš„ç®€æ´æ˜“æ‡‚ï¼Œè¿™ä¹Ÿæ˜¯å¥½ä¸Šæ‰‹çš„åŸå› ä¹‹ä¸€ï¼Œä½ å¯ä»¥æƒ³æƒ³åè®®è¿™ä¹ˆå®šä¹‰çš„å¥½å¤„åœ¨å“ªï¼Ÿ")]),t._v(" "),e("h3",{attrs:{id:"å›å¤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å›å¤"}},[t._v("#")]),t._v(" å›å¤")]),t._v(" "),e("p",[t._v("Redis ä¼šæ ¹æ®ä½ è¯·æ±‚åè®®çš„ä¸åŒï¼ˆæ‰§è¡Œçš„å‘½ä»¤ç»“æœä¹Ÿä¸åŒï¼‰ï¼Œè¿”å›å¤šç§ä¸åŒç±»å‹çš„å›å¤ã€‚åœ¨è¿™ä¸ªå›å¤â€œåè®®â€ä¸­ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œç¡®å®šè¿™ä¸ªå›å¤æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå¦‚ä¸‹ï¼š")]),t._v(" "),e("ul",[e("li",[t._v('çŠ¶æ€å›å¤ï¼ˆstatus replyï¼‰çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ "+"')]),t._v(" "),e("li",[t._v('é”™è¯¯å›å¤ï¼ˆerror replyï¼‰çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ "-"')]),t._v(" "),e("li",[t._v('æ•´æ•°å›å¤ï¼ˆinteger replyï¼‰çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ ":"')]),t._v(" "),e("li",[t._v('æ‰¹é‡å›å¤ï¼ˆbulk replyï¼‰çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ "$"')]),t._v(" "),e("li",[t._v('å¤šæ¡æ‰¹é‡å›å¤ï¼ˆmulti bulk replyï¼‰çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ "*"')])]),t._v(" "),e("p",[t._v("æœ‰äº†å›å¤çš„å¤´éƒ¨æ ‡è¯†ï¼Œç»“å°¾çš„ CRLFï¼Œä½ å¯ä»¥å¤§è‡´çŒœæƒ³å‡ºå›å¤â€œåè®®â€æ˜¯æ€ä¹ˆæ ·çš„ï¼Œä½†æ˜¯å®è·µæ‰èƒ½å¾—å‡ºçœŸç†ï¼Œæ–çŸ¥é“æ€•æ˜¯ä½ å¾ˆå¿«å°±å¿˜è®°äº† ğŸ˜€")]),t._v(" "),e("h2",{attrs:{id:"å®è·µ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å®è·µ"}},[t._v("#")]),t._v(" å®è·µ")]),t._v(" "),e("h3",{attrs:{id:"ä¸-redis-æœåŠ¡å™¨äº¤äº’"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ä¸-redis-æœåŠ¡å™¨äº¤äº’"}},[t._v("#")]),t._v(" ä¸ Redis æœåŠ¡å™¨äº¤äº’")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('package main\n\nimport (\n\t"log"\n\t"net"\n\t"os"\n\n\t"github.com/EDDYCJY/redis-protocol-example/protocol"\n)\n\nconst (\n\tAddress = "127.0.0.1:6379"\n\tNetwork = "tcp"\n)\n\nfunc Conn(network, address string) (net.Conn, error) {\n\tconn, err := net.Dial(network, address)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\treturn conn, nil\n}\n\nfunc main() {\n        // è¯»å–å…¥å‚\n\targs := os.Args[1:]\n\tif len(args) <= 0 {\n\t\tlog.Fatalf("Os.Args <= 0")\n\t}\n    \n        // è·å–è¯·æ±‚åè®®\n\treqCommand := protocol.GetRequest(args)\n\t\n\t// è¿æ¥ Redis æœåŠ¡å™¨\n\tredisConn, err := Conn(Network, Address)\n\tif err != nil {\n\t\tlog.Fatalf("Conn err: %v", err)\n\t}\n\tdefer redisConn.Close()\n    \n        // å†™å…¥è¯·æ±‚å†…å®¹\n\t_, err = redisConn.Write(reqCommand)\n\tif err != nil {\n\t\tlog.Fatalf("Conn Write err: %v", err)\n\t}\n    \n        // è¯»å–å›å¤\n\tcommand := make([]byte, 1024)\n\tn, err := redisConn.Read(command)\n\tif err != nil {\n\t\tlog.Fatalf("Conn Read err: %v", err)\n\t}\n    \n        // å¤„ç†å›å¤\n\treply, err := protocol.GetReply(command[:n])\n\tif err != nil {\n\t\tlog.Fatalf("protocol.GetReply err: %v", err)\n\t}\n    \n        // å¤„ç†åçš„å›å¤å†…å®¹\n\tlog.Printf("Reply: %v", reply)\n\t// åŸå§‹çš„å›å¤å†…å®¹\n\tlog.Printf("Command: %v", string(command[:n]))\n}\n')])])]),e("p",[t._v("åœ¨è¿™é‡Œæˆ‘ä»¬å®Œæˆäº†æ•´ä¸ª Redis å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº¤äº’çš„æµç¨‹ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š")]),t._v(" "),e("p",[t._v("1ã€è¯»å–å‘½ä»¤è¡Œå‚æ•°ï¼šè·å–æ‰§è¡Œçš„ Redis å‘½ä»¤")]),t._v(" "),e("p",[t._v("2ã€è·å–è¯·æ±‚åè®®å‚æ•°")]),t._v(" "),e("p",[t._v("3ã€è¿æ¥ Redis æœåŠ¡å™¨ï¼Œè·å–è¿æ¥å¥æŸ„")]),t._v(" "),e("p",[t._v("4ã€å°†è¯·æ±‚åè®®å‚æ•°å†™å…¥è¿æ¥ï¼šå‘é€è¯·æ±‚çš„å‘½ä»¤è¡Œå‚æ•°")]),t._v(" "),e("p",[t._v("5ã€ä»è¿æ¥ä¸­è¯»å–è¿”å›çš„æ•°æ®ï¼šè¯»å–å…ˆå‰è¯·æ±‚çš„å›å¤æ•°æ®")]),t._v(" "),e("p",[t._v("6ã€æ ¹æ®å›å¤â€œåè®®â€å†…å®¹ï¼Œå¤„ç†å›å¤çš„æ•°æ®é›†")]),t._v(" "),e("p",[t._v("7ã€è¾“å‡ºå¤„ç†åçš„å›å¤å†…å®¹åŠåŸå§‹å›å¤å†…å®¹")]),t._v(" "),e("h3",{attrs:{id:"è¯·æ±‚"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#è¯·æ±‚"}},[t._v("#")]),t._v(" è¯·æ±‚")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('func GetRequest(args []string) []byte {\n\treq := []string{\n\t\t"*" + strconv.Itoa(len(args)),\n\t}\n\n\tfor _, arg := range args {\n\t\treq = append(req, "$"+strconv.Itoa(len(arg)))\n\t\treq = append(req, arg)\n\t}\n\n\tstr := strings.Join(req, "\\r\\n")\n\treturn []byte(str + "\\r\\n")\n}\n')])])]),e("p",[t._v("é€šè¿‡å¯¹ Redis çš„è¯·æ±‚åè®®çš„åˆ†æï¼Œå¯å¾—å‡ºå®ƒçš„è§„å¾‹ï¼Œå…ˆåŠ ä¸Šæ ‡å¿—ä½ï¼Œè®¡ç®—å‚æ•°æ€»æ•°é‡ï¼Œå†å¾ªç¯åˆå¹¶å„ä¸ªå‚æ•°çš„å­—èŠ‚æ•°é‡ã€å€¼å°±å¯ä»¥äº†")]),t._v(" "),e("h3",{attrs:{id:"å›å¤-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å›å¤-2"}},[t._v("#")]),t._v(" å›å¤")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("func GetReply(reply []byte) (interface{}, error) {\n\treplyType := reply[0]\n\tswitch replyType {\n\tcase StatusReply:\n\t\treturn doStatusReply(reply[1:])\n\tcase ErrorReply:\n\t\treturn doErrorReply(reply[1:])\n\tcase IntegerReply:\n\t\treturn doIntegerReply(reply[1:])\n\tcase BulkReply:\n\t\treturn doBulkReply(reply[1:])\n\tcase MultiBulkReply:\n\t\treturn doMultiBulkReply(reply[1:])\n\tdefault:\n\t\treturn nil, nil\n\t}\n}\n\nfunc doStatusReply(reply []byte) (string, error) {\n\tif len(reply) == 3 && reply[1] == 'O' && reply[2] == 'K' {\n\t\treturn OkReply, nil\n\t}\n\n\tif len(reply) == 5 && reply[1] == 'P' && reply[2] == 'O' && reply[3] == 'N' && reply[4] == 'G' {\n\t\treturn PongReply, nil\n\t}\n\n\treturn string(reply), nil\n}\n\nfunc doErrorReply(reply []byte) (string, error) {\n\treturn string(reply), nil\n}\n\nfunc doIntegerReply(reply []byte) (int, error) {\n\tpos := getFlagPos('\\r', reply)\n\tresult, err := strconv.Atoi(string(reply[:pos]))\n\tif err != nil {\n\t\treturn 0, err\n\t}\n\n\treturn result, nil\n}\n\n...\n")])])]),e("p",[t._v("åœ¨è¿™é‡Œæˆ‘ä»¬å¯¹æ‰€æœ‰å›å¤ç±»å‹è¿›è¡Œäº†åˆ†å‘ï¼Œä¸åŒçš„å›å¤æ ‡å¿—ä½å¯¹åº”ä¸åŒçš„å¤„ç†æ–¹å¼ï¼Œåœ¨è¿™é‡Œéœ€æ±‚æ³¨æ„å‡ é¡¹é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š")]),t._v(" "),e("p",[t._v("1ã€å½“è¯·æ±‚çš„å€¼ä¸å­˜åœ¨ï¼Œä¼šå°†ç‰¹æ®Šå€¼ -1 ç”¨ä½œå›å¤")]),t._v(" "),e("p",[t._v("2ã€æœåŠ¡å™¨å‘é€çš„æ‰€æœ‰å­—ç¬¦ä¸²éƒ½ç”± CRLF ç»“å°¾")]),t._v(" "),e("p",[t._v("3ã€å¤šæ¡æ‰¹é‡å›å¤æ˜¯å¯åŸºäºæ‰¹é‡å›å¤çš„ï¼Œè¦æ³¨æ„ç†è§£")]),t._v(" "),e("p",[t._v("4ã€æ— å†…å®¹çš„å¤šæ¡æ‰¹é‡å›å¤æ˜¯å­˜åœ¨çš„")]),t._v(" "),e("p",[t._v("æœ€é‡è¦çš„æ˜¯ï¼Œå¯¹ä¸åŒå›å¤çš„è§„åˆ™çš„æŠŠæ§ï¼Œèƒ½å¤Ÿè®©ä½ æ›´å¥½çš„ç†è§£ Redis çš„è¯·æ±‚ã€å›å¤çš„äº¤äº’è¿‡ç¨‹ ğŸ‘Œ")]),t._v(" "),e("h2",{attrs:{id:"å°ç»“"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å°ç»“"}},[t._v("#")]),t._v(" å°ç»“")]),t._v(" "),e("p",[t._v("å†™è¿™ç¯‡æ–‡ç« çš„èµ·å› ï¼Œæ˜¯å› ä¸ºå¸¸å¸¸åœ¨ä½¿ç”¨ Redis æ—¶ï¼Œåªæ˜¯ç”¨ï¼Œä½ ä¸çŸ¥é“å®ƒæ˜¯åŸºäºä»€ä¹ˆæ ·çš„é€šè®¯åè®®æ¥é€šè®¯ï¼Œè¿™æ ·çš„æ„Ÿè§‰æ˜¯ååˆ†éš¾å—çš„")]),t._v(" "),e("p",[t._v("é€šè¿‡æœ¬æ–‡çš„è®²è§£ï¼Œæˆ‘ç›¸ä¿¡ä½ å·²ç»å¤§è‡´äº†è§£ Redis å®¢æˆ·ç«¯æ˜¯æ€ä¹ˆæ ·å’ŒæœåŠ¡ç«¯äº¤äº’ï¼Œä¹Ÿæ¸…æ¥šäº†å…¶æ‰€ç”¨çš„é€šè®¯åŸç†ï¼Œå¸Œæœ›èƒ½å¤Ÿå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼")]),t._v(" "),e("p",[t._v("æœ€åï¼Œå¦‚æœæƒ³è¯¦ç»†æŸ¥çœ‹ä»£ç ï¼Œå³æ‹é¡¹ç›®åœ°å€ï¼šhttps://github.com/EDDYCJY/redis-protocol-example")]),t._v(" "),e("p",[t._v("å¦‚æœå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹ä¸ª Star ğŸ‘")]),t._v(" "),e("h2",{attrs:{id:"å‚è€ƒ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒ"}},[t._v("#")]),t._v(" å‚è€ƒ")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"http://doc.redisfans.com/topic/protocol.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("é€šä¿¡åè®®"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);r.default=a.exports}}]);