(window.webpackJsonp=window.webpackJsonp||[]).push([[300],{877:function(t,e,r){"use strict";r.r(e);var a=r(44),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"åœ¨å›¾ç‰‡ä¸Šç»˜åˆ¶æ–‡å­—"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨å›¾ç‰‡ä¸Šç»˜åˆ¶æ–‡å­—"}},[t._v("#")]),t._v(" åœ¨å›¾ç‰‡ä¸Šç»˜åˆ¶æ–‡å­—")]),t._v(" "),r("p",[t._v("é¡¹ç›®åœ°å€ï¼šhttps://github.com/EDDYCJY/go-gin-example")]),t._v(" "),r("h2",{attrs:{id:"çŸ¥è¯†ç‚¹"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#çŸ¥è¯†ç‚¹"}},[t._v("#")]),t._v(" çŸ¥è¯†ç‚¹")]),t._v(" "),r("ul",[r("li",[t._v("å­—ä½“åº“ä½¿ç”¨")]),t._v(" "),r("li",[t._v("å›¾ç‰‡åˆæˆ")])]),t._v(" "),r("h2",{attrs:{id:"æœ¬æ–‡ç›®æ ‡"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æœ¬æ–‡ç›®æ ‡"}},[t._v("#")]),t._v(" æœ¬æ–‡ç›®æ ‡")]),t._v(" "),r("p",[t._v("ä¸»è¦å®ç°"),r("strong",[t._v("åˆå¹¶åçš„æµ·æŠ¥ä¸Šç»˜åˆ¶æ–‡å­—")]),t._v("çš„åŠŸèƒ½ï¼ˆè¿™ä¸ªéœ€æ±‚ä¹Ÿæ˜¯å¸¸è§çš„å¾ˆäº†ï¼‰ï¼Œå†…å®¹æ¯”è¾ƒç®€å•ã€‚")]),t._v(" "),r("h2",{attrs:{id:"å®ç°"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#å®ç°"}},[t._v("#")]),t._v(" å®ç°")]),t._v(" "),r("p",[t._v("è¿™é‡Œä½¿ç”¨çš„æ˜¯ "),r("a",{attrs:{href:"https://github.com/EDDYCJY/go-gin-example/blob/master/runtime/fonts/msyhbd.ttc",target:"_blank",rel:"noopener noreferrer"}},[t._v("å¾®è½¯é›…é»‘"),r("OutboundLink")],1),t._v(" çš„å­—ä½“ï¼Œè¯·ç‚¹å‡»è¿›è¡Œä¸‹è½½å¹¶"),r("strong",[t._v("å­˜æ”¾åˆ° runtime/fonts ç›®å½•")]),t._v("ä¸‹ï¼ˆå­—ä½“æ–‡ä»¶å  16 MB å¤§å°ï¼‰")]),t._v(" "),r("h3",{attrs:{id:"å®‰è£…"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#å®‰è£…"}},[t._v("#")]),t._v(" å®‰è£…")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("$ go get -u github.com/golang/freetype\n")])])]),r("h3",{attrs:{id:"ç»˜åˆ¶æ–‡å­—"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ç»˜åˆ¶æ–‡å­—"}},[t._v("#")]),t._v(" ç»˜åˆ¶æ–‡å­—")]),t._v(" "),r("p",[t._v("æ‰“å¼€ service/article_service/article_poster.go æ–‡ä»¶ï¼Œå¢åŠ ç»˜åˆ¶æ–‡å­—çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚ä¸‹ï¼š")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("type DrawText struct {\n\tJPG    draw.Image\n\tMerged *os.File\n\n\tTitle string\n\tX0    int\n\tY0    int\n\tSize0 float64\n\n\tSubTitle string\n\tX1       int\n\tY1       int\n\tSize1    float64\n}\n\nfunc (a *ArticlePosterBg) DrawPoster(d *DrawText, fontName string) error {\n\tfontSource := setting.AppSetting.RuntimeRootPath + setting.AppSetting.FontSavePath + fontName\n\tfontSourceBytes, err := ioutil.ReadFile(fontSource)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\ttrueTypeFont, err := freetype.ParseFont(fontSourceBytes)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tfc := freetype.NewContext()\n\tfc.SetDPI(72)\n\tfc.SetFont(trueTypeFont)\n\tfc.SetFontSize(d.Size0)\n\tfc.SetClip(d.JPG.Bounds())\n\tfc.SetDst(d.JPG)\n\tfc.SetSrc(image.Black)\n\n\tpt := freetype.Pt(d.X0, d.Y0)\n\t_, err = fc.DrawString(d.Title, pt)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tfc.SetFontSize(d.Size1)\n\t_, err = fc.DrawString(d.SubTitle, freetype.Pt(d.X1, d.Y1))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\terr = jpeg.Encode(d.Merged, d.JPG, nil)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}\n")])])]),r("p",[t._v("è¿™é‡Œä¸»è¦ä½¿ç”¨äº† freetype åŒ…ï¼Œåˆ†åˆ«æ¶‰åŠå¦‚ä¸‹ç»†é¡¹ï¼š")]),t._v(" "),r("p",[t._v("1ã€freetype.NewContextï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Contextï¼Œä¼šå¯¹å…¶è®¾ç½®ä¸€äº›é»˜è®¤å€¼")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("func NewContext() *Context {\n\treturn &Context{\n\t\tr:        raster.NewRasterizer(0, 0),\n\t\tfontSize: 12,\n\t\tdpi:      72,\n\t\tscale:    12 << 6,\n\t}\n}\n")])])]),r("p",[t._v("2ã€fc.SetDPIï¼šè®¾ç½®å±å¹•æ¯è‹±å¯¸çš„åˆ†è¾¨ç‡")]),t._v(" "),r("p",[t._v("3ã€fc.SetFontï¼šè®¾ç½®ç”¨äºç»˜åˆ¶æ–‡æœ¬çš„å­—ä½“")]),t._v(" "),r("p",[t._v("4ã€fc.SetFontSizeï¼šä»¥ç£…ä¸ºå•ä½è®¾ç½®å­—ä½“å¤§å°")]),t._v(" "),r("p",[t._v("5ã€fc.SetClipï¼šè®¾ç½®å‰ªè£çŸ©å½¢ä»¥è¿›è¡Œç»˜åˆ¶")]),t._v(" "),r("p",[t._v("6ã€fc.SetDstï¼šè®¾ç½®ç›®æ ‡å›¾åƒ")]),t._v(" "),r("p",[t._v("7ã€fc.SetSrcï¼šè®¾ç½®ç»˜åˆ¶æ“ä½œçš„æºå›¾åƒï¼Œé€šå¸¸ä¸º "),r("a",{attrs:{href:"https://golang.org/pkg/image/#Uniform",target:"_blank",rel:"noopener noreferrer"}},[t._v("image.Uniform"),r("OutboundLink")],1)]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("var (\n        // Black is an opaque black uniform image.\n        Black = NewUniform(color.Black)\n        // White is an opaque white uniform image.\n        White = NewUniform(color.White)\n        // Transparent is a fully transparent uniform image.\n        Transparent = NewUniform(color.Transparent)\n        // Opaque is a fully opaque uniform image.\n        Opaque = NewUniform(color.Opaque)\n)\n")])])]),r("p",[t._v("8ã€fc.DrawStringï¼šæ ¹æ® Pt çš„åæ ‡å€¼ç»˜åˆ¶ç»™å®šçš„æ–‡æœ¬å†…å®¹")]),t._v(" "),r("h3",{attrs:{id:"ä¸šåŠ¡é€»è¾‘"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ä¸šåŠ¡é€»è¾‘"}},[t._v("#")]),t._v(" ä¸šåŠ¡é€»è¾‘")]),t._v(" "),r("p",[t._v("æ‰“å¼€ service/article_service/article_poster.go æ–¹æ³•ï¼Œåœ¨ Generate æ–¹æ³•å¢åŠ ç»˜åˆ¶æ–‡å­—çš„ä»£ç é€»è¾‘ï¼Œå¦‚ä¸‹ï¼š")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v('func (a *ArticlePosterBg) Generate() (string, string, error) {\n\tfullPath := qrcode.GetQrCodeFullPath()\n\tfileName, path, err := a.Qr.Encode(fullPath)\n\tif err != nil {\n\t\treturn "", "", err\n\t}\n\n\tif !a.CheckMergedImage(path) {\n\t\t...\n\n\t\tdraw.Draw(jpg, jpg.Bounds(), bgImage, bgImage.Bounds().Min, draw.Over)\n\t\tdraw.Draw(jpg, jpg.Bounds(), qrImage, qrImage.Bounds().Min.Sub(image.Pt(a.Pt.X, a.Pt.Y)), draw.Over)\n\n\t\terr = a.DrawPoster(&DrawText{\n\t\t\tJPG:    jpg,\n\t\t\tMerged: mergedF,\n\n\t\t\tTitle: "Golang Gin ç³»åˆ—æ–‡ç« ",\n\t\t\tX0:    80,\n\t\t\tY0:    160,\n\t\t\tSize0: 42,\n\n\t\t\tSubTitle: "---ç…é±¼",\n\t\t\tX1:       320,\n\t\t\tY1:       220,\n\t\t\tSize1:    36,\n\t\t}, "msyhbd.ttc")\n\n\t\tif err != nil {\n\t\t\treturn "", "", err\n\t\t}\n\t}\n\n\treturn fileName, path, nil\n}\n')])])]),r("h2",{attrs:{id:"éªŒè¯"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#éªŒè¯"}},[t._v("#")]),t._v(" éªŒè¯")]),t._v(" "),r("p",[t._v("è®¿é—®ç”Ÿæˆæ–‡ç« æµ·æŠ¥çš„æ¥å£ "),r("code",[t._v("$HOST/api/v1/articles/poster/generate?token=$token")]),t._v("ï¼Œæ£€æŸ¥å…¶ç”Ÿæˆç»“æœï¼Œå¦‚ä¸‹å›¾")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://i.imgur.com/qaaG0LE.jpg",alt:"image"}})]),t._v(" "),r("h2",{attrs:{id:"æ€»ç»“"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[t._v("#")]),t._v(" æ€»ç»“")]),t._v(" "),r("p",[t._v("åœ¨æœ¬ç« èŠ‚åœ¨ "),r("a",{attrs:{href:"https://github.com/EDDYCJY/blog/blob/master/golang/gin/2018-07-04-Gin%E5%AE%9E%E8%B7%B5-%E8%BF%9E%E8%BD%BD%E5%8D%81%E4%BA%94-%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81-%E5%90%88%E5%B9%B6%E6%B5%B7%E6%8A%A5.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("è¿è½½åäº”"),r("OutboundLink")],1),t._v(" çš„åŸºç¡€ä¸Šå¢åŠ äº†ç»˜åˆ¶æ–‡å­—ï¼Œåœ¨å®ç°ä¸Šå¹¶ä¸å›°éš¾ï¼Œè€Œè¿™ä¸¤å—éœ€æ±‚ä¸€èˆ¬ä¼šåŒæ—¶å‡ºç°ï¼Œå¤§å®¶å¯ä»¥å¤šåŠ ç»ƒä¹ ï¼Œäº†è§£é‡Œé¢çš„é€»è¾‘å’Œå…¶ä»– API ğŸ˜")]),t._v(" "),r("h2",{attrs:{id:"å‚è€ƒ"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒ"}},[t._v("#")]),t._v(" å‚è€ƒ")]),t._v(" "),r("h3",{attrs:{id:"æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç "}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç "}},[t._v("#")]),t._v(" æœ¬ç³»åˆ—ç¤ºä¾‹ä»£ç ")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://github.com/EDDYCJY/go-gin-example",target:"_blank",rel:"noopener noreferrer"}},[t._v("go-gin-example"),r("OutboundLink")],1)])]),t._v(" "),r("h2",{attrs:{id:"å…³äº"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#å…³äº"}},[t._v("#")]),t._v(" å…³äº")]),t._v(" "),r("h3",{attrs:{id:"ä¿®æ”¹è®°å½•"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ä¿®æ”¹è®°å½•"}},[t._v("#")]),t._v(" ä¿®æ”¹è®°å½•")]),t._v(" "),r("ul",[r("li",[t._v("ç¬¬ä¸€ç‰ˆï¼š2018å¹´02æœˆ16æ—¥å‘å¸ƒæ–‡ç« ")]),t._v(" "),r("li",[t._v("ç¬¬äºŒç‰ˆï¼š2019å¹´10æœˆ02æ—¥ä¿®æ”¹æ–‡ç« ")])]),t._v(" "),r("h2",{attrs:{id:"ï¼Ÿ"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ï¼Ÿ"}},[t._v("#")]),t._v(" ï¼Ÿ")]),t._v(" "),r("p",[t._v("å¦‚æœæœ‰ä»»ä½•ç–‘é—®æˆ–é”™è¯¯ï¼Œæ¬¢è¿åœ¨ "),r("a",{attrs:{href:"https://github.com/EDDYCJY/blog",target:"_blank",rel:"noopener noreferrer"}},[t._v("issues"),r("OutboundLink")],1),t._v(" è¿›è¡Œæé—®æˆ–ç»™äºˆä¿®æ­£æ„è§ï¼Œå¦‚æœå–œæ¬¢æˆ–å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ Starï¼Œå¯¹ä½œè€…æ˜¯ä¸€ç§é¼“åŠ±å’Œæ¨è¿›ã€‚")]),t._v(" "),r("h3",{attrs:{id:"æˆ‘çš„å…¬ä¼—å·"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#æˆ‘çš„å…¬ä¼—å·"}},[t._v("#")]),t._v(" æˆ‘çš„å…¬ä¼—å·")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://image.eddycjy.com/8d0b0c3a11e74efd5fdfd7910257e70b.jpg",alt:"image"}})])])}),[],!1,null,null,null);e.default=n.exports}}]);